import { __decorate, __metadata } from "tslib";
import { Component, ContentChild, ElementRef, HostListener, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { animate, AnimationBuilder, AnimationFactory, AnimationPlayer, keyframes, style } from '@angular/animations';
import { PoSlideBaseComponent } from './po-slide-base.component';
import { PoSlideContentTemplateDirective } from './directives/po-slide-content-template.directive';
import { PoSlideItemComponent } from './po-slide-item/po-slide-item.component';
const poSlideDefaultHeight = 336;
const poSlideIntervalMin = 1000;
const poSlideMinHeight = 192;
const poSlideTiming = '250ms ease';
/**
 * @docsExtends PoSlideBaseComponent
 *
 * @example
 * <example name="po-slide-basic" title="PO Slide Basic">
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.html"> </file>
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-labs" title="PO Slide Labs">
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.html"> </file>
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-useful-articles" title="PO Slide - Useful articles">
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.html"> </file>
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-landscapes" title="PO Slide - Landscapes">
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.html"> </file>
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.ts"> </file>
 * </example>
 */
let PoSlideComponent = class PoSlideComponent extends PoSlideBaseComponent {
    constructor(builder) {
        super();
        this.builder = builder;
        this.isLoaded = false;
        this.currentSlideIndex = 0;
        this.slideItems = [];
    }
    get hasElements() {
        return !!this.slide.nativeElement.offsetWidth && !!this.itemsElements && !!this.itemsElements.length;
    }
    get isImageSlide() {
        return !this.slideContentTemplate;
    }
    get offset() {
        return this.currentSlideIndex * this.slideItemWidth;
    }
    get hasSlides() {
        return !!this.slides && !!this.slides.length;
    }
    onResize() {
        if (this.slide) {
            this.setSlideItemWidth();
            this.goToItem(this.currentSlideIndex);
        }
    }
    ngDoCheck() {
        if (!this.isLoaded && this.hasElements) {
            this.setSlideItemWidth();
            this.isLoaded = true;
            if (this.hasSlides) {
                this.startSlide();
            }
        }
    }
    ngOnChanges(changes) {
        if (changes.height) {
            this.setSlideHeight(this.height);
        }
    }
    goToItem(index) {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = index;
        this.animate(this.offset);
    }
    nextControl() {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.next();
    }
    next() {
        if (this.currentSlideIndex + 1 === this.slideItems.length) {
            this.currentSlideIndex = 0;
            this.animate(0);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex + 1) % this.slideItems.length;
        this.animate(this.offset);
    }
    previous() {
        if (this.currentSlideIndex === 0) {
            this.currentSlideIndex = this.slideItems.length - 1;
            this.animate(this.offset);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex - 1 + this.slideItems.length) % this.slideItems.length;
        this.animate(this.offset);
    }
    previousControl() {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.previous();
    }
    setSlideHeight(height) {
        this.setHeight(height);
    }
    animate(offset) {
        if (this.hasElements) {
            const animation = this.buildTransitionAnimation(offset);
            this.player = animation.create(this.slide.nativeElement);
            this.player.play();
        }
    }
    buildTransitionAnimation(offset) {
        return this.builder.build([animate(poSlideTiming, keyframes([style({ transform: `translateX(-${offset}px)` })]))]);
    }
    createArrayForTemplate(slides) {
        this.slideItems = [...slides];
    }
    createArrayFromSlides(slides) {
        const isStringArray = slides.every(item => typeof item === 'string');
        if (isStringArray) {
            slides.forEach(element => this.slideItems.push({ image: `${element}` }));
        }
        else {
            this.slideItems = [...slides];
        }
    }
    setDefaultHeight(height) {
        if ((height && height <= poSlideMinHeight) || (!height && this.isImageSlide)) {
            this.slide.nativeElement.style.height = `${poSlideDefaultHeight}px`;
            this.imageHeight = poSlideDefaultHeight;
        }
        else {
            this.imageHeight = undefined;
        }
    }
    setHeight(height) {
        if (height && height > poSlideMinHeight) {
            this.slide.nativeElement.style.height = `${height}px`;
            this.imageHeight = height;
        }
        else {
            this.setDefaultHeight(height);
        }
    }
    setSlideItemWidth() {
        if (this.hasElements) {
            this.slideItemWidth = this.itemsElements.first.itemElement.nativeElement.getBoundingClientRect().width;
        }
    }
    cancelInterval() {
        clearInterval(this.setInterval);
    }
    setSlideItems(slides) {
        if (this.hasSlides) {
            this.slideContentTemplate ? this.createArrayForTemplate(slides) : this.createArrayFromSlides(slides);
        }
        else {
            this.slideItems = [];
            this.cancelInterval();
        }
    }
    startSlide() {
        this.setSlideHeight(this.height);
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = 0;
    }
    startInterval() {
        if (this.setInterval) {
            this.cancelInterval();
        }
        this.setInterval =
            this.hasSlides && this.hasElements
                ? setInterval(() => {
                    this.next();
                }, this.interval)
                : undefined;
    }
};
PoSlideComponent.ctorParameters = () => [
    { type: AnimationBuilder }
];
__decorate([
    ContentChild(PoSlideContentTemplateDirective, { static: true }),
    __metadata("design:type", PoSlideContentTemplateDirective)
], PoSlideComponent.prototype, "slideContentTemplate", void 0);
__decorate([
    ViewChild('slide', { static: true }),
    __metadata("design:type", ElementRef)
], PoSlideComponent.prototype, "slide", void 0);
__decorate([
    ViewChildren(PoSlideItemComponent),
    __metadata("design:type", QueryList)
], PoSlideComponent.prototype, "itemsElements", void 0);
__decorate([
    HostListener('window:resize'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], PoSlideComponent.prototype, "onResize", null);
PoSlideComponent = __decorate([
    Component({
        selector: 'po-slide',
        template: "<div class=\"po-slide-wrapper\">\n  <div class=\"po-slide-outer\">\n    <div class=\"po-slide-inner\" #slide>\n      <ng-container *ngFor=\"let item of slideItems; let index = index\">\n        <po-slide-item\n          [p-action]=\"item.action\"\n          [p-data]=\"item\"\n          [p-image]=\"item.image\"\n          [p-image-height]=\"imageHeight\"\n          [p-template]=\"slideContentTemplate\"\n          [p-alt]=\"item.alt\"\n          [p-link]=\"item.link\"\n        >\n        </po-slide-item>\n      </ng-container>\n    </div>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\" p-control=\"previous\" (p-click)=\"previousControl()\">\n    </po-slide-control>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\" p-control=\"next\" (p-click)=\"nextControl()\">\n    </po-slide-control>\n  </div>\n\n  <po-slide-circles\n    *ngIf=\"hasSlides && slides.length > 1\"\n    [p-current-slide-index]=\"currentSlideIndex\"\n    [p-items]=\"slideItems\"\n    (p-click)=\"goToItem($event)\"\n  >\n  </po-slide-circles>\n</div>\n"
    }),
    __metadata("design:paramtypes", [AnimationBuilder])
], PoSlideComponent);
export { PoSlideComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tc2xpZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1zbGlkZS9wby1zbGlkZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUVaLFVBQVUsRUFDVixZQUFZLEVBQ1osU0FBUyxFQUNULFNBQVMsRUFDVCxZQUFZLEVBR2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXJILE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRW5HLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRS9FLE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDO0FBQ2pDLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDO0FBQ2hDLE1BQU0sZ0JBQWdCLEdBQUcsR0FBRyxDQUFDO0FBQzdCLE1BQU0sYUFBYSxHQUFHLFlBQVksQ0FBQztBQUVuQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFLSCxJQUFhLGdCQUFnQixHQUE3QixNQUFhLGdCQUFpQixTQUFRLG9CQUFvQjtJQWlDeEQsWUFBb0IsT0FBeUI7UUFDM0MsS0FBSyxFQUFFLENBQUM7UUFEVSxZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQWhDckMsYUFBUSxHQUFZLEtBQUssQ0FBQztRQW9CbEMsc0JBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBRXRCLGVBQVUsR0FBNkIsRUFBRSxDQUFDO0lBWTFDLENBQUM7SUE5QkQsSUFBWSxXQUFXO1FBQ3JCLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUM7SUFDdkcsQ0FBQztJQUVELElBQVksWUFBWTtRQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDO0lBQ3BDLENBQUM7SUFFRCxJQUFZLE1BQU07UUFDaEIsT0FBTyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDL0MsQ0FBQztJQWtCOEIsUUFBUTtRQUNyQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQ3ZDO0lBQ0gsQ0FBQztJQUVELFNBQVM7UUFDUCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBRXJCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDbEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO2FBQ25CO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtZQUNsQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNsQztJQUNILENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYTtRQUNwQixJQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsa0JBQWtCLEVBQUU7WUFDdEMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ3RCO1FBRUQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLFFBQVEsR0FBRyxrQkFBa0IsRUFBRTtZQUN0QyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDdEI7UUFFRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsSUFBSTtRQUNGLElBQUksSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRTtZQUN6RCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEIsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQy9FLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxJQUFJLENBQUMsaUJBQWlCLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDcEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUIsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQ3hHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxlQUFlO1FBQ2IsSUFBSSxJQUFJLENBQUMsUUFBUSxHQUFHLGtCQUFrQixFQUFFO1lBQ3RDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUN0QjtRQUVELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBRUQsY0FBYyxDQUFDLE1BQWM7UUFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRU8sT0FBTyxDQUFDLE1BQWM7UUFDNUIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLE1BQU0sU0FBUyxHQUFxQixJQUFJLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFMUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNwQjtJQUNILENBQUM7SUFFTyx3QkFBd0IsQ0FBQyxNQUFjO1FBQzdDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFNBQVMsRUFBRSxlQUFlLE1BQU0sS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckgsQ0FBQztJQUVPLHNCQUFzQixDQUFDLE1BQWtCO1FBQy9DLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFTyxxQkFBcUIsQ0FBQyxNQUF5QztRQUNyRSxNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUM7UUFFckUsSUFBSSxhQUFhLEVBQUU7WUFDakIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUcsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDMUU7YUFBTTtZQUNMLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxHQUF3QixNQUFPLENBQUMsQ0FBQztTQUNyRDtJQUNILENBQUM7SUFFTyxnQkFBZ0IsQ0FBQyxNQUFjO1FBQ3JDLElBQUksQ0FBQyxNQUFNLElBQUksTUFBTSxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDNUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLG9CQUFvQixJQUFJLENBQUM7WUFDcEUsSUFBSSxDQUFDLFdBQVcsR0FBRyxvQkFBb0IsQ0FBQztTQUN6QzthQUFNO1lBQ0wsSUFBSSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7U0FDOUI7SUFDSCxDQUFDO0lBRU8sU0FBUyxDQUFDLE1BQWM7UUFDOUIsSUFBSSxNQUFNLElBQUksTUFBTSxHQUFHLGdCQUFnQixFQUFFO1lBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQztZQUN0RCxJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQztTQUMzQjthQUFNO1lBQ0wsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDcEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLHFCQUFxQixFQUFFLENBQUMsS0FBSyxDQUFDO1NBQ3hHO0lBQ0gsQ0FBQztJQUVTLGNBQWM7UUFDdEIsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRVMsYUFBYSxDQUFDLE1BQXlDO1FBQy9ELElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3RHO2FBQU07WUFDTCxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRVMsVUFBVTtRQUNsQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVqQyxJQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsa0JBQWtCLEVBQUU7WUFDdEMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ3RCO1FBRUQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRVMsYUFBYTtRQUNyQixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDcEIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO1FBRUQsSUFBSSxDQUFDLFdBQVc7WUFDZCxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxXQUFXO2dCQUNoQyxDQUFDLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtvQkFDZixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2QsQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ25CLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDbEIsQ0FBQztDQUNGLENBQUE7O1lBbks4QixnQkFBZ0I7O0FBTjdDO0lBREMsWUFBWSxDQUFDLCtCQUErQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDOzhCQUMxQywrQkFBK0I7OERBQUM7QUFFaEI7SUFBckMsU0FBUyxDQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzs4QkFBZ0IsVUFBVTsrQ0FBQztBQUU1QjtJQUFuQyxZQUFZLENBQUMsb0JBQW9CLENBQUM7OEJBQXdCLFNBQVM7dURBQXVCO0FBTTVEO0lBQTlCLFlBQVksQ0FBQyxlQUFlLENBQUM7Ozs7Z0RBSzdCO0FBMUNVLGdCQUFnQjtJQUo1QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsVUFBVTtRQUNwQixrakNBQXdDO0tBQ3pDLENBQUM7cUNBa0M2QixnQkFBZ0I7R0FqQ2xDLGdCQUFnQixDQW9NNUI7U0FwTVksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIERvQ2hlY2ssXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgUXVlcnlMaXN0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDaGlsZHJlbixcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBhbmltYXRlLCBBbmltYXRpb25CdWlsZGVyLCBBbmltYXRpb25GYWN0b3J5LCBBbmltYXRpb25QbGF5ZXIsIGtleWZyYW1lcywgc3R5bGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuaW1wb3J0IHsgUG9TbGlkZUJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLXNsaWRlLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvU2xpZGVDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUgfSBmcm9tICcuL2RpcmVjdGl2ZXMvcG8tc2xpZGUtY29udGVudC10ZW1wbGF0ZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgUG9TbGlkZUl0ZW0gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tc2xpZGUtaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9TbGlkZUl0ZW1Db21wb25lbnQgfSBmcm9tICcuL3BvLXNsaWRlLWl0ZW0vcG8tc2xpZGUtaXRlbS5jb21wb25lbnQnO1xuXG5jb25zdCBwb1NsaWRlRGVmYXVsdEhlaWdodCA9IDMzNjtcbmNvbnN0IHBvU2xpZGVJbnRlcnZhbE1pbiA9IDEwMDA7XG5jb25zdCBwb1NsaWRlTWluSGVpZ2h0ID0gMTkyO1xuY29uc3QgcG9TbGlkZVRpbWluZyA9ICcyNTBtcyBlYXNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9TbGlkZUJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLWJhc2ljXCIgdGl0bGU9XCJQTyBTbGlkZSBCYXNpY1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWJhc2ljL3NhbXBsZS1wby1zbGlkZS1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtYmFzaWMvc2FtcGxlLXBvLXNsaWRlLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLWxhYnNcIiB0aXRsZT1cIlBPIFNsaWRlIExhYnNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS1sYWJzL3NhbXBsZS1wby1zbGlkZS1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS1sYWJzL3NhbXBsZS1wby1zbGlkZS1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlc1wiIHRpdGxlPVwiUE8gU2xpZGUgLSBVc2VmdWwgYXJ0aWNsZXNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMvc2FtcGxlLXBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtdXNlZnVsLWFydGljbGVzL3NhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2xpZGUtbGFuZHNjYXBlc1wiIHRpdGxlPVwiUE8gU2xpZGUgLSBMYW5kc2NhcGVzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy9zYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy9zYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1zbGlkZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1zbGlkZS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9TbGlkZUNvbXBvbmVudCBleHRlbmRzIFBvU2xpZGVCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgRG9DaGVjaywgT25DaGFuZ2VzIHtcbiAgcHJpdmF0ZSBpc0xvYWRlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHBsYXllcjogQW5pbWF0aW9uUGxheWVyO1xuICBwcml2YXRlIHNldEludGVydmFsOiBhbnk7XG5cbiAgcHJpdmF0ZSBnZXQgaGFzRWxlbWVudHMoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoICYmICEhdGhpcy5pdGVtc0VsZW1lbnRzICYmICEhdGhpcy5pdGVtc0VsZW1lbnRzLmxlbmd0aDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzSW1hZ2VTbGlkZSgpIHtcbiAgICByZXR1cm4gIXRoaXMuc2xpZGVDb250ZW50VGVtcGxhdGU7XG4gIH1cblxuICBwcml2YXRlIGdldCBvZmZzZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFNsaWRlSW5kZXggKiB0aGlzLnNsaWRlSXRlbVdpZHRoO1xuICB9XG5cbiAgZ2V0IGhhc1NsaWRlcygpIHtcbiAgICByZXR1cm4gISF0aGlzLnNsaWRlcyAmJiAhIXRoaXMuc2xpZGVzLmxlbmd0aDtcbiAgfVxuXG4gIGN1cnJlbnRTbGlkZUluZGV4ID0gMDtcbiAgaW1hZ2VIZWlnaHQ6IG51bWJlcjtcbiAgc2xpZGVJdGVtczogQXJyYXk8UG9TbGlkZUl0ZW0gfCBhbnk+ID0gW107XG4gIHNsaWRlSXRlbVdpZHRoOiBudW1iZXI7XG5cbiAgQENvbnRlbnRDaGlsZChQb1NsaWRlQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBzbGlkZUNvbnRlbnRUZW1wbGF0ZTogUG9TbGlkZUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZTtcblxuICBAVmlld0NoaWxkKCdzbGlkZScsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgc2xpZGU6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZHJlbihQb1NsaWRlSXRlbUNvbXBvbmVudCkgcHJpdmF0ZSBpdGVtc0VsZW1lbnRzOiBRdWVyeUxpc3Q8UG9TbGlkZUl0ZW1Db21wb25lbnQ+O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlcikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJykgb25SZXNpemUoKSB7XG4gICAgaWYgKHRoaXMuc2xpZGUpIHtcbiAgICAgIHRoaXMuc2V0U2xpZGVJdGVtV2lkdGgoKTtcbiAgICAgIHRoaXMuZ29Ub0l0ZW0odGhpcy5jdXJyZW50U2xpZGVJbmRleCk7XG4gICAgfVxuICB9XG5cbiAgbmdEb0NoZWNrKCkge1xuICAgIGlmICghdGhpcy5pc0xvYWRlZCAmJiB0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICB0aGlzLnNldFNsaWRlSXRlbVdpZHRoKCk7XG4gICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaGFzU2xpZGVzKSB7XG4gICAgICAgIHRoaXMuc3RhcnRTbGlkZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy5oZWlnaHQpIHtcbiAgICAgIHRoaXMuc2V0U2xpZGVIZWlnaHQodGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGdvVG9JdGVtKGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IGluZGV4O1xuICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gIH1cblxuICBuZXh0Q29udHJvbCgpIHtcbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5uZXh0KCk7XG4gIH1cblxuICBuZXh0KCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSA9PT0gdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gICAgICB0aGlzLmFuaW1hdGUoMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAodGhpcy5jdXJyZW50U2xpZGVJbmRleCArIDEpICUgdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aDtcbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgcHJldmlvdXMoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFNsaWRlSW5kZXggPT09IDApIHtcbiAgICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAodGhpcy5jdXJyZW50U2xpZGVJbmRleCAtIDEgKyB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoKSAlIHRoaXMuc2xpZGVJdGVtcy5sZW5ndGg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByZXZpb3VzQ29udHJvbCgpIHtcbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wcmV2aW91cygpO1xuICB9XG5cbiAgc2V0U2xpZGVIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICB0aGlzLnNldEhlaWdodChoZWlnaHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRlKG9mZnNldDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudHMpIHtcbiAgICAgIGNvbnN0IGFuaW1hdGlvbjogQW5pbWF0aW9uRmFjdG9yeSA9IHRoaXMuYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldCk7XG5cbiAgICAgIHRoaXMucGxheWVyID0gYW5pbWF0aW9uLmNyZWF0ZSh0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgdGhpcy5wbGF5ZXIucGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRlci5idWlsZChbYW5pbWF0ZShwb1NsaWRlVGltaW5nLCBrZXlmcmFtZXMoW3N0eWxlKHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgtJHtvZmZzZXR9cHgpYCB9KV0pKV0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZvclRlbXBsYXRlKHNsaWRlczogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi5zbGlkZXNdO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZyb21TbGlkZXMoc2xpZGVzOiBBcnJheTxQb1NsaWRlSXRlbSB8IHN0cmluZyB8IGFueT4pIHtcbiAgICBjb25zdCBpc1N0cmluZ0FycmF5ID0gc2xpZGVzLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKTtcblxuICAgIGlmIChpc1N0cmluZ0FycmF5KSB7XG4gICAgICBzbGlkZXMuZm9yRWFjaChlbGVtZW50ID0+IHRoaXMuc2xpZGVJdGVtcy5wdXNoKHsgaW1hZ2U6IGAke2VsZW1lbnR9YCB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi4oPEFycmF5PFBvU2xpZGVJdGVtPj5zbGlkZXMpXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldERlZmF1bHRIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBpZiAoKGhlaWdodCAmJiBoZWlnaHQgPD0gcG9TbGlkZU1pbkhlaWdodCkgfHwgKCFoZWlnaHQgJiYgdGhpcy5pc0ltYWdlU2xpZGUpKSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7cG9TbGlkZURlZmF1bHRIZWlnaHR9cHhgO1xuICAgICAgdGhpcy5pbWFnZUhlaWdodCA9IHBvU2xpZGVEZWZhdWx0SGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPiBwb1NsaWRlTWluSGVpZ2h0KSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgIHRoaXMuaW1hZ2VIZWlnaHQgPSBoZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0RGVmYXVsdEhlaWdodChoZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0U2xpZGVJdGVtV2lkdGgoKSB7XG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudHMpIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtV2lkdGggPSB0aGlzLml0ZW1zRWxlbWVudHMuZmlyc3QuaXRlbUVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgY2FuY2VsSW50ZXJ2YWwoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnNldEludGVydmFsKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRTbGlkZUl0ZW1zKHNsaWRlczogQXJyYXk8UG9TbGlkZUl0ZW0gfCBzdHJpbmcgfCBhbnk+KSB7XG4gICAgaWYgKHRoaXMuaGFzU2xpZGVzKSB7XG4gICAgICB0aGlzLnNsaWRlQ29udGVudFRlbXBsYXRlID8gdGhpcy5jcmVhdGVBcnJheUZvclRlbXBsYXRlKHNsaWRlcykgOiB0aGlzLmNyZWF0ZUFycmF5RnJvbVNsaWRlcyhzbGlkZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNsaWRlSXRlbXMgPSBbXTtcbiAgICAgIHRoaXMuY2FuY2VsSW50ZXJ2YWwoKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRTbGlkZSgpIHtcbiAgICB0aGlzLnNldFNsaWRlSGVpZ2h0KHRoaXMuaGVpZ2h0KTtcblxuICAgIGlmICh0aGlzLmludGVydmFsID4gcG9TbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gMDtcbiAgfVxuXG4gIHByb3RlY3RlZCBzdGFydEludGVydmFsKCkge1xuICAgIGlmICh0aGlzLnNldEludGVydmFsKSB7XG4gICAgICB0aGlzLmNhbmNlbEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRJbnRlcnZhbCA9XG4gICAgICB0aGlzLmhhc1NsaWRlcyAmJiB0aGlzLmhhc0VsZW1lbnRzXG4gICAgICAgID8gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgICAgfSwgdGhpcy5pbnRlcnZhbClcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gIH1cbn1cbiJdfQ==