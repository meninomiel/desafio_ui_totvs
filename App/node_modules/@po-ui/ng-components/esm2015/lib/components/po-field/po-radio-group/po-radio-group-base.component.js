import { __decorate, __metadata } from "tslib";
import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToBoolean, convertToInt, removeDuplicatedOptions } from '../../../utils/util';
import { InputBoolean } from '../../../decorators';
import { requiredFailed } from '../validators';
const poRadioGroupColumnsDefaultLength = 6;
const poRadioGroupColumnsTotalLength = 12;
/**
 * @description
 *
 * O componente `po-radio-group` deve ser utilizado para disponibilizar múltiplas opções ao usuário, permitindo a ele que
 * selecione apenas uma delas. Seu uso é recomendado para um número pequeno de opções, caso contrário, recomenda-se o uso
 * do [**po-combo**](/documentation/po-combo) ou [**po-select**](/documentation/po-select).
 *
 * Este não é um componente de multiseleção, se for este o caso, deve-se utilizar o
 * [**po-checkbox-group**](/documentation/po-checkbox-group).
 *
 * > Ao passar um valor para o *model* que não esteja na lista de opções, o mesmo será definido como `undefined`.
 */
let PoRadioGroupBaseComponent = class PoRadioGroupBaseComponent {
    constructor() {
        this._columns = poRadioGroupColumnsDefaultLength;
        this._disabled = false;
        this._required = false;
        this.mdColumns = poRadioGroupColumnsDefaultLength;
        this.onChangePropagate = null;
        /**
         * @optional
         *
         * @description
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * > Caso mais de um elemento seja configurado com essa propriedade, apenas o último elemento declarado com ela terá o foco.
         *
         * @default `false`
         */
        this.autoFocus = false;
        /** Evento ao alterar valor do campo. */
        this.change = new EventEmitter();
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a quantidade de colunas para exibição das opções.
     *
     * **Considerações:**
     *  - É possível exibir as opções entre `1` e `4` colunas.
     *  - O número máximo de colunas é invariável nas seguintes resoluções:
     *    + `sm`: `1`
     *    + `md`: `2`
     *
     * @default `2`
     */
    set columns(value) {
        const columns = convertToInt(value, poRadioGroupColumnsDefaultLength);
        this._columns = this.getGridSystemColumns(columns, 4);
        this.mdColumns = this.getGridSystemColumns(columns, 2);
    }
    get columns() {
        return this._columns;
    }
    /**
     * @optional
     *
     * @description
     *
     * Indica que o campo será desabilitado.
     *
     * @default `false`
     */
    set disabled(disabled) {
        this._disabled = convertToBoolean(disabled);
        this.validateModel();
    }
    get disabled() {
        return this._disabled;
    }
    /**
     * @optional
     *
     * @description
     *
     * Indica que o campo será obrigatório.
     *
     * @default `false`
     */
    set required(required) {
        this._required = convertToBoolean(required);
        this.validateModel();
    }
    get required() {
        return this._required;
    }
    /**
     * Lista de opções que serão exibidas.
     * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoRadioGroupOption.
     */
    set options(value) {
        this._options = value;
        removeDuplicatedOptions(this.options);
    }
    get options() {
        return this._options;
    }
    // Função que controla quando deve ser emitido onChange e atualiza o Model
    changeValue(changedValue) {
        if (this.onChangePropagate) {
            this.onChangePropagate(changedValue);
        }
        if (this.value !== changedValue) {
            this.change.emit(changedValue);
        }
        this.value = changedValue;
    }
    registerOnChange(fn) {
        this.onChangePropagate = fn;
    }
    registerOnTouched(fn) { }
    registerOnValidatorChange(fn) {
        this.validatorChange = fn;
    }
    validate(abstractControl) {
        if (requiredFailed(this.required, this.disabled, abstractControl.value)) {
            return {
                required: {
                    valid: false
                }
            };
        }
    }
    writeValue(modelValue) {
        this.value = modelValue;
        // Busca radio com o valor especificado
        const element = this.getElementByValue(modelValue);
        if (!element && this.onChangePropagate) {
            this.value = undefined;
            this.onChangePropagate(this.value);
        }
    }
    checkColumnsRange(columns, maxColumns) {
        const minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    }
    getGridSystemColumns(columns, maxColumns) {
        const gridSystemColumns = poRadioGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poRadioGroupColumnsDefaultLength;
    }
    validateModel() {
        if (this.validatorChange) {
            this.validatorChange();
        }
    }
};
__decorate([
    Input('p-auto-focus'), InputBoolean(),
    __metadata("design:type", Boolean)
], PoRadioGroupBaseComponent.prototype, "autoFocus", void 0);
__decorate([
    Input('name'),
    __metadata("design:type", String)
], PoRadioGroupBaseComponent.prototype, "name", void 0);
__decorate([
    Input('p-columns'),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], PoRadioGroupBaseComponent.prototype, "columns", null);
__decorate([
    Input('p-disabled'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], PoRadioGroupBaseComponent.prototype, "disabled", null);
__decorate([
    Input('p-required'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], PoRadioGroupBaseComponent.prototype, "required", null);
__decorate([
    Input('p-options'),
    __metadata("design:type", Array),
    __metadata("design:paramtypes", [Array])
], PoRadioGroupBaseComponent.prototype, "options", null);
__decorate([
    Input('p-optional'),
    __metadata("design:type", Boolean)
], PoRadioGroupBaseComponent.prototype, "optional", void 0);
__decorate([
    Output('p-change'),
    __metadata("design:type", EventEmitter)
], PoRadioGroupBaseComponent.prototype, "change", void 0);
PoRadioGroupBaseComponent = __decorate([
    Directive()
], PoRadioGroupBaseComponent);
export { PoRadioGroupBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcmFkaW8tZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLXJhZGlvLWdyb3VwL3BvLXJhZGlvLWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM5RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkvQyxNQUFNLGdDQUFnQyxHQUFXLENBQUMsQ0FBQztBQUNuRCxNQUFNLDhCQUE4QixHQUFXLEVBQUUsQ0FBQztBQUVsRDs7Ozs7Ozs7Ozs7R0FXRztBQUVILElBQXNCLHlCQUF5QixHQUEvQyxNQUFzQix5QkFBeUI7SUFBL0M7UUFDVSxhQUFRLEdBQVcsZ0NBQWdDLENBQUM7UUFDcEQsY0FBUyxHQUFhLEtBQUssQ0FBQztRQUU1QixjQUFTLEdBQWEsS0FBSyxDQUFDO1FBRXBDLGNBQVMsR0FBVyxnQ0FBZ0MsQ0FBQztRQUc3QyxzQkFBaUIsR0FBUSxJQUFJLENBQUM7UUFHdEM7Ozs7Ozs7Ozs7V0FVRztRQUNvQyxjQUFTLEdBQVksS0FBSyxDQUFDO1FBZ0dsRSx3Q0FBd0M7UUFDcEIsV0FBTSxHQUF1QixJQUFJLFlBQVksRUFBTyxDQUFDO0lBa0UzRSxDQUFDO0lBOUpDOzs7Ozs7Ozs7Ozs7OztPQWNHO0lBQ2lCLElBQUksT0FBTyxDQUFDLEtBQWE7UUFDM0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLEtBQUssRUFBRSxnQ0FBZ0Ms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LFVBQVUsQ0FBQztJQUN4RCxDQUFDO0lBRU8sb0JBQW9CLENBQUMsT0FBZSxFQUFFLFVBQWtCO1FBQzlELE1BQU0saUJBQWlCLEdBQUcsOEJBQThCLEdBQUcsT0FBTyxDQUFDO1FBRW5FLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLGdDQUFnQyxDQUFDO0lBQzVHLENBQUM7SUFFTyxhQUFhO1FBQ25CLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDeEI7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQW5Ld0M7SUFBdEMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFFLFlBQVksRUFBRTs7NERBQTRCO0FBR25EO0lBQWQsS0FBSyxDQUFDLE1BQU0sQ0FBQzs7dURBQWM7QUFpQlI7SUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7O3dEQUtsQjtBQWVvQjtJQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOzs7eURBSW5CO0FBZW9CO0lBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7Ozt5REFJbkI7QUFVbUI7SUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQzs4QkFBb0IsS0FBSztxQ0FBTCxLQUFLO3dEQUczQztBQWtCb0I7SUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQzs7MkRBQW1CO0FBR25CO0lBQW5CLE1BQU0sQ0FBQyxVQUFVLENBQUM7OEJBQVUsWUFBWTt5REFBZ0M7QUF4SHJELHlCQUF5QjtJQUQ5QyxTQUFTLEVBQUU7R0FDVSx5QkFBeUIsQ0EwTDlDO1NBMUxxQix5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBjb252ZXJ0VG9Cb29sZWFuLCBjb252ZXJ0VG9JbnQsIHJlbW92ZUR1cGxpY2F0ZWRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFBvUmFkaW9Hcm91cE9wdGlvbiB9IGZyb20gJy4vcG8tcmFkaW8tZ3JvdXAtb3B0aW9uLmludGVyZmFjZSc7XG5cbmNvbnN0IHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoOiBudW1iZXIgPSA2O1xuY29uc3QgcG9SYWRpb0dyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoOiBudW1iZXIgPSAxMjtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGNvbXBvbmVudGUgYHBvLXJhZGlvLWdyb3VwYCBkZXZlIHNlciB1dGlsaXphZG8gcGFyYSBkaXNwb25pYmlsaXphciBtw7psdGlwbGFzIG9ww6fDtWVzIGFvIHVzdcOhcmlvLCBwZXJtaXRpbmRvIGEgZWxlIHF1ZVxuICogc2VsZWNpb25lIGFwZW5hcyB1bWEgZGVsYXMuIFNldSB1c28gw6kgcmVjb21lbmRhZG8gcGFyYSB1bSBuw7ptZXJvIHBlcXVlbm8gZGUgb3DDp8O1ZXMsIGNhc28gY29udHLDoXJpbywgcmVjb21lbmRhLXNlIG8gdXNvXG4gKiBkbyBbKipwby1jb21ibyoqXSgvZG9jdW1lbnRhdGlvbi9wby1jb21ibykgb3UgWyoqcG8tc2VsZWN0KipdKC9kb2N1bWVudGF0aW9uL3BvLXNlbGVjdCkuXG4gKlxuICogRXN0ZSBuw6NvIMOpIHVtIGNvbXBvbmVudGUgZGUgbXVsdGlzZWxlw6fDo28sIHNlIGZvciBlc3RlIG8gY2FzbywgZGV2ZS1zZSB1dGlsaXphciBvXG4gKiBbKipwby1jaGVja2JveC1ncm91cCoqXSgvZG9jdW1lbnRhdGlvbi9wby1jaGVja2JveC1ncm91cCkuXG4gKlxuICogPiBBbyBwYXNzYXIgdW0gdmFsb3IgcGFyYSBvICptb2RlbCogcXVlIG7Do28gZXN0ZWphIG5hIGxpc3RhIGRlIG9ww6fDtWVzLCBvIG1lc21vIHNlcsOhIGRlZmluaWRvIGNvbW8gYHVuZGVmaW5lZGAuXG4gKi9cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFBvUmFkaW9Hcm91cEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcbiAgcHJpdmF0ZSBfY29sdW1uczogbnVtYmVyID0gcG9SYWRpb0dyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByaXZhdGUgX2Rpc2FibGVkPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9vcHRpb25zOiBBcnJheTxQb1JhZGlvR3JvdXBPcHRpb24+O1xuICBwcml2YXRlIF9yZXF1aXJlZD86IGJvb2xlYW4gPSBmYWxzZTtcblxuICBtZENvbHVtbnM6IG51bWJlciA9IHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICB2YWx1ZTogYW55O1xuXG4gIHByaXZhdGUgb25DaGFuZ2VQcm9wYWdhdGU6IGFueSA9IG51bGw7XG4gIHByaXZhdGUgdmFsaWRhdG9yQ2hhbmdlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogPiBDYXNvIG1haXMgZGUgdW0gZWxlbWVudG8gc2VqYSBjb25maWd1cmFkbyBjb20gZXNzYSBwcm9wcmllZGFkZSwgYXBlbmFzIG8gw7psdGltbyBlbGVtZW50byBkZWNsYXJhZG8gY29tIGVsYSB0ZXLDoSBvIGZvY28uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1hdXRvLWZvY3VzJykgQElucHV0Qm9vbGVhbigpIGF1dG9Gb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBOb21lIGRhcyBvcMOnw7Vlcy4gKi9cbiAgQElucHV0KCduYW1lJykgbmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBhIHF1YW50aWRhZGUgZGUgY29sdW5hcyBwYXJhIGV4aWJpw6fDo28gZGFzIG9ww6fDtWVzLlxuICAgKlxuICAgKiAqKkNvbnNpZGVyYcOnw7VlczoqKlxuICAgKiAgLSDDiSBwb3Nzw612ZWwgZXhpYmlyIGFzIG9ww6fDtWVzIGVudHJlIGAxYCBlIGA0YCBjb2x1bmFzLlxuICAgKiAgLSBPIG7Dum1lcm8gbcOheGltbyBkZSBjb2x1bmFzIMOpIGludmFyacOhdmVsIG5hcyBzZWd1aW50ZXMgcmVzb2x1w6fDtWVzOlxuICAgKiAgICArIGBzbWA6IGAxYFxuICAgKiAgICArIGBtZGA6IGAyYFxuICAgKlxuICAgKiBAZGVmYXVsdCBgMmBcbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBjb252ZXJ0VG9JbnQodmFsdWUsIHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoKTtcblxuICAgIHRoaXMuX2NvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDQpO1xuICAgIHRoaXMubWRDb2x1bW5zID0gdGhpcy5nZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zLCAyKTtcbiAgfVxuXG4gIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSW5kaWNhIHF1ZSBvIGNhbXBvIHNlcsOhIGRlc2FiaWxpdGFkby5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWRpc2FibGVkJykgc2V0IGRpc2FibGVkKGRpc2FibGVkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fZGlzYWJsZWQgPSBjb252ZXJ0VG9Cb29sZWFuKGRpc2FibGVkKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBxdWUgbyBjYW1wbyBzZXLDoSBvYnJpZ2F0w7NyaW8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1yZXF1aXJlZCcpIHNldCByZXF1aXJlZChyZXF1aXJlZDogYm9vbGVhbikge1xuICAgIHRoaXMuX3JlcXVpcmVkID0gY29udmVydFRvQm9vbGVhbihyZXF1aXJlZCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwoKTtcbiAgfVxuXG4gIGdldCByZXF1aXJlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWlyZWQ7XG4gIH1cblxuICAvKipcbiAgICogTGlzdGEgZGUgb3DDp8O1ZXMgcXVlIHNlcsOjbyBleGliaWRhcy5cbiAgICogTmVzdGEgcHJvcHJpZWRhZGUgZGV2ZSBzZXIgZGVmaW5pZG8gdW0gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgUG9SYWRpb0dyb3VwT3B0aW9uLlxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbnMnKSBzZXQgb3B0aW9ucyh2YWx1ZTogQXJyYXk8UG9SYWRpb0dyb3VwT3B0aW9uPikge1xuICAgIHRoaXMuX29wdGlvbnMgPSB2YWx1ZTtcbiAgICByZW1vdmVEdXBsaWNhdGVkT3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICB9XG4gIGdldCBvcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIHNlIGEgaW5kaWNhw6fDo28gZGUgY2FtcG8gb3BjaW9uYWwgc2Vyw6EgZXhpYmlkYS5cbiAgICpcbiAgICogPiBOw6NvIHNlcsOhIGV4aWJpZGEgYSBpbmRpY2HDp8OjbyBzZTpcbiAgICogLSBPIGNhbXBvIGNvbnRlciBgcC1yZXF1aXJlZGA7XG4gICAqIC0gTsOjbyBwb3NzdWlyIGBwLWhlbHBgIGUvb3UgYHAtbGFiZWxgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3Atb3B0aW9uYWwnKSBvcHRpb25hbDogYm9vbGVhbjtcblxuICAvKiogRXZlbnRvIGFvIGFsdGVyYXIgdmFsb3IgZG8gY2FtcG8uICovXG4gIEBPdXRwdXQoJ3AtY2hhbmdlJykgY2hhbmdlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvLyBEZXZlIHJldG9ybmFyIG8gdmFsb3IgZWxlbWVudG8gcXVlIGNvbnTDqW0gbyB2YWxvciBwYXNzYWRvIHBvciBwYXLDom1ldHJvXG4gIGFic3RyYWN0IGdldEVsZW1lbnRCeVZhbHVlKHZhbHVlOiBhbnkpOiBhbnk7XG5cbiAgLy8gRnVuw6fDo28gcXVlIGNvbnRyb2xhIHF1YW5kbyBkZXZlIHNlciBlbWl0aWRvIG9uQ2hhbmdlIGUgYXR1YWxpemEgbyBNb2RlbFxuICBjaGFuZ2VWYWx1ZShjaGFuZ2VkVmFsdWU6IGFueSkge1xuICAgIGlmICh0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKGNoYW5nZWRWYWx1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudmFsdWUgIT09IGNoYW5nZWRWYWx1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2UuZW1pdChjaGFuZ2VkVmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMudmFsdWUgPSBjaGFuZ2VkVmFsdWU7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpIHtcbiAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7fVxuXG4gIHJlZ2lzdGVyT25WYWxpZGF0b3JDaGFuZ2UoZm46IGFueSkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICB2YWxpZGF0ZShhYnN0cmFjdENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0ge1xuICAgIGlmIChyZXF1aXJlZEZhaWxlZCh0aGlzLnJlcXVpcmVkLCB0aGlzLmRpc2FibGVkLCBhYnN0cmFjdENvbnRyb2wudmFsdWUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXF1aXJlZDoge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHdyaXRlVmFsdWUobW9kZWxWYWx1ZTogYW55KSB7XG4gICAgdGhpcy52YWx1ZSA9IG1vZGVsVmFsdWU7XG5cbiAgICAvLyBCdXNjYSByYWRpbyBjb20gbyB2YWxvciBlc3BlY2lmaWNhZG9cbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRFbGVtZW50QnlWYWx1ZShtb2RlbFZhbHVlKTtcbiAgICBpZiAoIWVsZW1lbnQgJiYgdGhpcy5vbkNoYW5nZVByb3BhZ2F0ZSkge1xuICAgICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMub25DaGFuZ2VQcm9wYWdhdGUodGhpcy52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0NvbHVtbnNSYW5nZShjb2x1bW5zLCBtYXhDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbWluQ29sdW1ucyA9IDE7XG5cbiAgICByZXR1cm4gY29sdW1ucyA+PSBtaW5Db2x1bW5zICYmIGNvbHVtbnMgPD0gbWF4Q29sdW1ucztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1uczogbnVtYmVyLCBtYXhDb2x1bW5zOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IGdyaWRTeXN0ZW1Db2x1bW5zID0gcG9SYWRpb0dyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoIC8gY29sdW1ucztcblxuICAgIHJldHVybiB0aGlzLmNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpID8gZ3JpZFN5c3RlbUNvbHVtbnMgOiBwb1JhZGlvR3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVNb2RlbCgpIHtcbiAgICBpZiAodGhpcy52YWxpZGF0b3JDaGFuZ2UpIHtcbiAgICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlKCk7XG4gICAgfVxuICB9XG59XG4iXX0=