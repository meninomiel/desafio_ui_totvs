import { __decorate, __metadata } from "tslib";
import { DoCheck, EventEmitter, Input, IterableDiffers, Output, Directive } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, isKeyCodeEnter, poLocaleDefault } from '../../utils/util';
export const poDisclaimerGroupLiteralsDefault = {
    en: { removeAll: 'Remove all' },
    es: { removeAll: 'Eliminar todos' },
    pt: { removeAll: 'Remover todos' }
};
/**
 * @description
 *
 * O componente `po-disclaimer-group` é recomendado para manipular palavras-chave de filtros aplicados em uma pesquisa.
 *
 * À partir de dois *disclaimers* com o botão **fechar** habilitado, o componente renderiza de forma automática um novo e destacado
 * *disclaimer* que possibilita **remover todos**, mas que também pode ser desabilitado.
 *
 * Também é possível navegar entre os *disclaimers* através do teclado utilizando a tecla *tab* e, para remoção do *disclaimer* selecionado,
 * basta pressionar a tecla *enter*. Esta funcionalidade não se aplica caso a propriedade `hideClose` estiver habilitada.
 *
 * > Veja a integração destas funcionalidade no componente [po-page-list](/documentation/po-page-list).
 */
let PoDisclaimerGroupBaseComponent = class PoDisclaimerGroupBaseComponent {
    constructor(differs) {
        this._disclaimers = [];
        this._hideRemoveAll = false;
        this.previousDisclaimers = [];
        this.literals = Object.assign(Object.assign({}, poDisclaimerGroupLiteralsDefault[poLocaleDefault]), poDisclaimerGroupLiteralsDefault[browserLanguage()]);
        /** Função que será disparada quando a lista de *disclaimers* for modificada. */
        this.change = new EventEmitter();
        this.differ = differs.find([]).create(null);
    }
    /** Lista de *disclaimers*. */
    /**
     * @description
     *
     * Lista de *disclaimers*.
     *
     * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `PoDisclaimer`.
     *
     * Exemplo adicionando um *disclaimer* no array:
     *
     * ```
     * this.disclaimers = [...this.disclaimers, disclaimer];
     * ```
     *
     * ou
     *
     * ```
     * this.disclaimers = this.disclaimers.concat(disclaimer);
     * ```
     */
    set disclaimers(value) {
        this.previousDisclaimers = [...this.disclaimers];
        this._disclaimers = this.checkDisclaimers(value);
    }
    get disclaimers() {
        return this._disclaimers;
    }
    /**
     * @optional
     *
     * @description
     *
     * Oculta o botão para remover todos os *disclaimers* do grupo.
     *
     * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
     *
     * @default `false`
     */
    set hideRemoveAll(value) {
        this._hideRemoveAll = value === '' ? true : convertToBoolean(value);
    }
    get hideRemoveAll() {
        return this._hideRemoveAll;
    }
    ngDoCheck() {
        this.checkChanges();
    }
    closeItem(disclaimer, emitChange = true) {
        const itemIndex = this.disclaimers.findIndex(d => d['$id'] === disclaimer['$id']);
        this.disclaimers.splice(itemIndex, 1);
        if (emitChange) {
            this.emitChangeDisclaimers();
        }
    }
    isRemoveAll() {
        return !this.hideRemoveAll && this.disclaimers.filter(c => !c.hideClose).length > 1;
    }
    onKeyPress(event) {
        if (isKeyCodeEnter(event)) {
            this.removeAllItems();
        }
    }
    removeAllItems() {
        const removeItems = [];
        this.disclaimers.forEach(disclaimer => {
            if (!disclaimer.hideClose) {
                removeItems.push(disclaimer);
            }
        });
        removeItems.forEach(disclaimer => this.closeItem(disclaimer, false));
        this.emitChangeDisclaimers();
    }
    checkChanges() {
        if (this.differ) {
            const changes = this.differ.diff(this.disclaimers);
            if (changes && this.disclaimersAreChanged(this.disclaimers)) {
                this.emitChangeDisclaimers();
            }
        }
    }
    checkDisclaimers(disclaimers) {
        if (Array.isArray(disclaimers)) {
            for (let i = 0; i < disclaimers.length; i++) {
                const disclaimer = disclaimers[i];
                if (disclaimer.value || disclaimer.value === 0 || disclaimer.value === false) {
                    disclaimer['$id'] = uuid();
                }
                else {
                    disclaimers.splice(i, 1);
                    i--;
                }
            }
            return disclaimers;
        }
        return [];
    }
    disclaimersAreChanged(disclaimers) {
        const currentValues = disclaimers;
        if (currentValues.length !== this.previousDisclaimers.length) {
            return true;
        }
        return currentValues.some((disclaimer, index) => disclaimer.value !== this.previousDisclaimers[index].value ||
            disclaimer.property !== this.previousDisclaimers[index].property);
    }
    emitChangeDisclaimers() {
        setTimeout(() => {
            this.change.emit(this.disclaimers);
        });
        this.previousDisclaimers = [...this._disclaimers];
    }
};
PoDisclaimerGroupBaseComponent.ctorParameters = () => [
    { type: IterableDiffers }
];
__decorate([
    Input('p-disclaimers'),
    __metadata("design:type", Array),
    __metadata("design:paramtypes", [Array])
], PoDisclaimerGroupBaseComponent.prototype, "disclaimers", null);
__decorate([
    Input('p-hide-remove-all'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], PoDisclaimerGroupBaseComponent.prototype, "hideRemoveAll", null);
__decorate([
    Input('p-title'),
    __metadata("design:type", String)
], PoDisclaimerGroupBaseComponent.prototype, "title", void 0);
__decorate([
    Output('p-change'),
    __metadata("design:type", EventEmitter)
], PoDisclaimerGroupBaseComponent.prototype, "change", void 0);
PoDisclaimerGroupBaseComponent = __decorate([
    Directive(),
    __metadata("design:paramtypes", [IterableDiffers])
], PoDisclaimerGroupBaseComponent);
export { PoDisclaimerGroupBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlzY2xhaW1lci1ncm91cC1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwby11aS9uZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZGlzY2xhaW1lci1ncm91cC9wby1kaXNjbGFpbWVyLWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakcsT0FBTyxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFJdEcsTUFBTSxDQUFDLE1BQU0sZ0NBQWdDLEdBQUc7SUFDOUMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRTtJQUMvQixFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7SUFDbkMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRTtDQUNuQyxDQUFDO0FBRUY7Ozs7Ozs7Ozs7OztHQVlHO0FBRUgsSUFBYSw4QkFBOEIsR0FBM0MsTUFBYSw4QkFBOEI7SUFvRXpDLFlBQVksT0FBd0I7UUFuRTVCLGlCQUFZLEdBQXdCLEVBQUUsQ0FBQztRQUN2QyxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUdoQyx3QkFBbUIsR0FBd0IsRUFBRSxDQUFDO1FBRTdDLGFBQVEsbUNBQ1osZ0NBQWdDLENBQUMsZUFBZSxDQUFDLEdBQ2pELGdDQUFnQyxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQ3REO1FBdURGLGdGQUFnRjtRQUM1RCxXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7UUFHdkUsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBMURELDhCQUE4QjtJQUU5Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7O09Ba0JHO0lBQ3FCLElBQUksV0FBVyxDQUFDLEtBQTBCO1FBQ2hFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFFRCxJQUFJLFdBQVc7UUFDYixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQztJQUVEOzs7Ozs7Ozs7O09BVUc7SUFFSCxJQUFJLGFBQWEsQ0FBQyxLQUFjO1FBQzlCLElBQUksQ0FBQyxjQUFjLEdBQVEsS0FBSyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQsSUFBSSxhQUFhO1FBQ2YsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzdCLENBQUM7SUFZRCxTQUFTO1FBQ1AsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFRCxTQUFTLENBQUMsVUFBZSxFQUFFLGFBQXNCLElBQUk7UUFDbkQsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDbEYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXRDLElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7U0FDOUI7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQVU7UUFDbkIsSUFBSSxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDekIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVELGNBQWM7UUFDWixNQUFNLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFFdkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUU7Z0JBQ3pCLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDOUI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILFdBQVcsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXJFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFTyxZQUFZO1FBQ2xCLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNmLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVuRCxJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUMzRCxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQzthQUM5QjtTQUNGO0lBQ0gsQ0FBQztJQUVPLGdCQUFnQixDQUFDLFdBQWdDO1FBQ3ZELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUM5QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDM0MsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVsQyxJQUFJLFVBQVUsQ0FBQyxLQUFLLElBQUksVUFBVSxDQUFDLEtBQUssS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUU7b0JBQzVFLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQztpQkFDNUI7cUJBQU07b0JBQ0wsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ3pCLENBQUMsRUFBRSxDQUFDO2lCQUNMO2FBQ0Y7WUFFRCxPQUFPLFdBQVcsQ0FBQztTQUNwQjtRQUVELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVPLHFCQUFxQixDQUFDLFdBQWdDO1FBQzVELE1BQU0sYUFBYSxHQUF3QixXQUFXLENBQUM7UUFFdkQsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUU7WUFDNUQsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sYUFBYSxDQUFDLElBQUksQ0FDdkIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FDcEIsVUFBVSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSztZQUMxRCxVQUFVLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQ25FLENBQUM7SUFDSixDQUFDO0lBRU8scUJBQXFCO1FBQzNCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0YsQ0FBQTs7WUExRnNCLGVBQWU7O0FBbkNaO0lBQXZCLEtBQUssQ0FBQyxlQUFlLENBQUM7OEJBQXdCLEtBQUs7cUNBQUwsS0FBSztpRUFHbkQ7QUFrQkQ7SUFEQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7OzttRUFHMUI7QUFPaUI7SUFBakIsS0FBSyxDQUFDLFNBQVMsQ0FBQzs7NkRBQWdCO0FBR2I7SUFBbkIsTUFBTSxDQUFDLFVBQVUsQ0FBQzs4QkFBVSxZQUFZOzhEQUFnQztBQWxFOUQsOEJBQThCO0lBRDFDLFNBQVMsRUFBRTtxQ0FxRVcsZUFBZTtHQXBFekIsOEJBQThCLENBOEoxQztTQTlKWSw4QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb0NoZWNrLCBFdmVudEVtaXR0ZXIsIElucHV0LCBJdGVyYWJsZURpZmZlcnMsIE91dHB1dCwgRGlyZWN0aXZlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IHY0IGFzIHV1aWQgfSBmcm9tICd1dWlkJztcblxuaW1wb3J0IHsgYnJvd3Nlckxhbmd1YWdlLCBjb252ZXJ0VG9Cb29sZWFuLCBpc0tleUNvZGVFbnRlciwgcG9Mb2NhbGVEZWZhdWx0IH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFBvRGlzY2xhaW1lciB9IGZyb20gJy4uL3BvLWRpc2NsYWltZXIvcG8tZGlzY2xhaW1lci5pbnRlcmZhY2UnO1xuXG5leHBvcnQgY29uc3QgcG9EaXNjbGFpbWVyR3JvdXBMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiB7IHJlbW92ZUFsbDogJ1JlbW92ZSBhbGwnIH0sXG4gIGVzOiB7IHJlbW92ZUFsbDogJ0VsaW1pbmFyIHRvZG9zJyB9LFxuICBwdDogeyByZW1vdmVBbGw6ICdSZW1vdmVyIHRvZG9zJyB9XG59O1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gY29tcG9uZW50ZSBgcG8tZGlzY2xhaW1lci1ncm91cGAgw6kgcmVjb21lbmRhZG8gcGFyYSBtYW5pcHVsYXIgcGFsYXZyYXMtY2hhdmUgZGUgZmlsdHJvcyBhcGxpY2Fkb3MgZW0gdW1hIHBlc3F1aXNhLlxuICpcbiAqIMOAIHBhcnRpciBkZSBkb2lzICpkaXNjbGFpbWVycyogY29tIG8gYm90w6NvICoqZmVjaGFyKiogaGFiaWxpdGFkbywgbyBjb21wb25lbnRlIHJlbmRlcml6YSBkZSBmb3JtYSBhdXRvbcOhdGljYSB1bSBub3ZvIGUgZGVzdGFjYWRvXG4gKiAqZGlzY2xhaW1lciogcXVlIHBvc3NpYmlsaXRhICoqcmVtb3ZlciB0b2RvcyoqLCBtYXMgcXVlIHRhbWLDqW0gcG9kZSBzZXIgZGVzYWJpbGl0YWRvLlxuICpcbiAqIFRhbWLDqW0gw6kgcG9zc8OtdmVsIG5hdmVnYXIgZW50cmUgb3MgKmRpc2NsYWltZXJzKiBhdHJhdsOpcyBkbyB0ZWNsYWRvIHV0aWxpemFuZG8gYSB0ZWNsYSAqdGFiKiBlLCBwYXJhIHJlbW/Dp8OjbyBkbyAqZGlzY2xhaW1lciogc2VsZWNpb25hZG8sXG4gKiBiYXN0YSBwcmVzc2lvbmFyIGEgdGVjbGEgKmVudGVyKi4gRXN0YSBmdW5jaW9uYWxpZGFkZSBuw6NvIHNlIGFwbGljYSBjYXNvIGEgcHJvcHJpZWRhZGUgYGhpZGVDbG9zZWAgZXN0aXZlciBoYWJpbGl0YWRhLlxuICpcbiAqID4gVmVqYSBhIGludGVncmHDp8OjbyBkZXN0YXMgZnVuY2lvbmFsaWRhZGUgbm8gY29tcG9uZW50ZSBbcG8tcGFnZS1saXN0XSgvZG9jdW1lbnRhdGlvbi9wby1wYWdlLWxpc3QpLlxuICovXG5ARGlyZWN0aXZlKClcbmV4cG9ydCBjbGFzcyBQb0Rpc2NsYWltZXJHcm91cEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrIHtcbiAgcHJpdmF0ZSBfZGlzY2xhaW1lcnM6IEFycmF5PFBvRGlzY2xhaW1lcj4gPSBbXTtcbiAgcHJpdmF0ZSBfaGlkZVJlbW92ZUFsbDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgZGlmZmVyO1xuICBwcml2YXRlIHByZXZpb3VzRGlzY2xhaW1lcnM6IEFycmF5PFBvRGlzY2xhaW1lcj4gPSBbXTtcblxuICByZWFkb25seSBsaXRlcmFscyA9IHtcbiAgICAuLi5wb0Rpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFtwb0xvY2FsZURlZmF1bHRdLFxuICAgIC4uLnBvRGlzY2xhaW1lckdyb3VwTGl0ZXJhbHNEZWZhdWx0W2Jyb3dzZXJMYW5ndWFnZSgpXVxuICB9O1xuXG4gIC8qKiBMaXN0YSBkZSAqZGlzY2xhaW1lcnMqLiAqL1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogTGlzdGEgZGUgKmRpc2NsYWltZXJzKi5cbiAgICpcbiAgICogUGFyYSBxdWUgYSBsaXN0YSBkZSAqZGlzY2xhaW1lcnMqIHNlamEgYXR1YWxpemFkYSBkaW5hbWljYW1lbnRlIGRldmUtc2UgcGFzc2FyIHVtYSBub3ZhIHJlZmVyw6puY2lhIGRvIGFycmF5IGRlIGBQb0Rpc2NsYWltZXJgLlxuICAgKlxuICAgKiBFeGVtcGxvIGFkaWNpb25hbmRvIHVtICpkaXNjbGFpbWVyKiBubyBhcnJheTpcbiAgICpcbiAgICogYGBgXG4gICAqIHRoaXMuZGlzY2xhaW1lcnMgPSBbLi4udGhpcy5kaXNjbGFpbWVycywgZGlzY2xhaW1lcl07XG4gICAqIGBgYFxuICAgKlxuICAgKiBvdVxuICAgKlxuICAgKiBgYGBcbiAgICogdGhpcy5kaXNjbGFpbWVycyA9IHRoaXMuZGlzY2xhaW1lcnMuY29uY2F0KGRpc2NsYWltZXIpO1xuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgncC1kaXNjbGFpbWVycycpIHNldCBkaXNjbGFpbWVycyh2YWx1ZTogQXJyYXk8UG9EaXNjbGFpbWVyPikge1xuICAgIHRoaXMucHJldmlvdXNEaXNjbGFpbWVycyA9IFsuLi50aGlzLmRpc2NsYWltZXJzXTtcbiAgICB0aGlzLl9kaXNjbGFpbWVycyA9IHRoaXMuY2hlY2tEaXNjbGFpbWVycyh2YWx1ZSk7XG4gIH1cblxuICBnZXQgZGlzY2xhaW1lcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2NsYWltZXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogT2N1bHRhIG8gYm90w6NvIHBhcmEgcmVtb3ZlciB0b2RvcyBvcyAqZGlzY2xhaW1lcnMqIGRvIGdydXBvLlxuICAgKlxuICAgKiA+IFBvciBwYWRyw6NvLCBvIG1lc21vIMOpIGV4aWJpZG8gw6AgcGFydGlyIGRlIGRvaXMgb3UgbWFpcyAqZGlzY2xhaW1lcnMqIGNvbSBhIG9ww6fDo28gYGhpZGVDbG9zZWAgaGFiaWxpdGFkYS5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWhpZGUtcmVtb3ZlLWFsbCcpXG4gIHNldCBoaWRlUmVtb3ZlQWxsKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5faGlkZVJlbW92ZUFsbCA9IDxhbnk+dmFsdWUgPT09ICcnID8gdHJ1ZSA6IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuICB9XG5cbiAgZ2V0IGhpZGVSZW1vdmVBbGwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hpZGVSZW1vdmVBbGw7XG4gIH1cblxuICAvKiogVMOtdHVsbyBkbyBncnVwbyBkZSAqZGlzY2xhaW1lcnMqLiAqL1xuICBASW5wdXQoJ3AtdGl0bGUnKSB0aXRsZT86IHN0cmluZztcblxuICAvKiogRnVuw6fDo28gcXVlIHNlcsOhIGRpc3BhcmFkYSBxdWFuZG8gYSBsaXN0YSBkZSAqZGlzY2xhaW1lcnMqIGZvciBtb2RpZmljYWRhLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IoZGlmZmVyczogSXRlcmFibGVEaWZmZXJzKSB7XG4gICAgdGhpcy5kaWZmZXIgPSBkaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcbiAgICB0aGlzLmNoZWNrQ2hhbmdlcygpO1xuICB9XG5cbiAgY2xvc2VJdGVtKGRpc2NsYWltZXI6IGFueSwgZW1pdENoYW5nZTogYm9vbGVhbiA9IHRydWUpIHtcbiAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmRpc2NsYWltZXJzLmZpbmRJbmRleChkID0+IGRbJyRpZCddID09PSBkaXNjbGFpbWVyWyckaWQnXSk7XG4gICAgdGhpcy5kaXNjbGFpbWVycy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcblxuICAgIGlmIChlbWl0Q2hhbmdlKSB7XG4gICAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgIH1cbiAgfVxuXG4gIGlzUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiAhdGhpcy5oaWRlUmVtb3ZlQWxsICYmIHRoaXMuZGlzY2xhaW1lcnMuZmlsdGVyKGMgPT4gIWMuaGlkZUNsb3NlKS5sZW5ndGggPiAxO1xuICB9XG5cbiAgb25LZXlQcmVzcyhldmVudDogYW55KSB7XG4gICAgaWYgKGlzS2V5Q29kZUVudGVyKGV2ZW50KSkge1xuICAgICAgdGhpcy5yZW1vdmVBbGxJdGVtcygpO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUFsbEl0ZW1zKCkge1xuICAgIGNvbnN0IHJlbW92ZUl0ZW1zID0gW107XG5cbiAgICB0aGlzLmRpc2NsYWltZXJzLmZvckVhY2goZGlzY2xhaW1lciA9PiB7XG4gICAgICBpZiAoIWRpc2NsYWltZXIuaGlkZUNsb3NlKSB7XG4gICAgICAgIHJlbW92ZUl0ZW1zLnB1c2goZGlzY2xhaW1lcik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZW1vdmVJdGVtcy5mb3JFYWNoKGRpc2NsYWltZXIgPT4gdGhpcy5jbG9zZUl0ZW0oZGlzY2xhaW1lciwgZmFsc2UpKTtcblxuICAgIHRoaXMuZW1pdENoYW5nZURpc2NsYWltZXJzKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrQ2hhbmdlcygpIHtcbiAgICBpZiAodGhpcy5kaWZmZXIpIHtcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLmRpZmZlci5kaWZmKHRoaXMuZGlzY2xhaW1lcnMpO1xuXG4gICAgICBpZiAoY2hhbmdlcyAmJiB0aGlzLmRpc2NsYWltZXJzQXJlQ2hhbmdlZCh0aGlzLmRpc2NsYWltZXJzKSkge1xuICAgICAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tEaXNjbGFpbWVycyhkaXNjbGFpbWVyczogQXJyYXk8UG9EaXNjbGFpbWVyPikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGRpc2NsYWltZXJzKSkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNjbGFpbWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBkaXNjbGFpbWVyID0gZGlzY2xhaW1lcnNbaV07XG5cbiAgICAgICAgaWYgKGRpc2NsYWltZXIudmFsdWUgfHwgZGlzY2xhaW1lci52YWx1ZSA9PT0gMCB8fCBkaXNjbGFpbWVyLnZhbHVlID09PSBmYWxzZSkge1xuICAgICAgICAgIGRpc2NsYWltZXJbJyRpZCddID0gdXVpZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc2NsYWltZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBpLS07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRpc2NsYWltZXJzO1xuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzY2xhaW1lcnNBcmVDaGFuZ2VkKGRpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlczogQXJyYXk8UG9EaXNjbGFpbWVyPiA9IGRpc2NsYWltZXJzO1xuXG4gICAgaWYgKGN1cnJlbnRWYWx1ZXMubGVuZ3RoICE9PSB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudFZhbHVlcy5zb21lKFxuICAgICAgKGRpc2NsYWltZXIsIGluZGV4KSA9PlxuICAgICAgICBkaXNjbGFpbWVyLnZhbHVlICE9PSB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnNbaW5kZXhdLnZhbHVlIHx8XG4gICAgICAgIGRpc2NsYWltZXIucHJvcGVydHkgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0ucHJvcGVydHlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMuZGlzY2xhaW1lcnMpO1xuICAgIH0pO1xuICAgIHRoaXMucHJldmlvdXNEaXNjbGFpbWVycyA9IFsuLi50aGlzLl9kaXNjbGFpbWVyc107XG4gIH1cbn1cbiJdfQ==