import { __decorate } from "tslib";
import { ElementRef, Injectable } from '@angular/core';
/**
 * @docsPrivate
 * @description
 *
 * Serviço responsável por gerenciar as posições de um elemento em relação a um elemento alvo. Ele pode receber as
 * seguintes posições:
 *
 * - `right`: Posiciona o elemento no lado direito do componente alvo.
 * - `right-bottom`: Posiciona o elemento no lado direito inferior do componente alvo.
 * - `right-top`: Posiciona o elemento no lado direito superior do componente alvo.
 * - `bottom`: Posiciona o elemento abaixo do componente alvo.
 * - `bottom-left`: Posiciona o elemento abaixo e à esquerda do componente alvo.
 * - `bottom-right`: Posiciona o elemento abaixo e à direita do componente alvo.
 * - `left`: Posiciona o elemento no lado esquerdo do componente alvo.
 * - `left-top`: Posiciona o elemento no lado esquerdo superior do componente alvo.
 * - `left-bottom`: Posiciona o elemento no lado esquerdo inferior do componente alvo.
 * - `top`: Posiciona o elemento acima do componente alvo.
 * - `top-right`: Posiciona o elemento acima e à direita do componente alvo.
 * - `top-left`: Posiciona o elemento acima e à esquerda do componente alvo.
 *
 * Caso o elemento não caiba na tela na posição indicada ele será rotacionado automaticamente para se adequar,
 * inicialmente no lado definido como padrão e em seguida seguindo o sentido horário.
 */
const poControlPositionSidesDefault = [
    'bottom',
    'bottom-left',
    'bottom-right',
    'left',
    'left-top',
    'left-bottom',
    'top',
    'top-right',
    'top-left',
    'right',
    'right-bottom',
    'right-top'
];
let PoControlPositionService = class PoControlPositionService {
    constructor() {
        this.differenceDiagonalToWidthArrow = 3;
        this.isSetElementWidth = false;
        // offset da seta em relação ao canto do componente
        this.offsetArrow = 12;
    }
    /**
     * @description Ajusta a posição do elemento, caso não couber em tela irá para próxima posição.
     *
     * @param value posição para exibição do elemento
     */
    adjustPosition(value) {
        const position = value || 'bottom';
        this.elementPosition(position);
        this.customPositions && this.customPositions.length
            ? this.adjustCustomPosition(position)
            : this.adjustDefaultPosition(position);
    }
    /**
     * @description Retorna a direção da seta, conforme a posição do elemento.
     */
    getArrowDirection() {
        return this.arrowDirection;
    }
    /**
     * @description Método responsável por definir as propriedades utilizadas para exibir o elemento na posição correta.
     *
     * @param element elemento que será exibido
     * @param elementOffset offSet do elemento
     * @param targetElement elemento de onde deve partir a exibição
     * @param customPositions posições que sobrescreve as posições padrões
     * @param isSetElementWidth indica se deve definir o tamanho do elemento a ser exibido, caso for verdadeiro será igual do targetElement
     * @param isCornerAligned indica se o elemento filho será alinhado nos cantos do elemneto pai.
     */
    setElements(element, elementOffset, targetElement, customPositions, isSetElementWidth = false, isCornerAligned = false) {
        this.element = element instanceof ElementRef ? element.nativeElement : element;
        this.targetElement = targetElement instanceof ElementRef ? targetElement.nativeElement : targetElement;
        this.elementOffset = elementOffset;
        this.customPositions = customPositions;
        this.isSetElementWidth = isSetElementWidth;
        this.isCornerAligned = isCornerAligned;
    }
    adjustCustomPosition(position) {
        const positionLength = this.customPositions.length;
        let sidesCount = 0;
        while (sidesCount++ < positionLength) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, this.customPositions);
                this.elementPosition(position);
            }
        }
    }
    adjustDefaultPosition(position) {
        const mainPositions = this.getMainPositions();
        const mainPositionLength = mainPositions.length;
        let mainSidesCount = 0;
        while (mainSidesCount++ < mainPositionLength) {
            const mainPosition = this.getMainPosition(position);
            this.elementPosition(position);
            if (this.overflowMain(mainPosition)) {
                position = this.nextPosition(mainPosition, mainPositions);
                continue;
            }
            else if (this.overflowAllSides(position)) {
                this.verifySubPositions(position);
                return;
            }
            return;
        }
    }
    elementPosition(position) {
        this.isCornerAligned ? this.setAlignedElementPosition(position) : this.setElementPosition(position);
    }
    getMainPosition(position) {
        return position.indexOf('-') > -1 ? position.substring(0, position.indexOf('-')) : position;
    }
    getMainPositions() {
        const defaultMainPositions = ['top', 'right', 'bottom', 'left'];
        return this.customPositions && this.customPositions.length
            ? this.getMainPositionsByCustomPositions(this.customPositions)
            : defaultMainPositions;
    }
    getMainPositionsByCustomPositions(customPositions) {
        const mainPositions = [];
        const customPositionsLength = customPositions.length;
        for (let i = 0; i < customPositionsLength; i++) {
            const position = customPositions[i];
            const mainPosition = this.getMainPosition(position);
            if (!mainPositions.includes(mainPosition)) {
                mainPositions.push(mainPosition);
            }
        }
        return mainPositions;
    }
    getOverflows() {
        const sizesAndPositions = this.getSizesAndPositions();
        return {
            right: sizesAndPositions.element.right > sizesAndPositions.window.innerWidth,
            top: sizesAndPositions.element.top <= 0,
            left: sizesAndPositions.element.left <= 0,
            bottom: sizesAndPositions.element.bottom > sizesAndPositions.window.innerHeight
        };
    }
    getSizesAndPositions() {
        return {
            window: {
                scrollY: window.scrollY,
                scrollX: window.scrollX,
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight
            },
            element: this.element.getBoundingClientRect(),
            target: this.targetElement ? this.targetElement.getBoundingClientRect() : { top: 0, bottom: 0, right: 0, left: 0 }
        };
    }
    nextPosition(position, positions = []) {
        const index = positions.indexOf(position);
        const nextIndex = index + 1;
        if (index > -1 && nextIndex < positions.length) {
            return positions[nextIndex];
        }
        else {
            return positions[0];
        }
    }
    overflowAllSides(position) {
        const overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top || overflows.right || overflows.left;
            case 'top-right':
                return overflows.top || overflows.right;
            case 'top-left':
                return overflows.top || overflows.left;
            case 'right':
                return overflows.right || overflows.top || overflows.bottom;
            case 'right-top':
                return overflows.right || overflows.top;
            case 'right-bottom':
                return overflows.right || overflows.bottom;
            case 'bottom':
                return overflows.bottom || overflows.right || overflows.left;
            case 'bottom-right':
                return overflows.bottom || overflows.right;
            case 'bottom-left':
                return overflows.bottom || overflows.left;
            case 'left':
                return overflows.left || overflows.top || overflows.bottom;
            case 'left-top':
                return overflows.left || overflows.top;
            case 'left-bottom':
                return overflows.left || overflows.bottom;
        }
    }
    overflowMain(position) {
        const overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top;
            case 'right':
                return overflows.right;
            case 'bottom':
                return overflows.bottom;
            case 'left':
                return overflows.left;
        }
    }
    setAlignedArrowDirection(elementPosition) {
        switch (elementPosition) {
            case 'top-left':
                return 'bottom-left';
            case 'top-right':
                return 'bottom-right';
            case 'bottom-right':
                return 'top-right';
            case 'bottom-left':
                return 'top-left';
        }
    }
    setAlignedBottomPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    }
    setAlignedElementPosition(position) {
        this.setElementWidth();
        const sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'bottom-left':
                this.setAlignedBottomPositions(0, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setAlignedBottomPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
            case 'top-left':
                this.setAlignedTopPositions(0, sizesAndPositions);
                break;
            case 'top-right':
                this.setAlignedTopPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setAlignedArrowDirection(position);
    }
    setAlignedTopPositions(displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    }
    setArrowDirection(elementPosition) {
        switch (elementPosition) {
            case 'top':
                return 'bottom';
            case 'top-left':
                return 'bottom-right';
            case 'top-right':
                return 'bottom-left';
            case 'right':
                return 'left';
            case 'right-top':
                return 'left-bottom';
            case 'right-bottom':
                return 'left-top';
            case 'bottom':
                return 'top';
            case 'bottom-right':
                return 'top-left';
            case 'bottom-left':
                return 'top-right';
            case 'left':
                return 'right';
            case 'left-bottom':
                return 'right-top';
            case 'left-top':
                return 'right-bottom';
        }
    }
    setBottomPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    }
    setElementPosition(position) {
        this.setElementWidth();
        const sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'top':
                this.setTopPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'top-left':
                this.setTopPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'top-right':
                this.setTopPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right':
                this.setRightPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'right-top':
                this.setRightPositions(sizesAndPositions.element.height - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right-bottom':
                this.setRightPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'bottom':
                this.setBottomPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setBottomPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'bottom-left':
                this.setBottomPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'left':
                this.setLeftPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'left-bottom':
                this.setLeftPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'left-top':
                this.setLeftPositions(sizesAndPositions.element.height - this.offsetArrow, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setArrowDirection(position);
    }
    setElementWidth() {
        if (this.isSetElementWidth && this.targetElement) {
            this.element.style.width = `${this.targetElement.clientWidth}px`;
        }
    }
    setLeftPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left =
            sizesAndPositions.target.left - sizesAndPositions.element.width - this.elementOffset + 'px';
    }
    setRightPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left = sizesAndPositions.target.right + this.elementOffset + 'px';
    }
    setTopPositions(displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    }
    verifySubPositions(position) {
        if (position.indexOf('-') > -1) {
            position = position.substring(0, position.indexOf('-'));
            this.elementPosition(position);
        }
        let align = 0;
        while (align++ < 3) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, poControlPositionSidesDefault);
                this.elementPosition(position);
            }
            else {
                return null;
            }
        }
    }
};
PoControlPositionService = __decorate([
    Injectable()
], PoControlPositionService);
export { PoControlPositionService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY29udHJvbC1wb3NpdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcG8tY29udHJvbC1wb3NpdGlvbi9wby1jb250cm9sLXBvc2l0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBc0JHO0FBRUgsTUFBTSw2QkFBNkIsR0FBa0I7SUFDbkQsUUFBUTtJQUNSLGFBQWE7SUFDYixjQUFjO0lBQ2QsTUFBTTtJQUNOLFVBQVU7SUFDVixhQUFhO0lBQ2IsS0FBSztJQUNMLFdBQVc7SUFDWCxVQUFVO0lBQ1YsT0FBTztJQUNQLGNBQWM7SUFDZCxXQUFXO0NBQ1osQ0FBQztBQUdGLElBQWEsd0JBQXdCLEdBQXJDLE1BQWEsd0JBQXdCO0lBQXJDO1FBR1UsbUNBQThCLEdBQVcsQ0FBQyxDQUFDO1FBSTNDLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUMzQyxtREFBbUQ7UUFDM0MsZ0JBQVcsR0FBVyxFQUFFLENBQUM7SUE4WG5DLENBQUM7SUEzWEM7Ozs7T0FJRztJQUNILGNBQWMsQ0FBQyxLQUFhO1FBQzFCLE1BQU0sUUFBUSxHQUFHLEtBQUssSUFBSSxRQUFRLENBQUM7UUFDbkMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTTtZQUNqRCxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQztZQUNyQyxDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRDs7T0FFRztJQUNILGlCQUFpQjtRQUNmLE9BQU8sSUFBSSxD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QUcsQ0FBQyxFQUFFO1lBQ2xCLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNuQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsNkJBQTZCLENBQUMsQ0FBQztnQkFDdEUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNoQztpQkFBTTtnQkFDTCxPQUFPLElBQUksQ0FBQzthQUNiO1NBQ0Y7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQXZZWSx3QkFBd0I7SUFEcEMsVUFBVSxFQUFFO0dBQ0Esd0JBQXdCLENBdVlwQztTQXZZWSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8qKlxuICogQGRvY3NQcml2YXRlXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBTZXJ2acOnbyByZXNwb25zw6F2ZWwgcG9yIGdlcmVuY2lhciBhcyBwb3Npw6fDtWVzIGRlIHVtIGVsZW1lbnRvIGVtIHJlbGHDp8OjbyBhIHVtIGVsZW1lbnRvIGFsdm8uIEVsZSBwb2RlIHJlY2ViZXIgYXNcbiAqIHNlZ3VpbnRlcyBwb3Npw6fDtWVzOlxuICpcbiAqIC0gYHJpZ2h0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gbm8gbGFkbyBkaXJlaXRvIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYHJpZ2h0LWJvdHRvbWA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZGlyZWl0byBpbmZlcmlvciBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGByaWdodC10b3BgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBubyBsYWRvIGRpcmVpdG8gc3VwZXJpb3IgZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgYm90dG9tYDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWJhaXhvIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYGJvdHRvbS1sZWZ0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWJhaXhvIGUgw6AgZXNxdWVyZGEgZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgYm90dG9tLXJpZ2h0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWJhaXhvIGUgw6AgZGlyZWl0YSBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGBsZWZ0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gbm8gbGFkbyBlc3F1ZXJkbyBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGBsZWZ0LXRvcGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZXNxdWVyZG8gc3VwZXJpb3IgZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgbGVmdC1ib3R0b21gOiBQb3NpY2lvbmEgbyBlbGVtZW50byBubyBsYWRvIGVzcXVlcmRvIGluZmVyaW9yIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYHRvcGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIGFjaW1hIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYHRvcC1yaWdodGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIGFjaW1hIGUgw6AgZGlyZWl0YSBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGB0b3AtbGVmdGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIGFjaW1hIGUgw6AgZXNxdWVyZGEgZG8gY29tcG9uZW50ZSBhbHZvLlxuICpcbiAqIENhc28gbyBlbGVtZW50byBuw6NvIGNhaWJhIG5hIHRlbGEgbmEgcG9zacOnw6NvIGluZGljYWRhIGVsZSBzZXLDoSByb3RhY2lvbmFkbyBhdXRvbWF0aWNhbWVudGUgcGFyYSBzZSBhZGVxdWFyLFxuICogaW5pY2lhbG1lbnRlIG5vIGxhZG8gZGVmaW5pZG8gY29tbyBwYWRyw6NvIGUgZW0gc2VndWlkYSBzZWd1aW5kbyBvIHNlbnRpZG8gaG9yw6FyaW8uXG4gKi9cblxuY29uc3QgcG9Db250cm9sUG9zaXRpb25TaWRlc0RlZmF1bHQ6IEFycmF5PHN0cmluZz4gPSBbXG4gICdib3R0b20nLFxuICAnYm90dG9tLWxlZnQnLFxuICAnYm90dG9tLXJpZ2h0JyxcbiAgJ2xlZnQnLFxuICAnbGVmdC10b3AnLFxuICAnbGVmdC1ib3R0b20nLFxuICAndG9wJyxcbiAgJ3RvcC1yaWdodCcsXG4gICd0b3AtbGVmdCcsXG4gICdyaWdodCcsXG4gICdyaWdodC1ib3R0b20nLFxuICAncmlnaHQtdG9wJ1xuXTtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBvQ29udHJvbFBvc2l0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgYXJyb3dEaXJlY3Rpb246IHN0cmluZztcbiAgcHJpdmF0ZSBjdXN0b21Qb3NpdGlvbnM6IEFycmF5PHN0cmluZz47XG4gIHByaXZhdGUgZGlmZmVyZW5jZURpYWdvbmFsVG9XaWR0aEFycm93OiBudW1iZXIgPSAzO1xuICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGVsZW1lbnRPZmZzZXQ6IG51bWJlcjtcbiAgcHJpdmF0ZSBpc0Nvcm5lckFsaWduZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgaXNTZXRFbGVtZW50V2lkdGg6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLy8gb2Zmc2V0IGRhIHNldGEgZW0gcmVsYcOnw6NvIGFvIGNhbnRvIGRvIGNvbXBvbmVudGVcbiAgcHJpdmF0ZSBvZmZzZXRBcnJvdzogbnVtYmVyID0gMTI7XG4gIHByaXZhdGUgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBBanVzdGEgYSBwb3Npw6fDo28gZG8gZWxlbWVudG8sIGNhc28gbsOjbyBjb3ViZXIgZW0gdGVsYSBpcsOhIHBhcmEgcHLDs3hpbWEgcG9zacOnw6NvLlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWUgcG9zacOnw6NvIHBhcmEgZXhpYmnDp8OjbyBkbyBlbGVtZW50b1xuICAgKi9cbiAgYWRqdXN0UG9zaXRpb24odmFsdWU6IHN0cmluZykge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gdmFsdWUgfHwgJ2JvdHRvbSc7XG4gICAgdGhpcy5lbGVtZW50UG9zaXRpb24ocG9zaXRpb24pO1xuICAgIHRoaXMuY3VzdG9tUG9zaXRpb25zICYmIHRoaXMuY3VzdG9tUG9zaXRpb25zLmxlbmd0aFxuICAgICAgPyB0aGlzLmFkanVzdEN1c3RvbVBvc2l0aW9uKHBvc2l0aW9uKVxuICAgICAgOiB0aGlzLmFkanVzdERlZmF1bHRQb3NpdGlvbihwb3NpdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFJldG9ybmEgYSBkaXJlw6fDo28gZGEgc2V0YSwgY29uZm9ybWUgYSBwb3Npw6fDo28gZG8gZWxlbWVudG8uXG4gICAqL1xuICBnZXRBcnJvd0RpcmVjdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5hcnJvd0RpcmVjdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIGRlZmluaXIgYXMgcHJvcHJpZWRhZGVzIHV0aWxpemFkYXMgcGFyYSBleGliaXIgbyBlbGVtZW50byBuYSBwb3Npw6fDo28gY29ycmV0YS5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgZWxlbWVudG8gcXVlIHNlcsOhIGV4aWJpZG9cbiAgICogQHBhcmFtIGVsZW1lbnRPZmZzZXQgb2ZmU2V0IGRvIGVsZW1lbnRvXG4gICAqIEBwYXJhbSB0YXJnZXRFbGVtZW50IGVsZW1lbnRvIGRlIG9uZGUgZGV2ZSBwYXJ0aXIgYSBleGliacOnw6NvXG4gICAqIEBwYXJhbSBjdXN0b21Qb3NpdGlvbnMgcG9zacOnw7VlcyBxdWUgc29icmVzY3JldmUgYXMgcG9zacOnw7VlcyBwYWRyw7Vlc1xuICAgKiBAcGFyYW0gaXNTZXRFbGVtZW50V2lkdGggaW5kaWNhIHNlIGRldmUgZGVmaW5pciBvIHRhbWFuaG8gZG8gZWxlbWVudG8gYSBzZXIgZXhpYmlkbywgY2FzbyBmb3IgdmVyZGFkZWlybyBzZXLDoSBpZ3VhbCBkbyB0YXJnZXRFbGVtZW50XG4gICAqIEBwYXJhbSBpc0Nvcm5lckFsaWduZWQgaW5kaWNhIHNlIG8gZWxlbWVudG8gZmlsaG8gc2Vyw6EgYWxpbmhhZG8gbm9zIGNhbnRvcyBkbyBlbGVtbmV0byBwYWkuXG4gICAqL1xuICBzZXRFbGVtZW50cyhcbiAgICBlbGVtZW50OiBFbGVtZW50UmVmIHwgSFRNTEVsZW1lbnQsXG4gICAgZWxlbWVudE9mZnNldDogbnVtYmVyLFxuICAgIHRhcmdldEVsZW1lbnQ6IEVsZW1lbnRSZWYgfCBIVE1MRWxlbWVudCxcbiAgICBjdXN0b21Qb3NpdGlvbnM/OiBBcnJheTxzdHJpbmc+LFxuICAgIGlzU2V0RWxlbWVudFdpZHRoOiBib29sZWFuID0gZmFsc2UsXG4gICAgaXNDb3JuZXJBbGlnbmVkOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYgPyBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQgOiBlbGVtZW50O1xuICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IHRhcmdldEVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50UmVmID8gdGFyZ2V0RWxlbWVudC5uYXRpdmVFbGVtZW50IDogdGFyZ2V0RWxlbWVudDtcblxuICAgIHRoaXMuZWxlbWVudE9mZnNldCA9IGVsZW1lbnRPZmZzZXQ7XG5cbiAgICB0aGlzLmN1c3RvbVBvc2l0aW9ucyA9IGN1c3RvbVBvc2l0aW9ucztcbiAgICB0aGlzLmlzU2V0RWxlbWVudFdpZHRoID0gaXNTZXRFbGVtZW50V2lkdGg7XG4gICAgdGhpcy5pc0Nvcm5lckFsaWduZWQgPSBpc0Nvcm5lckFsaWduZWQ7XG4gIH1cblxuICBwcml2YXRlIGFkanVzdEN1c3RvbVBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICBjb25zdCBwb3NpdGlvbkxlbmd0aCA9IHRoaXMuY3VzdG9tUG9zaXRpb25zLmxlbmd0aDtcblxuICAgIGxldCBzaWRlc0NvdW50ID0gMDtcblxuICAgIHdoaWxlIChzaWRlc0NvdW50KysgPCBwb3NpdGlvbkxlbmd0aCkge1xuICAgICAgaWYgKHRoaXMub3ZlcmZsb3dBbGxTaWRlcyhwb3NpdGlvbikpIHtcbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLm5leHRQb3NpdGlvbihwb3NpdGlvbiwgdGhpcy5jdXN0b21Qb3NpdGlvbnMpO1xuICAgICAgICB0aGlzLmVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3REZWZhdWx0UG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIGNvbnN0IG1haW5Qb3NpdGlvbnMgPSB0aGlzLmdldE1haW5Qb3NpdGlvbnMoKTtcbiAgICBjb25zdCBtYWluUG9zaXRpb25MZW5ndGggPSBtYWluUG9zaXRpb25zLmxlbmd0aDtcblxuICAgIGxldCBtYWluU2lkZXNDb3VudCA9IDA7XG5cbiAgICB3aGlsZSAobWFpblNpZGVzQ291bnQrKyA8IG1haW5Qb3NpdGlvbkxlbmd0aCkge1xuICAgICAgY29uc3QgbWFpblBvc2l0aW9uID0gdGhpcy5nZXRNYWluUG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgdGhpcy5lbGVtZW50UG9zaXRpb24ocG9zaXRpb24pO1xuXG4gICAgICBpZiAodGhpcy5vdmVyZmxvd01haW4obWFpblBvc2l0aW9uKSkge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMubmV4dFBvc2l0aW9uKG1haW5Qb3NpdGlvbiwgbWFpblBvc2l0aW9ucyk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm92ZXJmbG93QWxsU2lkZXMocG9zaXRpb24pKSB7XG4gICAgICAgIHRoaXMudmVyaWZ5U3ViUG9zaXRpb25zKHBvc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBlbGVtZW50UG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIHRoaXMuaXNDb3JuZXJBbGlnbmVkID8gdGhpcy5zZXRBbGlnbmVkRWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKSA6IHRoaXMuc2V0RWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWFpblBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gcG9zaXRpb24uaW5kZXhPZignLScpID4gLTEgPyBwb3NpdGlvbi5zdWJzdHJpbmcoMCwgcG9zaXRpb24uaW5kZXhPZignLScpKSA6IHBvc2l0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNYWluUG9zaXRpb25zKCkge1xuICAgIGNvbnN0IGRlZmF1bHRNYWluUG9zaXRpb25zID0gWyd0b3AnLCAncmlnaHQnLCAnYm90dG9tJywgJ2xlZnQnXTtcblxuICAgIHJldHVybiB0aGlzLmN1c3RvbVBvc2l0aW9ucyAmJiB0aGlzLmN1c3RvbVBvc2l0aW9ucy5sZW5ndGhcbiAgICAgID8gdGhpcy5nZXRNYWluUG9zaXRpb25zQnlDdXN0b21Qb3NpdGlvbnModGhpcy5jdXN0b21Qb3NpdGlvbnMpXG4gICAgICA6IGRlZmF1bHRNYWluUG9zaXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNYWluUG9zaXRpb25zQnlDdXN0b21Qb3NpdGlvbnMoY3VzdG9tUG9zaXRpb25zOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgY29uc3QgbWFpblBvc2l0aW9ucyA9IFtdO1xuICAgIGNvbnN0IGN1c3RvbVBvc2l0aW9uc0xlbmd0aCA9IGN1c3RvbVBvc2l0aW9ucy5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1c3RvbVBvc2l0aW9uc0xlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGN1c3RvbVBvc2l0aW9uc1tpXTtcblxuICAgICAgY29uc3QgbWFpblBvc2l0aW9uID0gdGhpcy5nZXRNYWluUG9zaXRpb24ocG9zaXRpb24pO1xuXG4gICAgICBpZiAoIW1haW5Qb3NpdGlvbnMuaW5jbHVkZXMobWFpblBvc2l0aW9uKSkge1xuICAgICAgICBtYWluUG9zaXRpb25zLnB1c2gobWFpblBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWFpblBvc2l0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0T3ZlcmZsb3dzKCkge1xuICAgIGNvbnN0IHNpemVzQW5kUG9zaXRpb25zID0gdGhpcy5nZXRTaXplc0FuZFBvc2l0aW9ucygpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJpZ2h0OiBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LnJpZ2h0ID4gc2l6ZXNBbmRQb3NpdGlvbnMud2luZG93LmlubmVyV2lkdGgsXG4gICAgICB0b3A6IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQudG9wIDw9IDAsXG4gICAgICBsZWZ0OiBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmxlZnQgPD0gMCxcbiAgICAgIGJvdHRvbTogc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5ib3R0b20gPiBzaXplc0FuZFBvc2l0aW9ucy53aW5kb3cuaW5uZXJIZWlnaHRcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTaXplc0FuZFBvc2l0aW9ucygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgd2luZG93OiB7XG4gICAgICAgIHNjcm9sbFk6IHdpbmRvdy5zY3JvbGxZLFxuICAgICAgICBzY3JvbGxYOiB3aW5kb3cuc2Nyb2xsWCxcbiAgICAgICAgaW5uZXJXaWR0aDogd2luZG93LmlubmVyV2lkdGgsXG4gICAgICAgIGlubmVySGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICAgIH0sXG4gICAgICBlbGVtZW50OiB0aGlzLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICB0YXJnZXQ6IHRoaXMudGFyZ2V0RWxlbWVudCA/IHRoaXMudGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IHsgdG9wOiAwLCBib3R0b206IDAsIHJpZ2h0OiAwLCBsZWZ0OiAwIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBuZXh0UG9zaXRpb24ocG9zaXRpb246IHN0cmluZywgcG9zaXRpb25zOiBBcnJheTxzdHJpbmc+ID0gW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGluZGV4ID0gcG9zaXRpb25zLmluZGV4T2YocG9zaXRpb24pO1xuICAgIGNvbnN0IG5leHRJbmRleCA9IGluZGV4ICsgMTtcblxuICAgIGlmIChpbmRleCA+IC0xICYmIG5leHRJbmRleCA8IHBvc2l0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBwb3NpdGlvbnNbbmV4dEluZGV4XTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHBvc2l0aW9uc1swXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG92ZXJmbG93QWxsU2lkZXMocG9zaXRpb246IHN0cmluZykge1xuICAgIGNvbnN0IG92ZXJmbG93cyA9IHRoaXMuZ2V0T3ZlcmZsb3dzKCk7XG5cbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlICd0b3AnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnRvcCB8fCBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLmxlZnQ7XG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnRvcCB8fCBvdmVyZmxvd3MucmlnaHQ7XG4gICAgICBjYXNlICd0b3AtbGVmdCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MudG9wIHx8IG92ZXJmbG93cy5sZWZ0O1xuICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnJpZ2h0IHx8IG92ZXJmbG93cy50b3AgfHwgb3ZlcmZsb3dzLmJvdHRvbTtcbiAgICAgIGNhc2UgJ3JpZ2h0LXRvcCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLnRvcDtcbiAgICAgIGNhc2UgJ3JpZ2h0LWJvdHRvbSc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLmJvdHRvbTtcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MuYm90dG9tIHx8IG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MubGVmdDtcbiAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MuYm90dG9tIHx8IG92ZXJmbG93cy5yaWdodDtcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5ib3R0b20gfHwgb3ZlcmZsb3dzLmxlZnQ7XG4gICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy50b3AgfHwgb3ZlcmZsb3dzLmJvdHRvbTtcbiAgICAgIGNhc2UgJ2xlZnQtdG9wJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy50b3A7XG4gICAgICBjYXNlICdsZWZ0LWJvdHRvbSc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MubGVmdCB8fCBvdmVyZmxvd3MuYm90dG9tO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3ZlcmZsb3dNYWluKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICBjb25zdCBvdmVyZmxvd3MgPSB0aGlzLmdldE92ZXJmbG93cygpO1xuXG4gICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy50b3A7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQ7XG4gICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLmJvdHRvbTtcbiAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLmxlZnQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRBbGlnbmVkQXJyb3dEaXJlY3Rpb24oZWxlbWVudFBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICBzd2l0Y2ggKGVsZW1lbnRQb3NpdGlvbikge1xuICAgICAgY2FzZSAndG9wLWxlZnQnOlxuICAgICAgICByZXR1cm4gJ2JvdHRvbS1sZWZ0JztcbiAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XG4gICAgICAgIHJldHVybiAnYm90dG9tLXJpZ2h0JztcbiAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XG4gICAgICAgIHJldHVybiAndG9wLXJpZ2h0JztcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgcmV0dXJuICd0b3AtbGVmdCc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRBbGlnbmVkQm90dG9tUG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQuYm90dG9tICsgdGhpcy5lbGVtZW50T2Zmc2V0ICsgJ3B4JztcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0IC0gZGlzcGxhY2VtZW50ICsgJ3B4JztcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWxpZ25lZEVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXRFbGVtZW50V2lkdGgoKTtcblxuICAgIGNvbnN0IHNpemVzQW5kUG9zaXRpb25zOiBhbnkgPSB0aGlzLmdldFNpemVzQW5kUG9zaXRpb25zKCk7XG5cbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlICdib3R0b20tbGVmdCc6XG4gICAgICAgIHRoaXMuc2V0QWxpZ25lZEJvdHRvbVBvc2l0aW9ucygwLCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkQm90dG9tUG9zaXRpb25zKFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQud2lkdGggLSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQud2lkdGgsXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0b3AtbGVmdCc6XG4gICAgICAgIHRoaXMuc2V0QWxpZ25lZFRvcFBvc2l0aW9ucygwLCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkVG9wUG9zaXRpb25zKFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQud2lkdGggLSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQud2lkdGgsXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdGhpcy5hcnJvd0RpcmVjdGlvbiA9IHRoaXMuc2V0QWxpZ25lZEFycm93RGlyZWN0aW9uKHBvc2l0aW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWxpZ25lZFRvcFBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID1cbiAgICAgIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC50b3AgLSBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAtIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCAtIGRpc3BsYWNlbWVudCArICdweCc7XG4gIH1cblxuICBwcml2YXRlIHNldEFycm93RGlyZWN0aW9uKGVsZW1lbnRQb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgc3dpdGNoIChlbGVtZW50UG9zaXRpb24pIHtcbiAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgIHJldHVybiAnYm90dG9tJztcbiAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuICdib3R0b20tbGVmdCc7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIHJldHVybiAnbGVmdCc7XG4gICAgICBjYXNlICdyaWdodC10b3AnOlxuICAgICAgICByZXR1cm4gJ2xlZnQtYm90dG9tJztcbiAgICAgIGNhc2UgJ3JpZ2h0LWJvdHRvbSc6XG4gICAgICAgIHJldHVybiAnbGVmdC10b3AnO1xuICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgcmV0dXJuICd0b3AnO1xuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuICd0b3AtbGVmdCc7XG4gICAgICBjYXNlICdib3R0b20tbGVmdCc6XG4gICAgICAgIHJldHVybiAndG9wLXJpZ2h0JztcbiAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICByZXR1cm4gJ3JpZ2h0JztcbiAgICAgIGNhc2UgJ2xlZnQtYm90dG9tJzpcbiAgICAgICAgcmV0dXJuICdyaWdodC10b3AnO1xuICAgICAgY2FzZSAnbGVmdC10b3AnOlxuICAgICAgICByZXR1cm4gJ3JpZ2h0LWJvdHRvbSc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRCb3R0b21Qb3NpdGlvbnMoZGlzcGxhY2VtZW50OiBudW1iZXIsIHNpemVzQW5kUG9zaXRpb25zKSB7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5ib3R0b20gKyB0aGlzLmVsZW1lbnRPZmZzZXQgKyAncHgnO1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0ID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmxlZnQgKyBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQud2lkdGggLyAyIC0gZGlzcGxhY2VtZW50ICsgJ3B4JztcbiAgfVxuXG4gIHByaXZhdGUgc2V0RWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNldEVsZW1lbnRXaWR0aCgpO1xuXG4gICAgY29uc3Qgc2l6ZXNBbmRQb3NpdGlvbnMgPSB0aGlzLmdldFNpemVzQW5kUG9zaXRpb25zKCk7XG5cbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlICd0b3AnOlxuICAgICAgICB0aGlzLnNldFRvcFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LndpZHRoIC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgdGhpcy5zZXRUb3BQb3NpdGlvbnMoXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHRoaXMub2Zmc2V0QXJyb3cgLSB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdyxcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9uc1xuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XG4gICAgICAgIHRoaXMuc2V0VG9wUG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3cgKyB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdywgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgdGhpcy5zZXRSaWdodFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAvIDIsIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyaWdodC10b3AnOlxuICAgICAgICB0aGlzLnNldFJpZ2h0UG9zaXRpb25zKFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5vZmZzZXRBcnJvdyAtIHRoaXMuZGlmZmVyZW5jZURpYWdvbmFsVG9XaWR0aEFycm93LFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcbiAgICAgICAgdGhpcy5zZXRSaWdodFBvc2l0aW9ucyh0aGlzLm9mZnNldEFycm93LCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgdGhpcy5zZXRCb3R0b21Qb3NpdGlvbnMoc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAvIDIsIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxuICAgICAgICB0aGlzLnNldEJvdHRvbVBvc2l0aW9ucyh0aGlzLm9mZnNldEFycm93ICsgdGhpcy5kaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20tbGVmdCc6XG4gICAgICAgIHRoaXMuc2V0Qm90dG9tUG9zaXRpb25zKFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQud2lkdGggLSB0aGlzLm9mZnNldEFycm93IC0gdGhpcy5kaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3csXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgdGhpcy5zZXRMZWZ0UG9zaXRpb25zKHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2xlZnQtYm90dG9tJzpcbiAgICAgICAgdGhpcy5zZXRMZWZ0UG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdsZWZ0LXRvcCc6XG4gICAgICAgIHRoaXMuc2V0TGVmdFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAtIHRoaXMub2Zmc2V0QXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdGhpcy5hcnJvd0RpcmVjdGlvbiA9IHRoaXMuc2V0QXJyb3dEaXJlY3Rpb24ocG9zaXRpb24pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRFbGVtZW50V2lkdGgoKSB7XG4gICAgaWYgKHRoaXMuaXNTZXRFbGVtZW50V2lkdGggJiYgdGhpcy50YXJnZXRFbGVtZW50KSB7XG4gICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHt0aGlzLnRhcmdldEVsZW1lbnQuY2xpZW50V2lkdGh9cHhgO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0TGVmdFBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LnRvcCAtIGRpc3BsYWNlbWVudCArIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5oZWlnaHQgLyAyICsgJ3B4JztcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9XG4gICAgICBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCAtIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQud2lkdGggLSB0aGlzLmVsZW1lbnRPZmZzZXQgKyAncHgnO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSaWdodFBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LnRvcCAtIGRpc3BsYWNlbWVudCArIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5oZWlnaHQgLyAyICsgJ3B4JztcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5yaWdodCArIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XG4gIH1cblxuICBwcml2YXRlIHNldFRvcFBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID1cbiAgICAgIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC50b3AgLSBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAtIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCArIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCAvIDIgLSBkaXNwbGFjZW1lbnQgKyAncHgnO1xuICB9XG5cbiAgcHJpdmF0ZSB2ZXJpZnlTdWJQb3NpdGlvbnMocG9zaXRpb246IHN0cmluZykge1xuICAgIGlmIChwb3NpdGlvbi5pbmRleE9mKCctJykgPiAtMSkge1xuICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbi5zdWJzdHJpbmcoMCwgcG9zaXRpb24uaW5kZXhPZignLScpKTtcbiAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBsZXQgYWxpZ24gPSAwO1xuICAgIHdoaWxlIChhbGlnbisrIDwgMykge1xuICAgICAgaWYgKHRoaXMub3ZlcmZsb3dBbGxTaWRlcyhwb3NpdGlvbikpIHtcbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLm5leHRQb3NpdGlvbihwb3NpdGlvbiwgcG9Db250cm9sUG9zaXRpb25TaWRlc0RlZmF1bHQpO1xuICAgICAgICB0aGlzLmVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==