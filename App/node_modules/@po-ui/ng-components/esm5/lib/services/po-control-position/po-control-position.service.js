import { __decorate } from "tslib";
import { ElementRef, Injectable } from '@angular/core';
/**
 * @docsPrivate
 * @description
 *
 * Serviço responsável por gerenciar as posições de um elemento em relação a um elemento alvo. Ele pode receber as
 * seguintes posições:
 *
 * - `right`: Posiciona o elemento no lado direito do componente alvo.
 * - `right-bottom`: Posiciona o elemento no lado direito inferior do componente alvo.
 * - `right-top`: Posiciona o elemento no lado direito superior do componente alvo.
 * - `bottom`: Posiciona o elemento abaixo do componente alvo.
 * - `bottom-left`: Posiciona o elemento abaixo e à esquerda do componente alvo.
 * - `bottom-right`: Posiciona o elemento abaixo e à direita do componente alvo.
 * - `left`: Posiciona o elemento no lado esquerdo do componente alvo.
 * - `left-top`: Posiciona o elemento no lado esquerdo superior do componente alvo.
 * - `left-bottom`: Posiciona o elemento no lado esquerdo inferior do componente alvo.
 * - `top`: Posiciona o elemento acima do componente alvo.
 * - `top-right`: Posiciona o elemento acima e à direita do componente alvo.
 * - `top-left`: Posiciona o elemento acima e à esquerda do componente alvo.
 *
 * Caso o elemento não caiba na tela na posição indicada ele será rotacionado automaticamente para se adequar,
 * inicialmente no lado definido como padrão e em seguida seguindo o sentido horário.
 */
var poControlPositionSidesDefault = [
    'bottom',
    'bottom-left',
    'bottom-right',
    'left',
    'left-top',
    'left-bottom',
    'top',
    'top-right',
    'top-left',
    'right',
    'right-bottom',
    'right-top'
];
var PoControlPositionService = /** @class */ (function () {
    function PoControlPositionService() {
        this.differenceDiagonalToWidthArrow = 3;
        this.isSetElementWidth = false;
        // offset da seta em relação ao canto do componente
        this.offsetArrow = 12;
    }
    /**
     * @description Ajusta a posição do elemento, caso não couber em tela irá para próxima posição.
     *
     * @param value posição para exibição do elemento
     */
    PoControlPositionService.prototype.adjustPosition = function (value) {
        var position = value || 'bottom';
        this.elementPosition(position);
        this.customPositions && this.customPositions.length
            ? this.adjustCustomPosition(position)
            : this.adjustDefaultPosition(position);
    };
    /**
     * @description Retorna a direção da seta, conforme a posição do elemento.
     */
    PoControlPositionService.prototype.getArrowDirection = function () {
        return this.arrowDirection;
    };
    /**
     * @description Método responsável por definir as propriedades utilizadas para exibir o elemento na posição correta.
     *
     * @param element elemento que será exibido
     * @param elementOffset offSet do elemento
     * @param targetElement elemento de onde deve partir a exibição
     * @param customPositions posições que sobrescreve as posições padrões
     * @param isSetElementWidth indica se deve definir o tamanho do elemento a ser exibido, caso for verdadeiro será igual do targetElement
     * @param isCornerAligned indica se o elemento filho será alinhado nos cantos do elemneto pai.
     */
    PoControlPositionService.prototype.setElements = function (element, elementOffset, targetElement, customPositions, isSetElementWidth, isCornerAligned) {
        if (isSetElementWidth === void 0) { isSetElementWidth = false; }
        if (isCornerAligned === void 0) { isCornerAligned = false; }
        this.element = element instanceof ElementRef ? element.nativeElement : element;
        this.targetElement = targetElement instanceof ElementRef ? targetElement.nativeElement : targetElement;
        this.elementOffset = elementOffset;
        this.customPositions = customPositions;
        this.isSetElementWidth = isSetElementWidth;
        this.isCornerAligned = isCornerAligned;
    };
    PoControlPositionService.prototype.adjustCustomPosition = function (position) {
        var positionLength = this.customPositions.length;
        var sidesCount = 0;
        while (sidesCount++ < positionLength) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, this.customPositions);
                this.elementPosition(position);
            }
        }
    };
    PoControlPositionService.prototype.adjustDefaultPosition = function (position) {
        var mainPositions = this.getMainPositions();
        var mainPositionLength = mainPositions.length;
        var mainSidesCount = 0;
        while (mainSidesCount++ < mainPositionLength) {
            var mainPosition = this.getMainPosition(position);
            this.elementPosition(position);
            if (this.overflowMain(mainPosition)) {
                position = this.nextPosition(mainPosition, mainPositions);
                continue;
            }
            else if (this.overflowAllSides(position)) {
                this.verifySubPositions(position);
                return;
            }
            return;
        }
    };
    PoControlPositionService.prototype.elementPosition = function (position) {
        this.isCornerAligned ? this.setAlignedElementPosition(position) : this.setElementPosition(position);
    };
    PoControlPositionService.prototype.getMainPosition = function (position) {
        return position.indexOf('-') > -1 ? position.substring(0, position.indexOf('-')) : position;
    };
    PoControlPositionService.prototype.getMainPositions = function () {
        var defaultMainPositions = ['top', 'right', 'bottom', 'left'];
        return this.customPositions && this.customPositions.length
            ? this.getMainPositionsByCustomPositions(this.customPositions)
            : defaultMainPositions;
    };
    PoControlPositionService.prototype.getMainPositionsByCustomPositions = function (customPositions) {
        var mainPositions = [];
        var customPositionsLength = customPositions.length;
        for (var i = 0; i < customPositionsLength; i++) {
            var position = customPositions[i];
            var mainPosition = this.getMainPosition(position);
            if (!mainPositions.includes(mainPosition)) {
                mainPositions.push(mainPosition);
            }
        }
        return mainPositions;
    };
    PoControlPositionService.prototype.getOverflows = function () {
        var sizesAndPositions = this.getSizesAndPositions();
        return {
            right: sizesAndPositions.element.right > sizesAndPositions.window.innerWidth,
            top: sizesAndPositions.element.top <= 0,
            left: sizesAndPositions.element.left <= 0,
            bottom: sizesAndPositions.element.bottom > sizesAndPositions.window.innerHeight
        };
    };
    PoControlPositionService.prototype.getSizesAndPositions = function () {
        return {
            window: {
                scrollY: window.scrollY,
                scrollX: window.scrollX,
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight
            },
            element: this.element.getBoundingClientRect(),
            target: this.targetElement ? this.targetElement.getBoundingClientRect() : { top: 0, bottom: 0, right: 0, left: 0 }
        };
    };
    PoControlPositionService.prototype.nextPosition = function (position, positions) {
        if (positions === void 0) { positions = []; }
        var index = positions.indexOf(position);
        var nextIndex = index + 1;
        if (index > -1 && nextIndex < positions.length) {
            return positions[nextIndex];
        }
        else {
            return positions[0];
        }
    };
    PoControlPositionService.prototype.overflowAllSides = function (position) {
        var overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top || overflows.right || overflows.left;
            case 'top-right':
                return overflows.top || overflows.right;
            case 'top-left':
                return overflows.top || overflows.left;
            case 'right':
                return overflows.right || overflows.top || overflows.bottom;
            case 'right-top':
                return overflows.right || overflows.top;
            case 'right-bottom':
                return overflows.right || overflows.bottom;
            case 'bottom':
                return overflows.bottom || overflows.right || overflows.left;
            case 'bottom-right':
                return overflows.bottom || overflows.right;
            case 'bottom-left':
                return overflows.bottom || overflows.left;
            case 'left':
                return overflows.left || overflows.top || overflows.bottom;
            case 'left-top':
                return overflows.left || overflows.top;
            case 'left-bottom':
                return overflows.left || overflows.bottom;
        }
    };
    PoControlPositionService.prototype.overflowMain = function (position) {
        var overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top;
            case 'right':
                return overflows.right;
            case 'bottom':
                return overflows.bottom;
            case 'left':
                return overflows.left;
        }
    };
    PoControlPositionService.prototype.setAlignedArrowDirection = function (elementPosition) {
        switch (elementPosition) {
            case 'top-left':
                return 'bottom-left';
            case 'top-right':
                return 'bottom-right';
            case 'bottom-right':
                return 'top-right';
            case 'bottom-left':
                return 'top-left';
        }
    };
    PoControlPositionService.prototype.setAlignedBottomPositions = function (displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    };
    PoControlPositionService.prototype.setAlignedElementPosition = function (position) {
        this.setElementWidth();
        var sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'bottom-left':
                this.setAlignedBottomPositions(0, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setAlignedBottomPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
            case 'top-left':
                this.setAlignedTopPositions(0, sizesAndPositions);
                break;
            case 'top-right':
                this.setAlignedTopPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setAlignedArrowDirection(position);
    };
    PoControlPositionService.prototype.setAlignedTopPositions = function (displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    };
    PoControlPositionService.prototype.setArrowDirection = function (elementPosition) {
        switch (elementPosition) {
            case 'top':
                return 'bottom';
            case 'top-left':
                return 'bottom-right';
            case 'top-right':
                return 'bottom-left';
            case 'right':
                return 'left';
            case 'right-top':
                return 'left-bottom';
            case 'right-bottom':
                return 'left-top';
            case 'bottom':
                return 'top';
            case 'bottom-right':
                return 'top-left';
            case 'bottom-left':
                return 'top-right';
            case 'left':
                return 'right';
            case 'left-bottom':
                return 'right-top';
            case 'left-top':
                return 'right-bottom';
        }
    };
    PoControlPositionService.prototype.setBottomPositions = function (displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    };
    PoControlPositionService.prototype.setElementPosition = function (position) {
        this.setElementWidth();
        var sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'top':
                this.setTopPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'top-left':
                this.setTopPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'top-right':
                this.setTopPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right':
                this.setRightPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'right-top':
                this.setRightPositions(sizesAndPositions.element.height - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right-bottom':
                this.setRightPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'bottom':
                this.setBottomPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setBottomPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'bottom-left':
                this.setBottomPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'left':
                this.setLeftPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'left-bottom':
                this.setLeftPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'left-top':
                this.setLeftPositions(sizesAndPositions.element.height - this.offsetArrow, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setArrowDirection(position);
    };
    PoControlPositionService.prototype.setElementWidth = function () {
        if (this.isSetElementWidth && this.targetElement) {
            this.element.style.width = this.targetElement.clientWidth + "px";
        }
    };
    PoControlPositionService.prototype.setLeftPositions = function (displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left =
            sizesAndPositions.target.left - sizesAndPositions.element.width - this.elementOffset + 'px';
    };
    PoControlPositionService.prototype.setRightPositions = function (displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left = sizesAndPositions.target.right + this.elementOffset + 'px';
    };
    PoControlPositionService.prototype.setTopPositions = function (displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    };
    PoControlPositionService.prototype.verifySubPositions = function (position) {
        if (position.indexOf('-') > -1) {
            position = position.substring(0, position.indexOf('-'));
            this.elementPosition(position);
        }
        var align = 0;
        while (align++ < 3) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, poControlPositionSidesDefault);
                this.elementPosition(position);
            }
            else {
                return null;
            }
        }
    };
    PoControlPositionService = __decorate([
        Injectable()
    ], PoControlPositionService);
    return PoControlPositionService;
}());
export { PoControlPositionService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY29udHJvbC1wb3NpdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcG8tY29udHJvbC1wb3NpdGlvbi9wby1jb250cm9sLXBvc2l0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBc0JHO0FBRUgsSUFBTSw2QkFBNkIsR0FBa0I7SUFDbkQsUUFBUTtJQUNSLGFBQWE7SUFDYixjQUFjO0lBQ2QsTUFBTTtJQUNOLFVBQVU7SUFDVixhQUFhO0lBQ2IsS0FBSztJQUNMLFdBQVc7SUFDWCxVQUFVO0lBQ1YsT0FBTztJQUNQLGNBQWM7SUFDZCxXQUFXO0NBQ1osQ0FBQztBQUdGO0lBQUE7UUFHVSxtQ0FBOEIsR0FBVyxDQUFDLENBQUM7UUFJM0Msc0JBQWlCLEdBQVksS0FBSyxDQUFDO1FBQzNDLG1EQUFtRDtRQUMzQyxnQkFBVyxHQUFXLEVBQUUsQ0FBQztJQThYbkMsQ0FBQztJQTNYQzs7OztPQUlHO0lBQ0gsaURBQWMsR0FBZCxVQUFlLEtBQWE7UUFDMUIsSUFBTSxRQUFRLEdBQUcsS0FBSyxJQUFJLFFBQVEsQ0FBQztRQUNuQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNO1lBQ2pELENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDO1lBQ3JDLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsb0RBQWlCLEdBQWpCO1FBQ0UsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzdC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QyxDQUFDLEVBQUU7WUFDOUIsUUFBUSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDbEIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQ25DLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO2dCQUN0RSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ2hDO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDO2FBQ2I7U0FDRjtJQUNILENBQUM7SUF0WVUsd0JBQXdCO1FBRHBDLFVBQVUsRUFBRTtPQUNBLHdCQUF3QixDQXVZcEM7SUFBRCwrQkFBQztDQUFBLEFBdllELElBdVlDO1NBdllZLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuLyoqXG4gKiBAZG9jc1ByaXZhdGVcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIFNlcnZpw6dvIHJlc3BvbnPDoXZlbCBwb3IgZ2VyZW5jaWFyIGFzIHBvc2nDp8O1ZXMgZGUgdW0gZWxlbWVudG8gZW0gcmVsYcOnw6NvIGEgdW0gZWxlbWVudG8gYWx2by4gRWxlIHBvZGUgcmVjZWJlciBhc1xuICogc2VndWludGVzIHBvc2nDp8O1ZXM6XG4gKlxuICogLSBgcmlnaHRgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBubyBsYWRvIGRpcmVpdG8gZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgcmlnaHQtYm90dG9tYDogUG9zaWNpb25hIG8gZWxlbWVudG8gbm8gbGFkbyBkaXJlaXRvIGluZmVyaW9yIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYHJpZ2h0LXRvcGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZGlyZWl0byBzdXBlcmlvciBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGBib3R0b21gOiBQb3NpY2lvbmEgbyBlbGVtZW50byBhYmFpeG8gZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgYm90dG9tLWxlZnRgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBhYmFpeG8gZSDDoCBlc3F1ZXJkYSBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGBib3R0b20tcmlnaHRgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBhYmFpeG8gZSDDoCBkaXJlaXRhIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYGxlZnRgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBubyBsYWRvIGVzcXVlcmRvIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYGxlZnQtdG9wYDogUG9zaWNpb25hIG8gZWxlbWVudG8gbm8gbGFkbyBlc3F1ZXJkbyBzdXBlcmlvciBkbyBjb21wb25lbnRlIGFsdm8uXG4gKiAtIGBsZWZ0LWJvdHRvbWA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZXNxdWVyZG8gaW5mZXJpb3IgZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgdG9wYDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWNpbWEgZG8gY29tcG9uZW50ZSBhbHZvLlxuICogLSBgdG9wLXJpZ2h0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWNpbWEgZSDDoCBkaXJlaXRhIGRvIGNvbXBvbmVudGUgYWx2by5cbiAqIC0gYHRvcC1sZWZ0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWNpbWEgZSDDoCBlc3F1ZXJkYSBkbyBjb21wb25lbnRlIGFsdm8uXG4gKlxuICogQ2FzbyBvIGVsZW1lbnRvIG7Do28gY2FpYmEgbmEgdGVsYSBuYSBwb3Npw6fDo28gaW5kaWNhZGEgZWxlIHNlcsOhIHJvdGFjaW9uYWRvIGF1dG9tYXRpY2FtZW50ZSBwYXJhIHNlIGFkZXF1YXIsXG4gKiBpbmljaWFsbWVudGUgbm8gbGFkbyBkZWZpbmlkbyBjb21vIHBhZHLDo28gZSBlbSBzZWd1aWRhIHNlZ3VpbmRvIG8gc2VudGlkbyBob3LDoXJpby5cbiAqL1xuXG5jb25zdCBwb0NvbnRyb2xQb3NpdGlvblNpZGVzRGVmYXVsdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgJ2JvdHRvbScsXG4gICdib3R0b20tbGVmdCcsXG4gICdib3R0b20tcmlnaHQnLFxuICAnbGVmdCcsXG4gICdsZWZ0LXRvcCcsXG4gICdsZWZ0LWJvdHRvbScsXG4gICd0b3AnLFxuICAndG9wLXJpZ2h0JyxcbiAgJ3RvcC1sZWZ0JyxcbiAgJ3JpZ2h0JyxcbiAgJ3JpZ2h0LWJvdHRvbScsXG4gICdyaWdodC10b3AnXG5dO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUG9Db250cm9sUG9zaXRpb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhcnJvd0RpcmVjdGlvbjogc3RyaW5nO1xuICBwcml2YXRlIGN1c3RvbVBvc2l0aW9uczogQXJyYXk8c3RyaW5nPjtcbiAgcHJpdmF0ZSBkaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3c6IG51bWJlciA9IDM7XG4gIHByaXZhdGUgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgZWxlbWVudE9mZnNldDogbnVtYmVyO1xuICBwcml2YXRlIGlzQ29ybmVyQWxpZ25lZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBpc1NldEVsZW1lbnRXaWR0aDogYm9vbGVhbiA9IGZhbHNlO1xuICAvLyBvZmZzZXQgZGEgc2V0YSBlbSByZWxhw6fDo28gYW8gY2FudG8gZG8gY29tcG9uZW50ZVxuICBwcml2YXRlIG9mZnNldEFycm93OiBudW1iZXIgPSAxMjtcbiAgcHJpdmF0ZSB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudDtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIEFqdXN0YSBhIHBvc2nDp8OjbyBkbyBlbGVtZW50bywgY2FzbyBuw6NvIGNvdWJlciBlbSB0ZWxhIGlyw6EgcGFyYSBwcsOzeGltYSBwb3Npw6fDo28uXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBwb3Npw6fDo28gcGFyYSBleGliacOnw6NvIGRvIGVsZW1lbnRvXG4gICAqL1xuICBhZGp1c3RQb3NpdGlvbih2YWx1ZTogc3RyaW5nKSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB2YWx1ZSB8fCAnYm90dG9tJztcbiAgICB0aGlzLmVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgdGhpcy5jdXN0b21Qb3NpdGlvbnMgJiYgdGhpcy5jdXN0b21Qb3NpdGlvbnMubGVuZ3RoXG4gICAgICA/IHRoaXMuYWRqdXN0Q3VzdG9tUG9zaXRpb24ocG9zaXRpb24pXG4gICAgICA6IHRoaXMuYWRqdXN0RGVmYXVsdFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmV0b3JuYSBhIGRpcmXDp8OjbyBkYSBzZXRhLCBjb25mb3JtZSBhIHBvc2nDp8OjbyBkbyBlbGVtZW50by5cbiAgICovXG4gIGdldEFycm93RGlyZWN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmFycm93RGlyZWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgZGVmaW5pciBhcyBwcm9wcmllZGFkZXMgdXRpbGl6YWRhcyBwYXJhIGV4aWJpciBvIGVsZW1lbnRvIG5hIHBvc2nDp8OjbyBjb3JyZXRhLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBlbGVtZW50byBxdWUgc2Vyw6EgZXhpYmlkb1xuICAgKiBAcGFyYW0gZWxlbWVudE9mZnNldCBvZmZTZXQgZG8gZWxlbWVudG9cbiAgICogQHBhcmFtIHRhcmdldEVsZW1lbnQgZWxlbWVudG8gZGUgb25kZSBkZXZlIHBhcnRpciBhIGV4aWJpw6fDo29cbiAgICogQHBhcmFtIGN1c3RvbVBvc2l0aW9ucyBwb3Npw6fDtWVzIHF1ZSBzb2JyZXNjcmV2ZSBhcyBwb3Npw6fDtWVzIHBhZHLDtWVzXG4gICAqIEBwYXJhbSBpc1NldEVsZW1lbnRXaWR0aCBpbmRpY2Egc2UgZGV2ZSBkZWZpbmlyIG8gdGFtYW5obyBkbyBlbGVtZW50byBhIHNlciBleGliaWRvLCBjYXNvIGZvciB2ZXJkYWRlaXJvIHNlcsOhIGlndWFsIGRvIHRhcmdldEVsZW1lbnRcbiAgICogQHBhcmFtIGlzQ29ybmVyQWxpZ25lZCBpbmRpY2Egc2UgbyBlbGVtZW50byBmaWxobyBzZXLDoSBhbGluaGFkbyBub3MgY2FudG9zIGRvIGVsZW1uZXRvIHBhaS5cbiAgICovXG4gIHNldEVsZW1lbnRzKFxuICAgIGVsZW1lbnQ6IEVsZW1lbnRSZWYgfCBIVE1MRWxlbWVudCxcbiAgICBlbGVtZW50T2Zmc2V0OiBudW1iZXIsXG4gICAgdGFyZ2V0RWxlbWVudDogRWxlbWVudFJlZiB8IEhUTUxFbGVtZW50LFxuICAgIGN1c3RvbVBvc2l0aW9ucz86IEFycmF5PHN0cmluZz4sXG4gICAgaXNTZXRFbGVtZW50V2lkdGg6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBpc0Nvcm5lckFsaWduZWQ6IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudFJlZiA/IGVsZW1lbnQubmF0aXZlRWxlbWVudCA6IGVsZW1lbnQ7XG4gICAgdGhpcy50YXJnZXRFbGVtZW50ID0gdGFyZ2V0RWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYgPyB0YXJnZXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQgOiB0YXJnZXRFbGVtZW50O1xuXG4gICAgdGhpcy5lbGVtZW50T2Zmc2V0ID0gZWxlbWVudE9mZnNldDtcblxuICAgIHRoaXMuY3VzdG9tUG9zaXRpb25zID0gY3VzdG9tUG9zaXRpb25zO1xuICAgIHRoaXMuaXNTZXRFbGVtZW50V2lkdGggPSBpc1NldEVsZW1lbnRXaWR0aDtcbiAgICB0aGlzLmlzQ29ybmVyQWxpZ25lZCA9IGlzQ29ybmVyQWxpZ25lZDtcbiAgfVxuXG4gIHByaXZhdGUgYWRqdXN0Q3VzdG9tUG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIGNvbnN0IHBvc2l0aW9uTGVuZ3RoID0gdGhpcy5jdXN0b21Qb3NpdGlvbnMubGVuZ3RoO1xuXG4gICAgbGV0IHNpZGVzQ291bnQgPSAwO1xuXG4gICAgd2hpbGUgKHNpZGVzQ291bnQrKyA8IHBvc2l0aW9uTGVuZ3RoKSB7XG4gICAgICBpZiAodGhpcy5vdmVyZmxvd0FsbFNpZGVzKHBvc2l0aW9uKSkge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMubmV4dFBvc2l0aW9uKHBvc2l0aW9uLCB0aGlzLmN1c3RvbVBvc2l0aW9ucyk7XG4gICAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFkanVzdERlZmF1bHRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgY29uc3QgbWFpblBvc2l0aW9ucyA9IHRoaXMuZ2V0TWFpblBvc2l0aW9ucygpO1xuICAgIGNvbnN0IG1haW5Qb3NpdGlvbkxlbmd0aCA9IG1haW5Qb3NpdGlvbnMubGVuZ3RoO1xuXG4gICAgbGV0IG1haW5TaWRlc0NvdW50ID0gMDtcblxuICAgIHdoaWxlIChtYWluU2lkZXNDb3VudCsrIDwgbWFpblBvc2l0aW9uTGVuZ3RoKSB7XG4gICAgICBjb25zdCBtYWluUG9zaXRpb24gPSB0aGlzLmdldE1haW5Qb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICB0aGlzLmVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbik7XG5cbiAgICAgIGlmICh0aGlzLm92ZXJmbG93TWFpbihtYWluUG9zaXRpb24pKSB7XG4gICAgICAgIHBvc2l0aW9uID0gdGhpcy5uZXh0UG9zaXRpb24obWFpblBvc2l0aW9uLCBtYWluUG9zaXRpb25zKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3ZlcmZsb3dBbGxTaWRlcyhwb3NpdGlvbikpIHtcbiAgICAgICAgdGhpcy52ZXJpZnlTdWJQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgdGhpcy5pc0Nvcm5lckFsaWduZWQgPyB0aGlzLnNldEFsaWduZWRFbGVtZW50UG9zaXRpb24ocG9zaXRpb24pIDogdGhpcy5zZXRFbGVtZW50UG9zaXRpb24ocG9zaXRpb24pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNYWluUG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIHJldHVybiBwb3NpdGlvbi5pbmRleE9mKCctJykgPiAtMSA/IHBvc2l0aW9uLnN1YnN0cmluZygwLCBwb3NpdGlvbi5pbmRleE9mKCctJykpIDogcG9zaXRpb247XG4gIH1cblxuICBwcml2YXRlIGdldE1haW5Qb3NpdGlvbnMoKSB7XG4gICAgY29uc3QgZGVmYXVsdE1haW5Qb3NpdGlvbnMgPSBbJ3RvcCcsICdyaWdodCcsICdib3R0b20nLCAnbGVmdCddO1xuXG4gICAgcmV0dXJuIHRoaXMuY3VzdG9tUG9zaXRpb25zICYmIHRoaXMuY3VzdG9tUG9zaXRpb25zLmxlbmd0aFxuICAgICAgPyB0aGlzLmdldE1haW5Qb3NpdGlvbnNCeUN1c3RvbVBvc2l0aW9ucyh0aGlzLmN1c3RvbVBvc2l0aW9ucylcbiAgICAgIDogZGVmYXVsdE1haW5Qb3NpdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGdldE1haW5Qb3NpdGlvbnNCeUN1c3RvbVBvc2l0aW9ucyhjdXN0b21Qb3NpdGlvbnM6IEFycmF5PHN0cmluZz4pIHtcbiAgICBjb25zdCBtYWluUG9zaXRpb25zID0gW107XG4gICAgY29uc3QgY3VzdG9tUG9zaXRpb25zTGVuZ3RoID0gY3VzdG9tUG9zaXRpb25zLmxlbmd0aDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VzdG9tUG9zaXRpb25zTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3VzdG9tUG9zaXRpb25zW2ldO1xuXG4gICAgICBjb25zdCBtYWluUG9zaXRpb24gPSB0aGlzLmdldE1haW5Qb3NpdGlvbihwb3NpdGlvbik7XG5cbiAgICAgIGlmICghbWFpblBvc2l0aW9ucy5pbmNsdWRlcyhtYWluUG9zaXRpb24pKSB7XG4gICAgICAgIG1haW5Qb3NpdGlvbnMucHVzaChtYWluUG9zaXRpb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYWluUG9zaXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRPdmVyZmxvd3MoKSB7XG4gICAgY29uc3Qgc2l6ZXNBbmRQb3NpdGlvbnMgPSB0aGlzLmdldFNpemVzQW5kUG9zaXRpb25zKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmlnaHQ6IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQucmlnaHQgPiBzaXplc0FuZFBvc2l0aW9ucy53aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgIHRvcDogc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC50b3AgPD0gMCxcbiAgICAgIGxlZnQ6IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQubGVmdCA8PSAwLFxuICAgICAgYm90dG9tOiBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmJvdHRvbSA+IHNpemVzQW5kUG9zaXRpb25zLndpbmRvdy5pbm5lckhlaWdodFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFNpemVzQW5kUG9zaXRpb25zKCkge1xuICAgIHJldHVybiB7XG4gICAgICB3aW5kb3c6IHtcbiAgICAgICAgc2Nyb2xsWTogd2luZG93LnNjcm9sbFksXG4gICAgICAgIHNjcm9sbFg6IHdpbmRvdy5zY3JvbGxYLFxuICAgICAgICBpbm5lcldpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgICAgaW5uZXJIZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodFxuICAgICAgfSxcbiAgICAgIGVsZW1lbnQ6IHRoaXMuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgIHRhcmdldDogdGhpcy50YXJnZXRFbGVtZW50ID8gdGhpcy50YXJnZXRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogeyB0b3A6IDAsIGJvdHRvbTogMCwgcmlnaHQ6IDAsIGxlZnQ6IDAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIG5leHRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nLCBwb3NpdGlvbnM6IEFycmF5PHN0cmluZz4gPSBbXSk6IHN0cmluZyB7XG4gICAgY29uc3QgaW5kZXggPSBwb3NpdGlvbnMuaW5kZXhPZihwb3NpdGlvbik7XG4gICAgY29uc3QgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuXG4gICAgaWYgKGluZGV4ID4gLTEgJiYgbmV4dEluZGV4IDwgcG9zaXRpb25zLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHBvc2l0aW9uc1tuZXh0SW5kZXhdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcG9zaXRpb25zWzBdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3ZlcmZsb3dBbGxTaWRlcyhwb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgY29uc3Qgb3ZlcmZsb3dzID0gdGhpcy5nZXRPdmVyZmxvd3MoKTtcblxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MudG9wIHx8IG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MubGVmdDtcbiAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MudG9wIHx8IG92ZXJmbG93cy5yaWdodDtcbiAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy50b3AgfHwgb3ZlcmZsb3dzLmxlZnQ7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLnRvcCB8fCBvdmVyZmxvd3MuYm90dG9tO1xuICAgICAgY2FzZSAncmlnaHQtdG9wJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MudG9wO1xuICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MuYm90dG9tO1xuICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5ib3R0b20gfHwgb3ZlcmZsb3dzLnJpZ2h0IHx8IG92ZXJmbG93cy5sZWZ0O1xuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5ib3R0b20gfHwgb3ZlcmZsb3dzLnJpZ2h0O1xuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLmJvdHRvbSB8fCBvdmVyZmxvd3MubGVmdDtcbiAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLmxlZnQgfHwgb3ZlcmZsb3dzLnRvcCB8fCBvdmVyZmxvd3MuYm90dG9tO1xuICAgICAgY2FzZSAnbGVmdC10b3AnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLmxlZnQgfHwgb3ZlcmZsb3dzLnRvcDtcbiAgICAgIGNhc2UgJ2xlZnQtYm90dG9tJzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy5ib3R0b207XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvdmVyZmxvd01haW4ocG9zaXRpb246IHN0cmluZykge1xuICAgIGNvbnN0IG92ZXJmbG93cyA9IHRoaXMuZ2V0T3ZlcmZsb3dzKCk7XG5cbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlICd0b3AnOlxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnRvcDtcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5yaWdodDtcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MuYm90dG9tO1xuICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MubGVmdDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEFsaWduZWRBcnJvd0RpcmVjdGlvbihlbGVtZW50UG9zaXRpb246IHN0cmluZykge1xuICAgIHN3aXRjaCAoZWxlbWVudFBvc2l0aW9uKSB7XG4gICAgICBjYXNlICd0b3AtbGVmdCc6XG4gICAgICAgIHJldHVybiAnYm90dG9tLWxlZnQnO1xuICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgcmV0dXJuICd0b3AtcmlnaHQnO1xuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxuICAgICAgICByZXR1cm4gJ3RvcC1sZWZ0JztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEFsaWduZWRCb3R0b21Qb3NpdGlvbnMoZGlzcGxhY2VtZW50OiBudW1iZXIsIHNpemVzQW5kUG9zaXRpb25zKSB7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5ib3R0b20gKyB0aGlzLmVsZW1lbnRPZmZzZXQgKyAncHgnO1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0ID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmxlZnQgLSBkaXNwbGFjZW1lbnQgKyAncHgnO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRBbGlnbmVkRWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNldEVsZW1lbnRXaWR0aCgpO1xuXG4gICAgY29uc3Qgc2l6ZXNBbmRQb3NpdGlvbnM6IGFueSA9IHRoaXMuZ2V0U2l6ZXNBbmRQb3NpdGlvbnMoKTtcblxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkQm90dG9tUG9zaXRpb25zKDAsIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxuICAgICAgICB0aGlzLnNldEFsaWduZWRCb3R0b21Qb3NpdGlvbnMoXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCxcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9uc1xuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkVG9wUG9zaXRpb25zKDAsIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxuICAgICAgICB0aGlzLnNldEFsaWduZWRUb3BQb3NpdGlvbnMoXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCxcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9uc1xuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLmFycm93RGlyZWN0aW9uID0gdGhpcy5zZXRBbGlnbmVkQXJyb3dEaXJlY3Rpb24ocG9zaXRpb24pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRBbGlnbmVkVG9wUG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPVxuICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LnRvcCAtIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5lbGVtZW50T2Zmc2V0ICsgJ3B4JztcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0IC0gZGlzcGxhY2VtZW50ICsgJ3B4JztcbiAgfVxuXG4gIHByaXZhdGUgc2V0QXJyb3dEaXJlY3Rpb24oZWxlbWVudFBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICBzd2l0Y2ggKGVsZW1lbnRQb3NpdGlvbikge1xuICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgcmV0dXJuICdib3R0b20nO1xuICAgICAgY2FzZSAndG9wLWxlZnQnOlxuICAgICAgICByZXR1cm4gJ2JvdHRvbS1yaWdodCc7XG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxuICAgICAgICByZXR1cm4gJ2JvdHRvbS1sZWZ0JztcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgcmV0dXJuICdsZWZ0JztcbiAgICAgIGNhc2UgJ3JpZ2h0LXRvcCc6XG4gICAgICAgIHJldHVybiAnbGVmdC1ib3R0b20nO1xuICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcbiAgICAgICAgcmV0dXJuICdsZWZ0LXRvcCc7XG4gICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICByZXR1cm4gJ3RvcCc7XG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxuICAgICAgICByZXR1cm4gJ3RvcC1sZWZ0JztcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgcmV0dXJuICd0b3AtcmlnaHQnO1xuICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgIHJldHVybiAncmlnaHQnO1xuICAgICAgY2FzZSAnbGVmdC1ib3R0b20nOlxuICAgICAgICByZXR1cm4gJ3JpZ2h0LXRvcCc7XG4gICAgICBjYXNlICdsZWZ0LXRvcCc6XG4gICAgICAgIHJldHVybiAncmlnaHQtYm90dG9tJztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEJvdHRvbVBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmJvdHRvbSArIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCArIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCAvIDIgLSBkaXNwbGFjZW1lbnQgKyAncHgnO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRFbGVtZW50UG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIHRoaXMuc2V0RWxlbWVudFdpZHRoKCk7XG5cbiAgICBjb25zdCBzaXplc0FuZFBvc2l0aW9ucyA9IHRoaXMuZ2V0U2l6ZXNBbmRQb3NpdGlvbnMoKTtcblxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgIHRoaXMuc2V0VG9wUG9zaXRpb25zKHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQud2lkdGggLyAyLCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndG9wLWxlZnQnOlxuICAgICAgICB0aGlzLnNldFRvcFBvc2l0aW9ucyhcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LndpZHRoIC0gdGhpcy5vZmZzZXRBcnJvdyAtIHRoaXMuZGlmZmVyZW5jZURpYWdvbmFsVG9XaWR0aEFycm93LFxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgdGhpcy5zZXRUb3BQb3NpdGlvbnModGhpcy5vZmZzZXRBcnJvdyArIHRoaXMuZGlmZmVyZW5jZURpYWdvbmFsVG9XaWR0aEFycm93LCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICB0aGlzLnNldFJpZ2h0UG9zaXRpb25zKHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JpZ2h0LXRvcCc6XG4gICAgICAgIHRoaXMuc2V0UmlnaHRQb3NpdGlvbnMoXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5oZWlnaHQgLSB0aGlzLm9mZnNldEFycm93IC0gdGhpcy5kaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3csXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyaWdodC1ib3R0b20nOlxuICAgICAgICB0aGlzLnNldFJpZ2h0UG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICB0aGlzLnNldEJvdHRvbVBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LndpZHRoIC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XG4gICAgICAgIHRoaXMuc2V0Qm90dG9tUG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3cgKyB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdywgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgdGhpcy5zZXRCb3R0b21Qb3NpdGlvbnMoXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHRoaXMub2Zmc2V0QXJyb3cgLSB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdyxcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9uc1xuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbnMoc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5oZWlnaHQgLyAyLCBzaXplc0FuZFBvc2l0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnbGVmdC1ib3R0b20nOlxuICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbnModGhpcy5vZmZzZXRBcnJvdywgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2xlZnQtdG9wJzpcbiAgICAgICAgdGhpcy5zZXRMZWZ0UG9zaXRpb25zKHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5vZmZzZXRBcnJvdywgc2l6ZXNBbmRQb3NpdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLmFycm93RGlyZWN0aW9uID0gdGhpcy5zZXRBcnJvd0RpcmVjdGlvbihwb3NpdGlvbik7XG4gIH1cblxuICBwcml2YXRlIHNldEVsZW1lbnRXaWR0aCgpIHtcbiAgICBpZiAodGhpcy5pc1NldEVsZW1lbnRXaWR0aCAmJiB0aGlzLnRhcmdldEVsZW1lbnQpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IGAke3RoaXMudGFyZ2V0RWxlbWVudC5jbGllbnRXaWR0aH1weGA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRMZWZ0UG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQudG9wIC0gZGlzcGxhY2VtZW50ICsgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmhlaWdodCAvIDIgKyAncHgnO1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0ID1cbiAgICAgIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0IC0gc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XG4gIH1cblxuICBwcml2YXRlIHNldFJpZ2h0UG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQudG9wIC0gZGlzcGxhY2VtZW50ICsgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmhlaWdodCAvIDIgKyAncHgnO1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0ID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LnJpZ2h0ICsgdGhpcy5lbGVtZW50T2Zmc2V0ICsgJ3B4JztcbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9wUG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPVxuICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LnRvcCAtIHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5lbGVtZW50T2Zmc2V0ICsgJ3B4JztcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0ICsgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LndpZHRoIC8gMiAtIGRpc3BsYWNlbWVudCArICdweCc7XG4gIH1cblxuICBwcml2YXRlIHZlcmlmeVN1YlBvc2l0aW9ucyhwb3NpdGlvbjogc3RyaW5nKSB7XG4gICAgaWYgKHBvc2l0aW9uLmluZGV4T2YoJy0nKSA+IC0xKSB7XG4gICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uLnN1YnN0cmluZygwLCBwb3NpdGlvbi5pbmRleE9mKCctJykpO1xuICAgICAgdGhpcy5lbGVtZW50UG9zaXRpb24ocG9zaXRpb24pO1xuICAgIH1cblxuICAgIGxldCBhbGlnbiA9IDA7XG4gICAgd2hpbGUgKGFsaWduKysgPCAzKSB7XG4gICAgICBpZiAodGhpcy5vdmVyZmxvd0FsbFNpZGVzKHBvc2l0aW9uKSkge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMubmV4dFBvc2l0aW9uKHBvc2l0aW9uLCBwb0NvbnRyb2xQb3NpdGlvblNpZGVzRGVmYXVsdCk7XG4gICAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19