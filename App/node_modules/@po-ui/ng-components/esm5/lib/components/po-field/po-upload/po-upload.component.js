import { __decorate, __extends, __metadata, __read, __rest, __spread } from "tslib";
import { Component, ElementRef, forwardRef, Renderer2, ViewChild, AfterViewInit } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { formatBytes, isMobile } from '../../../utils/util';
import { PoButtonComponent } from './../../po-button/po-button.component';
import { PoI18nPipe } from '../../../services/po-i18n/po-i18n.pipe';
import { PoNotificationService } from '../../../services/po-notification/po-notification.service';
import { PoProgressStatus } from '../../po-progress/enums/po-progress-status.enum';
import { PoUploadBaseComponent } from './po-upload-base.component';
import { PoUploadDragDropComponent } from './po-upload-drag-drop/po-upload-drag-drop.component';
import { PoUploadService } from './po-upload.service';
import { PoUploadStatus } from './po-upload-status.enum';
/**
 * @docsExtends PoUploadBaseComponent
 *
 * @example
 *
 * <example name="po-upload-basic" title="PO Upload Basic">
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.html"> </file>
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-labs" title="PO Upload Labs">
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.html"> </file>
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-resume" title="PO Upload - Resume">
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.html"> </file>
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-rs" title="PO Upload - Realize & Show">
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.html"> </file>
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.ts"> </file>
 * </example>
 */
var PoUploadComponent = /** @class */ (function (_super) {
    __extends(PoUploadComponent, _super);
    function PoUploadComponent(uploadService, renderer, i18nPipe, notification) {
        var _a, _b;
        var _this = _super.call(this, uploadService) || this;
        _this.renderer = renderer;
        _this.i18nPipe = i18nPipe;
        _this.notification = notification;
        _this.infoByUploadStatus = (_a = {},
            _a[PoUploadStatus.Uploaded] = {
                text: function () { return _this.literals.sentWithSuccess; },
                icon: 'po-icon-ok'
            },
            _a[PoUploadStatus.Error] = {
                text: function () { return _this.literals.errorOccurred; }
            },
            _a[PoUploadStatus.Uploading] = {
                text: function (percent) { return percent + '%'; }
            },
            _a);
        _this.progressStatusByFileStatus = (_b = {},
            _b[PoUploadStatus.Uploaded] = PoProgressStatus.Success,
            _b[PoUploadStatus.Error] = PoProgressStatus.Error,
            _b);
        _this.calledByCleanInputValue = false;
        return _this;
    }
    PoUploadComponent_1 = PoUploadComponent;
    Object.defineProperty(PoUploadComponent.prototype, "displayDragDrop", {
        get: function () {
            return this.dragDrop && !isMobile();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "displaySendButton", {
        get: function () {
            var currentFiles = this.currentFiles || [];
            return !this.hideSendButton && !this.autoUpload && currentFiles.length > 0 && this.hasFileNotUploaded;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "selectFileButtonLabel", {
        get: function () {
            if (this.canHandleDirectory) {
                return this.literals.selectFolder;
            }
            else if (this.isMultiple) {
                return this.literals.selectFiles;
            }
            else {
                return this.literals.selectFile;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasMoreThanFourItems", {
        get: function () {
            return this.currentFiles && this.currentFiles.length > 4;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasMultipleFiles", {
        get: function () {
            return this.currentFiles && this.currentFiles.length > 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasFileNotUploaded", {
        get: function () {
            if (Array.isArray(this.currentFiles)) {
                return this.currentFiles.some(function (file) { return file.status !== PoUploadStatus.Uploaded; });
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "isDisabled", {
        get: function () {
            var currentFiles = this.currentFiles || [];
            return !!(this.hasAnyFileUploading(currentFiles) ||
                !this.url ||
                this.disabled ||
                this.isExceededFileLimit(currentFiles.length));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "maxFiles", {
        get: function () {
            return this.isMultiple && this.fileRestrictions && this.fileRestrictions.maxFiles;
        },
        enumerable: true,
        configurable: true
    });
    PoUploadComponent.prototype.cancel = function (file) {
        if (file.status === PoUploadStatus.Uploading) {
            return this.stopUpload(file);
        }
        this.removeFile(file);
    };
    PoUploadComponent.prototype.ngAfterViewInit = function () {
        if (this.autoFocus) {
            this.focus();
        }
    };
    /** Método responsável por **limpar** o(s) arquivo(s) selecionado(s). */
    PoUploadComponent.prototype.clear = function () {
        this.currentFiles = undefined;
        this.updateModel([]);
        this.cleanInputValue();
    };
    /**
     * Função que atribui foco ao componente.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoUploadComponent } from '@po-ui/ng-components';
     *
     * ...
     *
     * @ViewChild(PoUploadComponent, { static: true }) upload: PoUploadComponent;
     *
     * focusUpload() {
     *   this.upload.focus();
     * }
     * ```
     */
    PoUploadComponent.prototype.focus = function () {
        if (!this.disabled) {
            if (this.uploadButton) {
                this.uploadButton.focus();
                return;
            }
            if (this.displayDragDrop) {
                this.poUploadDragDropComponent.focus();
            }
        }
    };
    // Verifica se existe algum arquivo sendo enviado ao serviço.
    PoUploadComponent.prototype.hasAnyFileUploading = function (files) {
        if (files && files.length) {
            return files.some(function (file) { return file.status === PoUploadStatus.Uploading; });
        }
        return false;
    };
    // retorna se o status do arquivo é diferente de enviado
    PoUploadComponent.prototype.isAllowCancelEvent = function (status) {
        return status !== PoUploadStatus.Uploaded;
    };
    // Função disparada ao selecionar algum arquivo.
    PoUploadComponent.prototype.onFileChange = function (event) {
        // necessário este tratamento quando para IE, pois nele o change é disparado quando o campo é limpado também
        if (this.calledByCleanInputValue) {
            this.calledByCleanInputValue = false;
            return event.preventDefault();
        }
        var files = event.target.files;
        this.updateFiles(files);
        this.cleanInputValue();
    };
    PoUploadComponent.prototype.onFileChangeDragDrop = function (files) {
        this.updateFiles(files);
    };
    // Remove o arquivo passado por parâmetro da lista dos arquivos correntes.
    PoUploadComponent.prototype.removeFile = function (file) {
        var index = this.currentFiles.indexOf(file);
        this.currentFiles.splice(index, 1);
        this.updateModel(__spread(this.currentFiles));
    };
    /** Método responsável por **abrir** a janela para seleção de arquivo(s). */
    PoUploadComponent.prototype.selectFiles = function () {
        this.calledByCleanInputValue = false;
        this.inputFile.nativeElement.click();
    };
    PoUploadComponent.prototype.sendFeedback = function () {
        if (this.sizeNotAllowed > 0) {
            var minFileSize = formatBytes(this.fileRestrictions.minFileSize);
            var maxFileSize = formatBytes(this.fileRestrictions.maxFileSize);
            var args = [this.sizeNotAllowed, minFileSize || '0', maxFileSize];
            this.setPipeArguments('invalidSize', args);
            this.sizeNotAllowed = 0;
        }
        if (this.extensionNotAllowed > 0) {
            var allowedExtensionsFormatted = this.fileRestrictions.allowedExtensions.join(', ').toUpperCase();
            var args = [this.extensionNotAllowed, allowedExtensionsFormatted];
            this.setPipeArguments('invalidFormat', args);
            this.extensionNotAllowed = 0;
        }
        if (this.quantityNotAllowed > 0) {
            var args = [this.quantityNotAllowed];
            this.setPipeArguments('invalidAmount', args);
            this.quantityNotAllowed = 0;
        }
    };
    /** Método responsável por **enviar** o(s) arquivo(s) selecionado(s). */
    PoUploadComponent.prototype.sendFiles = function () {
        if (this.currentFiles && this.currentFiles.length) {
            this.uploadFiles(this.currentFiles);
        }
    };
    PoUploadComponent.prototype.setDirectoryAttribute = function (canHandleDirectory) {
        if (canHandleDirectory) {
            this.renderer.setAttribute(this.inputFile.nativeElement, 'webkitdirectory', 'true');
        }
        else {
            this.renderer.removeAttribute(this.inputFile.nativeElement, 'webkitdirectory');
        }
    };
    // Caso o componente estiver no modo AutoUpload, o arquivo também será removido da lista.
    PoUploadComponent.prototype.stopUpload = function (file) {
        var _this = this;
        this.uploadService.stopRequestByFile(file, function () {
            if (_this.autoUpload) {
                _this.removeFile(file);
            }
            else {
                _this.stopUploadHandler(file);
            }
        });
    };
    PoUploadComponent.prototype.trackByFn = function (index, file) {
        return file.uid;
    };
    // Envia os arquivos passados por parâmetro, exceto os que já foram enviados ao serviço.
    PoUploadComponent.prototype.uploadFiles = function (files) {
        var _this = this;
        var filesFiltered = files.filter(function (file) { return file.status !== PoUploadStatus.Uploaded; });
        this.uploadService.upload(this.url, filesFiltered, this.onUpload, function (file, percent) {
            // UPLOADING
            _this.uploadingHandler(file, percent);
        }, function (file, eventResponse) {
            // SUCCESS
            _this.responseHandler(file, PoUploadStatus.Uploaded);
            _this.onSuccess.emit(eventResponse);
        }, function (file, eventError) {
            // Error
            _this.responseHandler(file, PoUploadStatus.Error);
            _this.onError.emit(eventError);
        });
    };
    PoUploadComponent.prototype.cleanInputValue = function () {
        this.calledByCleanInputValue = true;
        this.inputFile.nativeElement.value = '';
    };
    // função disparada na resposta do sucesso ou error
    PoUploadComponent.prototype.responseHandler = function (file, status) {
        file.status = status;
        file.percent = 100;
    };
    // método responsável por setar os argumentos do i18nPipe de acordo com a restrição.
    PoUploadComponent.prototype.setPipeArguments = function (literalAttributes, literalArguments) {
        var pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], literalArguments);
        this.notification.information(pipeArguments);
    };
    // Função disparada ao parar um envio de arquivo.
    PoUploadComponent.prototype.stopUploadHandler = function (file) {
        file.status = PoUploadStatus.None;
        file.percent = 0;
    };
    PoUploadComponent.prototype.updateFiles = function (files) {
        this.currentFiles = this.parseFiles(files);
        this.updateModel(__spread(this.currentFiles));
        if (this.autoUpload) {
            this.uploadFiles(this.currentFiles);
        }
    };
    // Atualiza o ngModel para os arquivos passados por parâmetro.
    PoUploadComponent.prototype.updateModel = function (files) {
        var modelFiles = this.mapCleanUploadFiles(files);
        this.onModelChange ? this.onModelChange(modelFiles) : this.ngModelChange.emit(modelFiles);
    };
    // Função disparada enquanto o arquivo está sendo enviado ao serviço.
    PoUploadComponent.prototype.uploadingHandler = function (file, percent) {
        file.status = PoUploadStatus.Uploading;
        file.percent = percent;
    };
    // retorna os objetos do array sem as propriedades: percent e displayName
    PoUploadComponent.prototype.mapCleanUploadFiles = function (files) {
        var mapedByUploadFile = function (progressFile) {
            var percent = progressFile.percent, displayName = progressFile.displayName, uploadFile = __rest(progressFile, ["percent", "displayName"]);
            return uploadFile;
        };
        return files.map(mapedByUploadFile);
    };
    var PoUploadComponent_1;
    PoUploadComponent.ctorParameters = function () { return [
        { type: PoUploadService },
        { type: Renderer2 },
        { type: PoI18nPipe },
        { type: PoNotificationService }
    ]; };
    __decorate([
        ViewChild('inputFile', { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], PoUploadComponent.prototype, "inputFile", void 0);
    __decorate([
        ViewChild(PoUploadDragDropComponent),
        __metadata("design:type", PoUploadDragDropComponent)
    ], PoUploadComponent.prototype, "poUploadDragDropComponent", void 0);
    __decorate([
        ViewChild('uploadButton'),
        __metadata("design:type", PoButtonComponent)
    ], PoUploadComponent.prototype, "uploadButton", void 0);
    PoUploadComponent = PoUploadComponent_1 = __decorate([
        Component({
            selector: 'po-upload',
            template: "<po-field-container [p-label]=\"label\" [p-help]=\"help\" [p-optional]=\"!required && optional\">\n  <div class=\"po-upload\">\n    <input\n      #inputFile\n      class=\"po-upload-input\"\n      type=\"file\"\n      [accept]=\"allowedExtensions\"\n      [attr.name]=\"name\"\n      [disabled]=\"isDisabled\"\n      [multiple]=\"isMultiple\"\n      [required]=\"required\"\n      (change)=\"onFileChange($event)\"\n    />\n\n    <po-upload-drag-drop\n      *ngIf=\"displayDragDrop\"\n      [p-directory-compatible]=\"canHandleDirectory\"\n      [p-disabled]=\"isDisabled\"\n      [p-drag-drop-height]=\"dragDropHeight\"\n      [p-literals]=\"literals\"\n      (p-file-change)=\"onFileChangeDragDrop($event)\"\n      (p-select-files)=\"selectFiles()\"\n    >\n    </po-upload-drag-drop>\n\n    <po-button\n      *ngIf=\"!hideSelectButton && !displayDragDrop\"\n      #uploadButton\n      class=\"po-upload-button\"\n      for=\"file\"\n      [p-disabled]=\"isDisabled\"\n      [p-label]=\"selectFileButtonLabel\"\n      (p-click)=\"selectFiles()\"\n    >\n    </po-button>\n\n    <po-upload-file-restrictions\n      *ngIf=\"fileRestrictions && !hideRestrictionsInfo\"\n      class=\"po-upload-file-restrictions\"\n      [ngClass]=\"{ 'po-upload-file-restrictions-drag-drop': displayDragDrop }\"\n      [p-allowed-extensions]=\"fileRestrictions?.allowedExtensions\"\n      [p-max-files]=\"maxFiles\"\n      [p-max-file-size]=\"fileRestrictions?.maxFileSize\"\n      [p-min-file-size]=\"fileRestrictions?.minFileSize\"\n    >\n    </po-upload-file-restrictions>\n\n    <div *ngIf=\"currentFiles && currentFiles.length\" class=\"po-upload-progress-container\">\n      <po-container\n        p-no-shadow\n        [p-height]=\"hasMoreThanFourItems ? 280 : 'auto'\"\n        [p-no-border]=\"!hasMoreThanFourItems\"\n        [p-no-padding]=\"!hasMoreThanFourItems\"\n      >\n        <div [ngClass]=\"{ 'po-upload-progress-container-area po-pt-2 po-pl-1': hasMoreThanFourItems }\">\n          <po-progress\n            *ngFor=\"let file of currentFiles; trackBy: trackByFn\"\n            [p-info]=\"infoByUploadStatus[file.status]?.text(file.percent)\"\n            [p-info-icon]=\"infoByUploadStatus[file.status]?.icon\"\n            [p-status]=\"progressStatusByFileStatus[file.status]\"\n            [p-text]=\"file.displayName\"\n            [p-value]=\"file.percent\"\n            (p-cancel)=\"cancel(file)\"\n            (p-retry)=\"uploadFiles([file])\"\n          >\n          </po-progress>\n        </div>\n      </po-container>\n    </div>\n\n    <po-button\n      *ngIf=\"displaySendButton\"\n      class=\"po-upload-send-button\"\n      [class.po-mt-3]=\"hasMoreThanFourItems\"\n      p-type=\"primary\"\n      [p-disabled]=\"hasAnyFileUploading(currentFiles)\"\n      [p-label]=\"literals.startSending\"\n      (p-click)=\"uploadFiles(currentFiles)\"\n    >\n    </po-button>\n  </div>\n</po-field-container>\n",
            providers: [
                PoI18nPipe,
                PoUploadService,
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return PoUploadComponent_1; }),
                    multi: true
                },
                {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return PoUploadComponent_1; }),
                    multi: true
                }
            ]
        }),
        __metadata("design:paramtypes", [PoUploadService,
            Renderer2,
            PoI18nPipe,
            PoNotificationService])
    ], PoUploadComponent);
    return PoUploadComponent;
}(PoUploadBaseComponent));
export { PoUploadComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwby11aS9uZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tdXBsb2FkL3BvLXVwbG9hZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMxRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFDbEcsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFFbkYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFaEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUV6RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0JHO0FBbUJIO0lBQXVDLHFDQUFxQjtJQXlCMUQsMkJBQ0UsYUFBOEIsRUFDdkIsUUFBbUIsRUFDbEIsUUFBb0IsRUFDcEIsWUFBbUM7O1FBSjdDLFlBTUUsa0JBQU0sYUFBYSxDQUFDLFNBQ3JCO1FBTFEsY0FBUSxHQUFSLFFBQVEsQ0FB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QVU7WUFDTixxQkFBcUI7T0E3QmxDLGlCQUFpQixDQTBUN0I7SUFBRCx3QkFBQztDQUFBLEFBMVRELENBQXVDLHFCQUFxQixHQTBUM0Q7U0ExVFksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBmb3J3YXJkUmVmLCBSZW5kZXJlcjIsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMSURBVE9SUywgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IGZvcm1hdEJ5dGVzLCBpc01vYmlsZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9CdXR0b25Db21wb25lbnQgfSBmcm9tICcuLy4uLy4uL3BvLWJ1dHRvbi9wby1idXR0b24uY29tcG9uZW50JztcbmltcG9ydCB7IFBvSTE4blBpcGUgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1pMThuL3BvLWkxOG4ucGlwZSc7XG5pbXBvcnQgeyBQb05vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1ub3RpZmljYXRpb24vcG8tbm90aWZpY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9Qcm9ncmVzc1N0YXR1cyB9IGZyb20gJy4uLy4uL3BvLXByb2dyZXNzL2VudW1zL3BvLXByb2dyZXNzLXN0YXR1cy5lbnVtJztcblxuaW1wb3J0IHsgUG9VcGxvYWRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby11cGxvYWQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCB9IGZyb20gJy4vcG8tdXBsb2FkLWRyYWctZHJvcC9wby11cGxvYWQtZHJhZy1kcm9wLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1VwbG9hZEZpbGUgfSBmcm9tICcuL3BvLXVwbG9hZC1maWxlJztcbmltcG9ydCB7IFBvVXBsb2FkU2VydmljZSB9IGZyb20gJy4vcG8tdXBsb2FkLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9VcGxvYWRTdGF0dXMgfSBmcm9tICcuL3BvLXVwbG9hZC1zdGF0dXMuZW51bSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvVXBsb2FkQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1iYXNpY1wiIHRpdGxlPVwiUE8gVXBsb2FkIEJhc2ljXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWJhc2ljL3NhbXBsZS1wby11cGxvYWQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1iYXNpYy9zYW1wbGUtcG8tdXBsb2FkLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1sYWJzXCIgdGl0bGU9XCJQTyBVcGxvYWQgTGFic1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1sYWJzL3NhbXBsZS1wby11cGxvYWQtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWxhYnMvc2FtcGxlLXBvLXVwbG9hZC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yZXN1bWVcIiB0aXRsZT1cIlBPIFVwbG9hZCAtIFJlc3VtZVwiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUvc2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUvc2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdXBsb2FkLXJzXCIgdGl0bGU9XCJQTyBVcGxvYWQgLSBSZWFsaXplICYgU2hvd1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1ycy9zYW1wbGUtcG8tdXBsb2FkLXJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcnMvc2FtcGxlLXBvLXVwbG9hZC1ycy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby11cGxvYWQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tdXBsb2FkLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgUG9JMThuUGlwZSxcbiAgICBQb1VwbG9hZFNlcnZpY2UsXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb1VwbG9hZENvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFBvVXBsb2FkQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFBvVXBsb2FkQ29tcG9uZW50IGV4dGVuZHMgUG9VcGxvYWRCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG4gIGluZm9CeVVwbG9hZFN0YXR1czogeyBba2V5OiBzdHJpbmddOiB7IHRleHQ6IChwZXJjZW50PzogbnVtYmVyKSA9PiBzdHJpbmc7IGljb24/OiBzdHJpbmcgfSB9ID0ge1xuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZF06IHtcbiAgICAgIHRleHQ6ICgpID0+IHRoaXMubGl0ZXJhbHMuc2VudFdpdGhTdWNjZXNzLFxuICAgICAgaWNvbjogJ3BvLWljb24tb2snXG4gICAgfSxcbiAgICBbUG9VcGxvYWRTdGF0dXMuRXJyb3JdOiB7XG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLmVycm9yT2NjdXJyZWRcbiAgICB9LFxuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmddOiB7XG4gICAgICB0ZXh0OiBwZXJjZW50ID0+IHBlcmNlbnQgKyAnJSdcbiAgICB9XG4gIH07XG5cbiAgcHJvZ3Jlc3NTdGF0dXNCeUZpbGVTdGF0dXMgPSB7XG4gICAgW1BvVXBsb2FkU3RhdHVzLlVwbG9hZGVkXTogUG9Qcm9ncmVzc1N0YXR1cy5TdWNjZXNzLFxuICAgIFtQb1VwbG9hZFN0YXR1cy5FcnJvcl06IFBvUHJvZ3Jlc3NTdGF0dXMuRXJyb3JcbiAgfTtcblxuICBwcml2YXRlIGNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXRGaWxlJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBpbnB1dEZpbGU6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCkgcHJpdmF0ZSBwb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50OiBQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCd1cGxvYWRCdXR0b24nKSBwcml2YXRlIHVwbG9hZEJ1dHRvbjogUG9CdXR0b25Db21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdXBsb2FkU2VydmljZTogUG9VcGxvYWRTZXJ2aWNlLFxuICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgaTE4blBpcGU6IFBvSTE4blBpcGUsXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb246IFBvTm90aWZpY2F0aW9uU2VydmljZVxuICApIHtcbiAgICBzdXBlcih1cGxvYWRTZXJ2aWNlKTtcbiAgfVxuXG4gIGdldCBkaXNwbGF5RHJhZ0Ryb3AoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZHJhZ0Ryb3AgJiYgIWlzTW9iaWxlKCk7XG4gIH1cblxuICBnZXQgZGlzcGxheVNlbmRCdXR0b24oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudEZpbGVzID0gdGhpcy5jdXJyZW50RmlsZXMgfHwgW107XG4gICAgcmV0dXJuICF0aGlzLmhpZGVTZW5kQnV0dG9uICYmICF0aGlzLmF1dG9VcGxvYWQgJiYgY3VycmVudEZpbGVzLmxlbmd0aCA+IDAgJiYgdGhpcy5oYXNGaWxlTm90VXBsb2FkZWQ7XG4gIH1cblxuICBnZXQgc2VsZWN0RmlsZUJ1dHRvbkxhYmVsKCkge1xuICAgIGlmICh0aGlzLmNhbkhhbmRsZURpcmVjdG9yeSkge1xuICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc2VsZWN0Rm9sZGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc011bHRpcGxlKSB7XG4gICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5zZWxlY3RGaWxlcztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc2VsZWN0RmlsZTtcbiAgICB9XG4gIH1cblxuICBnZXQgaGFzTW9yZVRoYW5Gb3VySXRlbXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCA+IDQ7XG4gIH1cblxuICBnZXQgaGFzTXVsdGlwbGVGaWxlcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZXMgJiYgdGhpcy5jdXJyZW50RmlsZXMubGVuZ3RoID4gMTtcbiAgfVxuXG4gIGdldCBoYXNGaWxlTm90VXBsb2FkZWQoKTogYm9vbGVhbiB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5jdXJyZW50RmlsZXMpKSB7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZXMuc29tZShmaWxlID0+IGZpbGUuc3RhdHVzICE9PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZ2V0IGlzRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudEZpbGVzID0gdGhpcy5jdXJyZW50RmlsZXMgfHwgW107XG5cbiAgICByZXR1cm4gISEoXG4gICAgICB0aGlzLmhhc0FueUZpbGVVcGxvYWRpbmcoY3VycmVudEZpbGVzKSB8fFxuICAgICAgIXRoaXMudXJsIHx8XG4gICAgICB0aGlzLmRpc2FibGVkIHx8XG4gICAgICB0aGlzLmlzRXhjZWVkZWRGaWxlTGltaXQoY3VycmVudEZpbGVzLmxlbmd0aClcbiAgICApO1xuICB9XG5cbiAgZ2V0IG1heEZpbGVzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuaXNNdWx0aXBsZSAmJiB0aGlzLmZpbGVSZXN0cmljdGlvbnMgJiYgdGhpcy5maWxlUmVzdHJpY3Rpb25zLm1heEZpbGVzO1xuICB9XG5cbiAgY2FuY2VsKGZpbGU6IFBvVXBsb2FkRmlsZSkge1xuICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9wVXBsb2FkKGZpbGUpO1xuICAgIH1cblxuICAgIHRoaXMucmVtb3ZlRmlsZShmaWxlKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAodGhpcy5hdXRvRm9jdXMpIHtcbiAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICAvKiogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yICoqbGltcGFyKiogbyhzKSBhcnF1aXZvKHMpIHNlbGVjaW9uYWRvKHMpLiAqL1xuICBjbGVhcigpIHtcbiAgICB0aGlzLmN1cnJlbnRGaWxlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFtdKTtcbiAgICB0aGlzLmNsZWFuSW5wdXRWYWx1ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bsOnw6NvIHF1ZSBhdHJpYnVpIGZvY28gYW8gY29tcG9uZW50ZS5cbiAgICpcbiAgICogUGFyYSB1dGlsaXrDoS1sYSDDqSBuZWNlc3PDoXJpbyB0ZXIgYSBpbnN0w6JuY2lhIGRvIGNvbXBvbmVudGUgbm8gRE9NLCBwb2RlbmRvIHNlciB1dGlsaXphZG8gbyBWaWV3Q2hpbGQgZGEgc2VndWludGUgZm9ybWE6XG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgeyBQb1VwbG9hZENvbXBvbmVudCB9IGZyb20gJ0Bwby11aS9uZy1jb21wb25lbnRzJztcbiAgICpcbiAgICogLi4uXG4gICAqXG4gICAqIEBWaWV3Q2hpbGQoUG9VcGxvYWRDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIHVwbG9hZDogUG9VcGxvYWRDb21wb25lbnQ7XG4gICAqXG4gICAqIGZvY3VzVXBsb2FkKCkge1xuICAgKiAgIHRoaXMudXBsb2FkLmZvY3VzKCk7XG4gICAqIH1cbiAgICogYGBgXG4gICAqL1xuICBmb2N1cygpIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGlmICh0aGlzLnVwbG9hZEJ1dHRvbikge1xuICAgICAgICB0aGlzLnVwbG9hZEJ1dHRvbi5mb2N1cygpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmRpc3BsYXlEcmFnRHJvcCkge1xuICAgICAgICB0aGlzLnBvVXBsb2FkRHJhZ0Ryb3BDb21wb25lbnQuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBWZXJpZmljYSBzZSBleGlzdGUgYWxndW0gYXJxdWl2byBzZW5kbyBlbnZpYWRvIGFvIHNlcnZpw6dvLlxuICBoYXNBbnlGaWxlVXBsb2FkaW5nKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyA9PT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyByZXRvcm5hIHNlIG8gc3RhdHVzIGRvIGFycXVpdm8gw6kgZGlmZXJlbnRlIGRlIGVudmlhZG9cbiAgaXNBbGxvd0NhbmNlbEV2ZW50KHN0YXR1czogUG9VcGxvYWRTdGF0dXMpIHtcbiAgICByZXR1cm4gc3RhdHVzICE9PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZDtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBhbyBzZWxlY2lvbmFyIGFsZ3VtIGFycXVpdm8uXG4gIG9uRmlsZUNoYW5nZShldmVudCk6IHZvaWQge1xuICAgIC8vIG5lY2Vzc8OhcmlvIGVzdGUgdHJhdGFtZW50byBxdWFuZG8gcGFyYSBJRSwgcG9pcyBuZWxlIG8gY2hhbmdlIMOpIGRpc3BhcmFkbyBxdWFuZG8gbyBjYW1wbyDDqSBsaW1wYWRvIHRhbWLDqW1cbiAgICBpZiAodGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSkge1xuICAgICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgY29uc3QgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7XG4gICAgdGhpcy51cGRhdGVGaWxlcyhmaWxlcyk7XG5cbiAgICB0aGlzLmNsZWFuSW5wdXRWYWx1ZSgpO1xuICB9XG5cbiAgb25GaWxlQ2hhbmdlRHJhZ0Ryb3AoZmlsZXMpIHtcbiAgICB0aGlzLnVwZGF0ZUZpbGVzKGZpbGVzKTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBvIGFycXVpdm8gcGFzc2FkbyBwb3IgcGFyw6JtZXRybyBkYSBsaXN0YSBkb3MgYXJxdWl2b3MgY29ycmVudGVzLlxuICByZW1vdmVGaWxlKGZpbGUpOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudEZpbGVzLmluZGV4T2YoZmlsZSk7XG4gICAgdGhpcy5jdXJyZW50RmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgIHRoaXMudXBkYXRlTW9kZWwoWy4uLnRoaXMuY3VycmVudEZpbGVzXSk7XG4gIH1cblxuICAvKiogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yICoqYWJyaXIqKiBhIGphbmVsYSBwYXJhIHNlbGXDp8OjbyBkZSBhcnF1aXZvKHMpLiAqL1xuICBzZWxlY3RGaWxlcygpIHtcbiAgICB0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlID0gZmFsc2U7XG4gICAgdGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICB9XG5cbiAgc2VuZEZlZWRiYWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNpemVOb3RBbGxvd2VkID4gMCkge1xuICAgICAgY29uc3QgbWluRmlsZVNpemUgPSBmb3JtYXRCeXRlcyh0aGlzLmZpbGVSZXN0cmljdGlvbnMubWluRmlsZVNpemUpO1xuICAgICAgY29uc3QgbWF4RmlsZVNpemUgPSBmb3JtYXRCeXRlcyh0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZVNpemUpO1xuICAgICAgY29uc3QgYXJncyA9IFt0aGlzLnNpemVOb3RBbGxvd2VkLCBtaW5GaWxlU2l6ZSB8fCAnMCcsIG1heEZpbGVTaXplXTtcbiAgICAgIHRoaXMuc2V0UGlwZUFyZ3VtZW50cygnaW52YWxpZFNpemUnLCBhcmdzKTtcbiAgICAgIHRoaXMuc2l6ZU5vdEFsbG93ZWQgPSAwO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQgPiAwKSB7XG4gICAgICBjb25zdCBhbGxvd2VkRXh0ZW5zaW9uc0Zvcm1hdHRlZCA9IHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5hbGxvd2VkRXh0ZW5zaW9ucy5qb2luKCcsICcpLnRvVXBwZXJDYXNlKCk7XG4gICAgICBjb25zdCBhcmdzID0gW3RoaXMuZXh0ZW5zaW9uTm90QWxsb3dlZCwgYWxsb3dlZEV4dGVuc2lvbnNGb3JtYXR0ZWRdO1xuICAgICAgdGhpcy5zZXRQaXBlQXJndW1lbnRzKCdpbnZhbGlkRm9ybWF0JywgYXJncyk7XG4gICAgICB0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQgPSAwO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnF1YW50aXR5Tm90QWxsb3dlZCA+IDApIHtcbiAgICAgIGNvbnN0IGFyZ3MgPSBbdGhpcy5xdWFudGl0eU5vdEFsbG93ZWRdO1xuICAgICAgdGhpcy5zZXRQaXBlQXJndW1lbnRzKCdpbnZhbGlkQW1vdW50JywgYXJncyk7XG4gICAgICB0aGlzLnF1YW50aXR5Tm90QWxsb3dlZCA9IDA7XG4gICAgfVxuICB9XG5cbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmVudmlhcioqIG8ocykgYXJxdWl2byhzKSBzZWxlY2lvbmFkbyhzKS4gKi9cbiAgc2VuZEZpbGVzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmN1cnJlbnRGaWxlcyAmJiB0aGlzLmN1cnJlbnRGaWxlcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMudXBsb2FkRmlsZXModGhpcy5jdXJyZW50RmlsZXMpO1xuICAgIH1cbiAgfVxuXG4gIHNldERpcmVjdG9yeUF0dHJpYnV0ZShjYW5IYW5kbGVEaXJlY3Rvcnk6IGJvb2xlYW4pIHtcbiAgICBpZiAoY2FuSGFuZGxlRGlyZWN0b3J5KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LCAnd2Via2l0ZGlyZWN0b3J5JywgJ3RydWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudCwgJ3dlYmtpdGRpcmVjdG9yeScpO1xuICAgIH1cbiAgfVxuXG4gIC8vIENhc28gbyBjb21wb25lbnRlIGVzdGl2ZXIgbm8gbW9kbyBBdXRvVXBsb2FkLCBvIGFycXVpdm8gdGFtYsOpbSBzZXLDoSByZW1vdmlkbyBkYSBsaXN0YS5cbiAgc3RvcFVwbG9hZChmaWxlOiBQb1VwbG9hZEZpbGUpIHtcbiAgICB0aGlzLnVwbG9hZFNlcnZpY2Uuc3RvcFJlcXVlc3RCeUZpbGUoZmlsZSwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuYXV0b1VwbG9hZCkge1xuICAgICAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0b3BVcGxvYWRIYW5kbGVyKGZpbGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdHJhY2tCeUZuKGluZGV4LCBmaWxlOiBQb1VwbG9hZEZpbGUpIHtcbiAgICByZXR1cm4gZmlsZS51aWQ7XG4gIH1cblxuICAvLyBFbnZpYSBvcyBhcnF1aXZvcyBwYXNzYWRvcyBwb3IgcGFyw6JtZXRybywgZXhjZXRvIG9zIHF1ZSBqw6EgZm9yYW0gZW52aWFkb3MgYW8gc2VydmnDp28uXG4gIHVwbG9hZEZpbGVzKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XG4gICAgY29uc3QgZmlsZXNGaWx0ZXJlZCA9IGZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGUuc3RhdHVzICE9PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZCk7XG5cbiAgICB0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkKFxuICAgICAgdGhpcy51cmwsXG4gICAgICBmaWxlc0ZpbHRlcmVkLFxuICAgICAgdGhpcy5vblVwbG9hZCxcbiAgICAgIChmaWxlLCBwZXJjZW50KTogYW55ID0+IHtcbiAgICAgICAgLy8gVVBMT0FESU5HXG4gICAgICAgIHRoaXMudXBsb2FkaW5nSGFuZGxlcihmaWxlLCBwZXJjZW50KTtcbiAgICAgIH0sXG4gICAgICAoZmlsZSwgZXZlbnRSZXNwb25zZSk6IGFueSA9PiB7XG4gICAgICAgIC8vIFNVQ0NFU1NcbiAgICAgICAgdGhpcy5yZXNwb25zZUhhbmRsZXIoZmlsZSwgUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xuICAgICAgICB0aGlzLm9uU3VjY2Vzcy5lbWl0KGV2ZW50UmVzcG9uc2UpO1xuICAgICAgfSxcbiAgICAgIChmaWxlLCBldmVudEVycm9yKTogYW55ID0+IHtcbiAgICAgICAgLy8gRXJyb3JcbiAgICAgICAgdGhpcy5yZXNwb25zZUhhbmRsZXIoZmlsZSwgUG9VcGxvYWRTdGF0dXMuRXJyb3IpO1xuICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChldmVudEVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhbklucHV0VmFsdWUoKSB7XG4gICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IHRydWU7XG4gICAgdGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICB9XG5cbiAgLy8gZnVuw6fDo28gZGlzcGFyYWRhIG5hIHJlc3Bvc3RhIGRvIHN1Y2Vzc28gb3UgZXJyb3JcbiAgcHJpdmF0ZSByZXNwb25zZUhhbmRsZXIoZmlsZTogUG9VcGxvYWRGaWxlLCBzdGF0dXM6IFBvVXBsb2FkU3RhdHVzKSB7XG4gICAgZmlsZS5zdGF0dXMgPSBzdGF0dXM7XG4gICAgZmlsZS5wZXJjZW50ID0gMTAwO1xuICB9XG5cbiAgLy8gbcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIHNldGFyIG9zIGFyZ3VtZW50b3MgZG8gaTE4blBpcGUgZGUgYWNvcmRvIGNvbSBhIHJlc3RyacOnw6NvLlxuICBwcml2YXRlIHNldFBpcGVBcmd1bWVudHMobGl0ZXJhbEF0dHJpYnV0ZXM6IHN0cmluZywgbGl0ZXJhbEFyZ3VtZW50cz8pIHtcbiAgICBjb25zdCBwaXBlQXJndW1lbnRzID0gdGhpcy5pMThuUGlwZS50cmFuc2Zvcm0odGhpcy5saXRlcmFsc1tsaXRlcmFsQXR0cmlidXRlc10sIGxpdGVyYWxBcmd1bWVudHMpO1xuICAgIHRoaXMubm90aWZpY2F0aW9uLmluZm9ybWF0aW9uKHBpcGVBcmd1bWVudHMpO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gZGlzcGFyYWRhIGFvIHBhcmFyIHVtIGVudmlvIGRlIGFycXVpdm8uXG4gIHByaXZhdGUgc3RvcFVwbG9hZEhhbmRsZXIoZmlsZTogUG9VcGxvYWRGaWxlKSB7XG4gICAgZmlsZS5zdGF0dXMgPSBQb1VwbG9hZFN0YXR1cy5Ob25lO1xuICAgIGZpbGUucGVyY2VudCA9IDA7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUZpbGVzKGZpbGVzKSB7XG4gICAgdGhpcy5jdXJyZW50RmlsZXMgPSB0aGlzLnBhcnNlRmlsZXMoZmlsZXMpO1xuXG4gICAgdGhpcy51cGRhdGVNb2RlbChbLi4udGhpcy5jdXJyZW50RmlsZXNdKTtcblxuICAgIGlmICh0aGlzLmF1dG9VcGxvYWQpIHtcbiAgICAgIHRoaXMudXBsb2FkRmlsZXModGhpcy5jdXJyZW50RmlsZXMpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEF0dWFsaXphIG8gbmdNb2RlbCBwYXJhIG9zIGFycXVpdm9zIHBhc3NhZG9zIHBvciBwYXLDom1ldHJvLlxuICBwcml2YXRlIHVwZGF0ZU1vZGVsKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XG4gICAgY29uc3QgbW9kZWxGaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPiA9IHRoaXMubWFwQ2xlYW5VcGxvYWRGaWxlcyhmaWxlcyk7XG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlID8gdGhpcy5vbk1vZGVsQ2hhbmdlKG1vZGVsRmlsZXMpIDogdGhpcy5uZ01vZGVsQ2hhbmdlLmVtaXQobW9kZWxGaWxlcyk7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgZW5xdWFudG8gbyBhcnF1aXZvIGVzdMOhIHNlbmRvIGVudmlhZG8gYW8gc2VydmnDp28uXG4gIHByaXZhdGUgdXBsb2FkaW5nSGFuZGxlcihmaWxlOiBhbnksIHBlcmNlbnQ6IG51bWJlcikge1xuICAgIGZpbGUuc3RhdHVzID0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nO1xuICAgIGZpbGUucGVyY2VudCA9IHBlcmNlbnQ7XG4gIH1cblxuICAvLyByZXRvcm5hIG9zIG9iamV0b3MgZG8gYXJyYXkgc2VtIGFzIHByb3ByaWVkYWRlczogcGVyY2VudCBlIGRpc3BsYXlOYW1lXG4gIHByaXZhdGUgbWFwQ2xlYW5VcGxvYWRGaWxlcyhmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPik6IEFycmF5PFBvVXBsb2FkRmlsZT4ge1xuICAgIGNvbnN0IG1hcGVkQnlVcGxvYWRGaWxlID0gcHJvZ3Jlc3NGaWxlID0+IHtcbiAgICAgIGNvbnN0IHsgcGVyY2VudCwgZGlzcGxheU5hbWUsIC4uLnVwbG9hZEZpbGUgfSA9IHByb2dyZXNzRmlsZTtcblxuICAgICAgcmV0dXJuIHVwbG9hZEZpbGU7XG4gICAgfTtcblxuICAgIHJldHVybiBmaWxlcy5tYXAobWFwZWRCeVVwbG9hZEZpbGUpO1xuICB9XG59XG4iXX0=