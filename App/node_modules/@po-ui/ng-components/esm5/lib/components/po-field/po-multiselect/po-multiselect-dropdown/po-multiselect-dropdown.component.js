import { __decorate, __metadata } from "tslib";
import { Component, ElementRef, EventEmitter, HostListener, Input, Output, ViewChild } from '@angular/core';
import { PoMultiselectSearchComponent } from './../po-multiselect-search/po-multiselect-search.component';
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que construíra o dropdown, contendo o campo de pesquisa e os itens para seleção.
 */
var PoMultiselectDropdownComponent = /** @class */ (function () {
    function PoMultiselectDropdownComponent() {
        this.scrollTop = 0;
        this.show = false;
        /** Propriedade que indica se o campo de pesquisa deverá ser escondido. */
        this.hideSearch = false;
        /** Propriedade que recebe a lista de opções selecionadas. */
        this.selectedValues = [];
        /** Propriedade que recebe a lista de opções que deverão ser criadas no dropdown. */
        this.options = [];
        /** Evento disparado a cada tecla digitada na pesquisa. */
        this.changeSearch = new EventEmitter();
        /** Evento disparado a cada alteração na lista das opções selecionadas. */
        this.change = new EventEmitter();
        /**
         * Evento disparado quando for detectada uma ação que necessite fechar o dropdown.
         * Por exemplo, no caso de ser teclado TAB dentro do dropdown, então é disparado este evento
         * para notificar o componente principal que deve fechar o dropdown.
         */
        this.closeDropdown = new EventEmitter();
    }
    Object.defineProperty(PoMultiselectDropdownComponent.prototype, "hasOptions", {
        get: function () {
            var _a;
            return !!((_a = this.options) === null || _a === void 0 ? void 0 : _a.length);
        },
        enumerable: true,
        configurable: true
    });
    PoMultiselectDropdownComponent.prototype.scrollTo = function (index) {
        this.scrollTop = index <= 2 ? 0 : index * 44 - 88;
    };
    PoMultiselectDropdownComponent.prototype.isSelectedItem = function (option) {
        return this.selectedValues.some(function (selectedItem) { return selectedItem === option.value; });
    };
    PoMultiselectDropdownComponent.prototype.clickItem = function (check, option) {
        this.updateSelectedValues(check, option);
        if (!this.hideSearch) {
            this.searchElement.setFocus();
        }
    };
    PoMultiselectDropdownComponent.prototype.updateSelectedValues = function (checked, option) {
        if (checked) {
            this.selectedValues.push(option.value);
        }
        else {
            var indexSelectedValues = this.selectedValues.indexOf(option.value);
            this.selectedValues.splice(indexSelectedValues, 1);
        }
        this.change.emit(this.selectedValues);
    };
    PoMultiselectDropdownComponent.prototype.callChangeSearch = function (event) {
        this.changeSearch.emit(event);
    };
    PoMultiselectDropdownComponent.prototype.onKeydown = function (event) {
        if (event.keyCode === 9) {
            this.closeDropdown.emit();
        }
    };
    PoMultiselectDropdownComponent.prototype.controlVisibility = function (toOpen) {
        var _this = this;
        this.show = toOpen;
        setTimeout(function () {
            if (toOpen && _this.searchElement && !_this.hideSearch) {
                _this.searchElement.setFocus();
                _this.searchElement.clean();
            }
        });
    };
    __decorate([
        Input('p-hide-search'),
        __metadata("design:type", Boolean)
    ], PoMultiselectDropdownComponent.prototype, "hideSearch", void 0);
    __decorate([
        Input('p-literals'),
        __metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "literals", void 0);
    __decorate([
        Input('p-placeholder-search'),
        __metadata("design:type", String)
    ], PoMultiselectDropdownComponent.prototype, "placeholderSearch", void 0);
    __decorate([
        Input('p-selected-values'),
        __metadata("design:type", Array)
    ], PoMultiselectDropdownComponent.prototype, "selectedValues", void 0);
    __decorate([
        Input('p-options'),
        __metadata("design:type", Array)
    ], PoMultiselectDropdownComponent.prototype, "options", void 0);
    __decorate([
        Output('p-change-search'),
        __metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "changeSearch", void 0);
    __decorate([
        Output('p-change'),
        __metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "change", void 0);
    __decorate([
        Output('p-close-dropdown'),
        __metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "closeDropdown", void 0);
    __decorate([
        ViewChild('container', { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], PoMultiselectDropdownComponent.prototype, "container", void 0);
    __decorate([
        ViewChild('ulElement', { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], PoMultiselectDropdownComponent.prototype, "ulElement", void 0);
    __decorate([
        ViewChild('searchElement'),
        __metadata("design:type", PoMultiselectSearchComponent)
    ], PoMultiselectDropdownComponent.prototype, "searchElement", void 0);
    __decorate([
        HostListener('keydown', ['$event']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], PoMultiselectDropdownComponent.prototype, "onKeydown", null);
    PoMultiselectDropdownComponent = __decorate([
        Component({
            selector: 'po-multiselect-dropdown',
            template: "<div #container class=\"po-multiselect-container\" [hidden]=\"!show\">\n  <po-multiselect-search\n    #searchElement\n    *ngIf=\"!hideSearch && hasOptions\"\n    [p-literals]=\"literals\"\n    [p-placeholder]=\"placeholderSearch\"\n    (p-change)=\"callChangeSearch($event)\"\n  >\n  </po-multiselect-search>\n\n  <ul class=\"po-multiselect-items-container\" [scrollTop]=\"scrollTop\" #ulElement>\n    <div *ngIf=\"!options.length\" class=\"po-multiselect-container-no-data po-text-center\">\n      <span> {{ literals.noData }}</span>\n    </div>\n\n    <po-multiselect-item\n      *ngFor=\"let option of options\"\n      [p-label]=\"option.label\"\n      [p-selected]=\"isSelectedItem(option)\"\n      (p-change)=\"clickItem($event, option)\"\n    >\n    </po-multiselect-item>\n  </ul>\n</div>\n"
        })
    ], PoMultiselectDropdownComponent);
    return PoMultiselectDropdownComponent;
}());
export { PoMultiselectDropdownComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbXVsdGlzZWxlY3QtZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1maWVsZC9wby1tdWx0aXNlbGVjdC9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJNUcsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sNERBQTRELENBQUM7QUFFMUc7Ozs7OztHQU1HO0FBS0g7SUFBQTtRQUNFLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFDZCxTQUFJLEdBQVksS0FBSyxDQUFDO1FBRXRCLDBFQUEwRTtRQUNsRCxlQUFVLEdBQWEsS0FBSyxDQUFDO1FBUXJELDZEQUE2RDtRQUNqQyxtQkFBYyxHQUFlLEVBQUUsQ0FBQztRQUU1RCxvRkFBb0Y7UUFDaEUsWUFBTyxHQUErQixFQUFFLENBQUM7UUFFN0QsMERBQTBEO1FBQy9CLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUU3RCwwRUFBMEU7UUFDdEQsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFaEQ7Ozs7V0FJRztRQUN5QixrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUEwRGpFLENBQUM7SUFwREMsc0JBQUksc0RBQVU7YUFBZDs7WUFDRSxPQUFPLENBQUMsUUFBQyxJQUFJLENBQUMsT0FBTywwQ0FBRSxNQUFNLENBQUEsQ0FBQztRQUNoQyxDQUFDOzs7T0FBQTtJQUVELGlEQUFRLEdBQVIsVUFBUyxLQUFLO1FBQ1osSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLElBQUks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O1FBQTNCLFNBQVMsQ0FBQyxlQUFlLENBQUM7a0NBQWdCLDRCQUE0Qjt5RUFBQztJQXNDeEU7UUFEQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7Ozs7bUVBS25DO0lBNUVVLDhCQUE4QjtRQUoxQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUseUJBQXlCO1lBQ25DLDB5QkFBdUQ7U0FDeEQsQ0FBQztPQUNXLDhCQUE4QixDQXdGMUM7SUFBRCxxQ0FBQztDQUFBLEFBeEZELElBd0ZDO1NBeEZZLDhCQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQb011bHRpc2VsZWN0TGl0ZXJhbHMgfSBmcm9tICcuLi8uLi9pbmRleCc7XG5pbXBvcnQgeyBQb011bHRpc2VsZWN0T3B0aW9uIH0gZnJvbSAnLi4vcG8tbXVsdGlzZWxlY3Qtb3B0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb011bHRpc2VsZWN0U2VhcmNoQ29tcG9uZW50IH0gZnJvbSAnLi8uLi9wby1tdWx0aXNlbGVjdC1zZWFyY2gvcG8tbXVsdGlzZWxlY3Qtc2VhcmNoLmNvbXBvbmVudCc7XG5cbi8qKlxuICogQGRvY3NQcml2YXRlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogQ29tcG9uZW50ZSBxdWUgY29uc3RydcOtcmEgbyBkcm9wZG93biwgY29udGVuZG8gbyBjYW1wbyBkZSBwZXNxdWlzYSBlIG9zIGl0ZW5zIHBhcmEgc2VsZcOnw6NvLlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1tdWx0aXNlbGVjdC1kcm9wZG93bicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9NdWx0aXNlbGVjdERyb3Bkb3duQ29tcG9uZW50IHtcbiAgc2Nyb2xsVG9wID0gMDtcbiAgc2hvdzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgaW5kaWNhIHNlIG8gY2FtcG8gZGUgcGVzcXVpc2EgZGV2ZXLDoSBzZXIgZXNjb25kaWRvLiAqL1xuICBASW5wdXQoJ3AtaGlkZS1zZWFyY2gnKSBoaWRlU2VhcmNoPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgcXVlIHJlY2ViZSBhcyBsaXRlcmFpcyBkZWZpbmlkYXMgbm8gY29tcG9uZW50ZSBgcG8tbXVsdGlzZWxlY3RgLiAqL1xuICBASW5wdXQoJ3AtbGl0ZXJhbHMnKSBsaXRlcmFscz86IFBvTXVsdGlzZWxlY3RMaXRlcmFscztcblxuICAvKiogUGxhY2Vob2xkZXIgZG8gY2FtcG8gZGUgcGVzcXVpc2EuICovXG4gIEBJbnB1dCgncC1wbGFjZWhvbGRlci1zZWFyY2gnKSBwbGFjZWhvbGRlclNlYXJjaDogc3RyaW5nO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgcmVjZWJlIGEgbGlzdGEgZGUgb3DDp8O1ZXMgc2VsZWNpb25hZGFzLiAqL1xuICBASW5wdXQoJ3Atc2VsZWN0ZWQtdmFsdWVzJykgc2VsZWN0ZWRWYWx1ZXM6IEFycmF5PGFueT4gPSBbXTtcblxuICAvKiogUHJvcHJpZWRhZGUgcXVlIHJlY2ViZSBhIGxpc3RhIGRlIG9ww6fDtWVzIHF1ZSBkZXZlcsOjbyBzZXIgY3JpYWRhcyBubyBkcm9wZG93bi4gKi9cbiAgQElucHV0KCdwLW9wdGlvbnMnKSBvcHRpb25zOiBBcnJheTxQb011bHRpc2VsZWN0T3B0aW9uPiA9IFtdO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGEgY2FkYSB0ZWNsYSBkaWdpdGFkYSBuYSBwZXNxdWlzYS4gKi9cbiAgQE91dHB1dCgncC1jaGFuZ2Utc2VhcmNoJykgY2hhbmdlU2VhcmNoID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGEgY2FkYSBhbHRlcmHDp8OjbyBuYSBsaXN0YSBkYXMgb3DDp8O1ZXMgc2VsZWNpb25hZGFzLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogRXZlbnRvIGRpc3BhcmFkbyBxdWFuZG8gZm9yIGRldGVjdGFkYSB1bWEgYcOnw6NvIHF1ZSBuZWNlc3NpdGUgZmVjaGFyIG8gZHJvcGRvd24uXG4gICAqIFBvciBleGVtcGxvLCBubyBjYXNvIGRlIHNlciB0ZWNsYWRvIFRBQiBkZW50cm8gZG8gZHJvcGRvd24sIGVudMOjbyDDqSBkaXNwYXJhZG8gZXN0ZSBldmVudG9cbiAgICogcGFyYSBub3RpZmljYXIgbyBjb21wb25lbnRlIHByaW5jaXBhbCBxdWUgZGV2ZSBmZWNoYXIgbyBkcm9wZG93bi5cbiAgICovXG4gIEBPdXRwdXQoJ3AtY2xvc2UtZHJvcGRvd24nKSBjbG9zZURyb3Bkb3duID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgndWxFbGVtZW50JywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgdWxFbGVtZW50OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdzZWFyY2hFbGVtZW50Jykgc2VhcmNoRWxlbWVudDogUG9NdWx0aXNlbGVjdFNlYXJjaENvbXBvbmVudDtcblxuICBnZXQgaGFzT3B0aW9ucygpIHtcbiAgICByZXR1cm4gISF0aGlzLm9wdGlvbnM/Lmxlbmd0aDtcbiAgfVxuXG4gIHNjcm9sbFRvKGluZGV4KSB7XG4gICAgdGhpcy5zY3JvbGxUb3AgPSBpbmRleCA8PSAyID8gMCA6IGluZGV4ICogNDQgLSA4ODtcbiAgfVxuXG4gIGlzU2VsZWN0ZWRJdGVtKG9wdGlvbjogUG9NdWx0aXNlbGVjdE9wdGlvbikge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkVmFsdWVzLnNvbWUoc2VsZWN0ZWRJdGVtID0+IHNlbGVjdGVkSXRlbSA9PT0gb3B0aW9uLnZhbHVlKTtcbiAgfVxuXG4gIGNsaWNrSXRlbShjaGVjaywgb3B0aW9uKSB7XG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZFZhbHVlcyhjaGVjaywgb3B0aW9uKTtcblxuICAgIGlmICghdGhpcy5oaWRlU2VhcmNoKSB7XG4gICAgICB0aGlzLnNlYXJjaEVsZW1lbnQuc2V0Rm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVTZWxlY3RlZFZhbHVlcyhjaGVja2VkLCBvcHRpb24pIHtcbiAgICBpZiAoY2hlY2tlZCkge1xuICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5wdXNoKG9wdGlvbi52YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGluZGV4U2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLnNlbGVjdGVkVmFsdWVzLmluZGV4T2Yob3B0aW9uLnZhbHVlKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaWNlKGluZGV4U2VsZWN0ZWRWYWx1ZXMsIDEpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZFZhbHVlcyk7XG4gIH1cblxuICBjYWxsQ2hhbmdlU2VhcmNoKGV2ZW50KSB7XG4gICAgdGhpcy5jaGFuZ2VTZWFyY2guZW1pdChldmVudCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gOSkge1xuICAgICAgdGhpcy5jbG9zZURyb3Bkb3duLmVtaXQoKTtcbiAgICB9XG4gIH1cblxuICBjb250cm9sVmlzaWJpbGl0eSh0b09wZW4pIHtcbiAgICB0aGlzLnNob3cgPSB0b09wZW47XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0b09wZW4gJiYgdGhpcy5zZWFyY2hFbGVtZW50ICYmICF0aGlzLmhpZGVTZWFyY2gpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hFbGVtZW50LnNldEZvY3VzKCk7XG4gICAgICAgIHRoaXMuc2VhcmNoRWxlbWVudC5jbGVhbigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=