import { __assign, __decorate, __metadata } from "tslib";
import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToBoolean, convertToInt, uuid } from './../../../utils/util';
import { InputBoolean } from '../../../decorators';
import { requiredFailed } from '../validators';
var poCheckboxGroupColumnsDefaultLength = 6;
var poCheckboxGroupColumnsTotalLength = 12;
/**
 * @description
 *
 * O componente `po-checkbox-group` exibe uma lista de múltipla escolha onde o usuário pode marcar e desmarcar,
 * utilizando a tecla de espaço ou o clique do mouse, várias opções.
 *
 * > Para seleção única, utilize o [**PO Radio Group**](/documentation/po-radio-group).
 *
 * Por padrão, o po-checkbox-group retorna um array com os valores dos itens selecionados para o model.
 *
 * ```
 * favorites = ['PO', 'Angular'];
 * ```
 *
 * Na maioria das situações, o array com os objetos setados já atende as necessidades mas, caso o desenvolvedor
 * tenha necessidade de usar um valor indeterminado (`null`), ou seja, nem marcado (`true`) e nem desmarcado (`false`),
 * deve setar a propriedade `p-indeterminate` como `true`.
 *
 * Nesse caso, o po-checkbox-group vai retornar um objeto com todas as opções disponíveis e seus valores.
 *
 * ```
 * favorites = {
 *  PO: true,
 *  Angular: true,
 *  VueJS: false,
 *  React: null // indeterminado
 * };
 * ```
 */
var PoCheckboxGroupBaseComponent = /** @class */ (function () {
    function PoCheckboxGroupBaseComponent() {
        this.checkedOptions = {};
        this.checkedOptionsList = [];
        this.mdColumns = poCheckboxGroupColumnsDefaultLength;
        this._columns = poCheckboxGroupColumnsDefaultLength;
        this._disabled = false;
        this._indeterminate = false;
        this._required = false;
        /**
         * @optional
         *
         * @description
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * > Caso mais de um elemento seja configurado com essa propriedade, apenas o último elemento declarado com ela terá o foco.
         *
         * @default `false`
         */
        this.autoFocus = false;
        // Função para atualizar o `ngModel` do componente, necessário quando não for utilizado dentro da tag form.
        this.ngModelChange = new EventEmitter();
        /** Evento disparado ao alterar valor do campo */
        this.change = new EventEmitter();
    }
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "columns", {
        get: function () {
            return this._columns;
        },
        /**
         * @optional
         *
         * @description
         *
         * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
         * - É possível exibir as opções entre `1` e `4` colunas.
         * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
         * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
         * o *grid system* será composto por `2` colunas.
         * - Para evitar a quebra de linha, prefira a utilização de `1` coluna para opções com textos grandes.
         *
         * @default `2`
         *
         */
        set: function (value) {
            var columns = convertToInt(value, poCheckboxGroupColumnsDefaultLength);
            this._columns = this.getGridSystemColumns(columns, 4);
            this.mdColumns = this.getGridSystemColumns(columns, 2);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "disabled", {
        get: function () {
            return this._disabled;
        },
        /**
         * @optional
         *
         * @description
         *
         * Desabilita todos os itens do checkbox.
         *
         * @default `false`
         */
        set: function (value) {
            this._disabled = convertToBoolean(value);
            this.validateModel(this.checkIndeterminate());
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "indeterminate", {
        get: function () {
            return this._indeterminate;
        },
        /**
         * @optional
         *
         * @description
         *
         * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
         * a propriedade `p-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
         *
         * Quando essa propriedade é setada como `true`, o *po-checkbox-group* passa a devolver um objeto completo para o
         * `ngModel`, diferente do array que contém apenas os valores selecionados.
         *
         * @default `false`
         */
        set: function (indeterminate) {
            this._indeterminate = convertToBoolean(indeterminate);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "options", {
        get: function () {
            return this._options;
        },
        /**
         * @optional
         *
         * @description
         * Lista de opções que serão exibidas
         * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoCheckboxGroupOption
         */
        set: function (value) {
            this._options = Array.isArray(value) ? value : [];
            this.removeDuplicatedOptions();
            this.setCheckboxGroupOptionsView(this.options);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "required", {
        get: function () {
            return this._required;
        },
        /**
         * @optional
         *
         * @description
         *
         * Define que o campo será obrigatório.
         *
         * @default `false`
         */
        set: function (required) {
            this._required = convertToBoolean(required);
            this.validateModel(this.checkIndeterminate());
        },
        enumerable: true,
        configurable: true
    });
    PoCheckboxGroupBaseComponent.prototype.changeValue = function () {
        var value = this.checkIndeterminate();
        if (this.propagateChange) {
            this.propagateChange(value);
        }
        else {
            this.ngModelChange.emit(value);
        }
        this.change.emit(value);
    };
    PoCheckboxGroupBaseComponent.prototype.checkIndeterminate = function () {
        return this.indeterminate ? this.checkedOptions : this.checkedOptionsList;
    };
    PoCheckboxGroupBaseComponent.prototype.checkOption = function (value) {
        if (!this._disabled && !value.disabled) {
            this.checkOptionModel(value);
            this.changeValue();
        }
    };
    PoCheckboxGroupBaseComponent.prototype.registerOnChange = function (fn) {
        this.propagateChange = fn;
    };
    PoCheckboxGroupBaseComponent.prototype.registerOnTouched = function (fn) { };
    PoCheckboxGroupBaseComponent.prototype.writeValue = function (optionsModel) {
        if (optionsModel && this.checkedOptions !== optionsModel) {
            this.generateCheckOptions(optionsModel);
        }
        else {
            this.checkedOptionsList = [];
            this.checkedOptions = {};
        }
    };
    PoCheckboxGroupBaseComponent.prototype.registerOnValidatorChange = function (fn) {
        this.validatorChange = fn;
    };
    PoCheckboxGroupBaseComponent.prototype.validate = function (abstractControl) {
        if ((!this.indeterminate && requiredFailed(this.required, this.disabled, abstractControl.value)) ||
            this.isInvalidIndeterminate()) {
            return {
                required: {
                    valid: false
                }
            };
        }
    };
    PoCheckboxGroupBaseComponent.prototype.validateModel = function (model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    };
    PoCheckboxGroupBaseComponent.prototype.checkColumnsRange = function (columns, maxColumns) {
        var minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    };
    PoCheckboxGroupBaseComponent.prototype.checkOptionModel = function (optionChecked) {
        this.checkedOptions[optionChecked.value] = !this.checkedOptions[optionChecked.value];
        if (!this.indeterminate && this.checkedOptionsList.includes(optionChecked.value)) {
            this.checkedOptionsList.splice(this.checkedOptionsList.indexOf(optionChecked.value), 1);
        }
        else if (!this.indeterminate) {
            this.checkedOptionsList.push(optionChecked.value);
        }
    };
    PoCheckboxGroupBaseComponent.prototype.generateCheckOptions = function (optionsModel) {
        var _this = this;
        this.checkedOptions = {};
        if (optionsModel instanceof Array) {
            this.checkedOptionsList = optionsModel;
            this.options.forEach(function (option) {
                _this.checkedOptions[option.value] = optionsModel.includes(option.value);
            });
        }
        else {
            this.options.forEach(function (option) {
                optionsModel[option.value] = optionsModel[option.value] === undefined ? false : optionsModel[option.value];
                _this.checkedOptions = optionsModel;
            });
        }
    };
    PoCheckboxGroupBaseComponent.prototype.getGridSystemColumns = function (columns, maxColumns) {
        var gridSystemColumns = poCheckboxGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poCheckboxGroupColumnsDefaultLength;
    };
    PoCheckboxGroupBaseComponent.prototype.isInvalidIndeterminate = function () {
        if (this.indeterminate && this.required && this.checkedOptions) {
            return Object.values(this.checkedOptions).every(function (value) { return value === false; });
        }
        return false;
    };
    PoCheckboxGroupBaseComponent.prototype.removeDuplicatedOptions = function () {
        var _this = this;
        this.options.forEach(function (option, index) {
            var duplicatedIndex = _this.options.findIndex(function (optionFind) { return optionFind.value === option.value; }) === index;
            if (!duplicatedIndex) {
                _this.options.splice(_this.options.indexOf(option), 1);
            }
        });
    };
    PoCheckboxGroupBaseComponent.prototype.setCheckboxGroupOptionsView = function (optionsList) {
        this.checkboxGroupOptionsView = optionsList.map(function (option) {
            return __assign(__assign({}, option), { id: uuid() });
        });
    };
    __decorate([
        Input('p-auto-focus'), InputBoolean(),
        __metadata("design:type", Boolean)
    ], PoCheckboxGroupBaseComponent.prototype, "autoFocus", void 0);
    __decorate([
        Input('name'),
        __metadata("design:type", String)
    ], PoCheckboxGroupBaseComponent.prototype, "name", void 0);
    __decorate([
        Input('p-columns'),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], PoCheckboxGroupBaseComponent.prototype, "columns", null);
    __decorate([
        Input('p-disabled'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], PoCheckboxGroupBaseComponent.prototype, "disabled", null);
    __decorate([
        Input('p-help'),
        __metadata("design:type", String)
    ], PoCheckboxGroupBaseComponent.prototype, "help", void 0);
    __decorate([
        Input('p-indeterminate'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], PoCheckboxGroupBaseComponent.prototype, "indeterminate", null);
    __decorate([
        Input('p-label'),
        __metadata("design:type", String)
    ], PoCheckboxGroupBaseComponent.prototype, "label", void 0);
    __decorate([
        Input('p-optional'),
        __metadata("design:type", Boolean)
    ], PoCheckboxGroupBaseComponent.prototype, "optional", void 0);
    __decorate([
        Input('p-options'),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], PoCheckboxGroupBaseComponent.prototype, "options", null);
    __decorate([
        Input('p-required'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], PoCheckboxGroupBaseComponent.prototype, "required", null);
    __decorate([
        Output('ngModelChange'),
        __metadata("design:type", EventEmitter)
    ], PoCheckboxGroupBaseComponent.prototype, "ngModelChange", void 0);
    __decorate([
        Output('p-change'),
        __metadata("design:type", EventEmitter)
    ], PoCheckboxGroupBaseComponent.prototype, "change", void 0);
    PoCheckboxGroupBaseComponent = __decorate([
        Directive()
    ], PoCheckboxGroupBaseComponent);
    return PoCheckboxGroupBaseComponent;
}());
export { PoCheckboxGroupBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hlY2tib3gtZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWNoZWNrYm94LWdyb3VwL3BvLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0UsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLL0MsSUFBTSxtQ0FBbUMsR0FBVyxDQUFDLENBQUM7QUFDdEQsSUFBTSxpQ0FBaUMsR0FBVyxFQUFFLENBQUM7QUFFckQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E0Qkc7QUFFSDtJQUFBO1FBRUUsbUJBQWMsR0FBUSxFQUFFLENBQUM7UUFDekIsdUJBQWtCLEdBQVEsRUFBRSxDQUFDO1FBQzdCLGNBQVMsR0FBVyxtQ0FBbUMsQ0FBQztRQUloRCxhQUFRLEdBQVcsbUNBQW1DLENBQUM7UUFDdkQsY0FBUyxHQUFhLEtBQUssQ0FBQztRQUM1QixtQkFBYyxHQUFhLEtBQUssQ0FBQztRQUVqQyxjQUFTLEdBQWEsS0FBSyxDQUFDO1FBRXBDOzs7Ozs7Ozs7O1dBVUc7UUFDb0MsY0FBUyxHQUFZLEtBQUssQ0FBQztRQWdJbEUsMkdBQTJHO1FBQ2xGLGtCQUFhLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7UUFFckYsaURBQWlEO1FBQzdCLFdBQU0sR0FBdUIsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQTJIM0UsQ0FBQztJ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LDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgRGlyZWN0aXZlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGNvbnZlcnRUb0Jvb2xlYW4sIGNvbnZlcnRUb0ludCwgdXVpZCB9IGZyb20gJy4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFBvQ2hlY2tib3hHcm91cE9wdGlvbiB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1jaGVja2JveC1ncm91cC1vcHRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hlY2tib3hHcm91cE9wdGlvblZpZXcgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tY2hlY2tib3gtZ3JvdXAtb3B0aW9uLXZpZXcuaW50ZXJmYWNlJztcblxuY29uc3QgcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg6IG51bWJlciA9IDY7XG5jb25zdCBwb0NoZWNrYm94R3JvdXBDb2x1bW5zVG90YWxMZW5ndGg6IG51bWJlciA9IDEyO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gY29tcG9uZW50ZSBgcG8tY2hlY2tib3gtZ3JvdXBgIGV4aWJlIHVtYSBsaXN0YSBkZSBtw7psdGlwbGEgZXNjb2xoYSBvbmRlIG8gdXN1w6FyaW8gcG9kZSBtYXJjYXIgZSBkZXNtYXJjYXIsXG4gKiB1dGlsaXphbmRvIGEgdGVjbGEgZGUgZXNwYcOnbyBvdSBvIGNsaXF1ZSBkbyBtb3VzZSwgdsOhcmlhcyBvcMOnw7Vlcy5cbiAqXG4gKiA+IFBhcmEgc2VsZcOnw6NvIMO6bmljYSwgdXRpbGl6ZSBvIFsqKlBPIFJhZGlvIEdyb3VwKipdKC9kb2N1bWVudGF0aW9uL3BvLXJhZGlvLWdyb3VwKS5cbiAqXG4gKiBQb3IgcGFkcsOjbywgbyBwby1jaGVja2JveC1ncm91cCByZXRvcm5hIHVtIGFycmF5IGNvbSBvcyB2YWxvcmVzIGRvcyBpdGVucyBzZWxlY2lvbmFkb3MgcGFyYSBvIG1vZGVsLlxuICpcbiAqIGBgYFxuICogZmF2b3JpdGVzID0gWydQTycsICdBbmd1bGFyJ107XG4gKiBgYGBcbiAqXG4gKiBOYSBtYWlvcmlhIGRhcyBzaXR1YcOnw7VlcywgbyBhcnJheSBjb20gb3Mgb2JqZXRvcyBzZXRhZG9zIGrDoSBhdGVuZGUgYXMgbmVjZXNzaWRhZGVzIG1hcywgY2FzbyBvIGRlc2Vudm9sdmVkb3JcbiAqIHRlbmhhIG5lY2Vzc2lkYWRlIGRlIHVzYXIgdW0gdmFsb3IgaW5kZXRlcm1pbmFkbyAoYG51bGxgKSwgb3Ugc2VqYSwgbmVtIG1hcmNhZG8gKGB0cnVlYCkgZSBuZW0gZGVzbWFyY2FkbyAoYGZhbHNlYCksXG4gKiBkZXZlIHNldGFyIGEgcHJvcHJpZWRhZGUgYHAtaW5kZXRlcm1pbmF0ZWAgY29tbyBgdHJ1ZWAuXG4gKlxuICogTmVzc2UgY2FzbywgbyBwby1jaGVja2JveC1ncm91cCB2YWkgcmV0b3JuYXIgdW0gb2JqZXRvIGNvbSB0b2RhcyBhcyBvcMOnw7VlcyBkaXNwb27DrXZlaXMgZSBzZXVzIHZhbG9yZXMuXG4gKlxuICogYGBgXG4gKiBmYXZvcml0ZXMgPSB7XG4gKiAgUE86IHRydWUsXG4gKiAgQW5ndWxhcjogdHJ1ZSxcbiAqICBWdWVKUzogZmFsc2UsXG4gKiAgUmVhY3Q6IG51bGwgLy8gaW5kZXRlcm1pbmFkb1xuICogfTtcbiAqIGBgYFxuICovXG5ARGlyZWN0aXZlKClcbmV4cG9ydCBjbGFzcyBQb0NoZWNrYm94R3JvdXBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XG4gIGNoZWNrYm94R3JvdXBPcHRpb25zVmlldzogQXJyYXk8UG9DaGVja2JveEdyb3VwT3B0aW9uVmlldz47XG4gIGNoZWNrZWRPcHRpb25zOiBhbnkgPSB7fTtcbiAgY2hlY2tlZE9wdGlvbnNMaXN0OiBhbnkgPSBbXTtcbiAgbWRDb2x1bW5zOiBudW1iZXIgPSBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgcHJvcGFnYXRlQ2hhbmdlOiBhbnk7XG4gIHZhbGlkYXRvckNoYW5nZTogYW55O1xuXG4gIHByaXZhdGUgX2NvbHVtbnM6IG51bWJlciA9IHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICBwcml2YXRlIF9kaXNhYmxlZD86IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaW5kZXRlcm1pbmF0ZT86IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfb3B0aW9ucz86IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj47XG4gIHByaXZhdGUgX3JlcXVpcmVkPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogPiBDYXNvIG1haXMgZGUgdW0gZWxlbWVudG8gc2VqYSBjb25maWd1cmFkbyBjb20gZXNzYSBwcm9wcmllZGFkZSwgYXBlbmFzIG8gw7psdGltbyBlbGVtZW50byBkZWNsYXJhZG8gY29tIGVsYSB0ZXLDoSBvIGZvY28uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1hdXRvLWZvY3VzJykgQElucHV0Qm9vbGVhbigpIGF1dG9Gb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBOb21lIGRvcyBjaGVja2JveGVzICovXG4gIEBJbnB1dCgnbmFtZScpIG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBQb3NzaWJpbGl0YSBkZWZpbmlyIGEgcXVhbnRpZGFkZSBkZSBjb2x1bmFzIHBhcmEgZXhpYmnDp8OjbyBkb3MgaXRlbnMgZG8gKmNoZWNrYm94Ki5cbiAgICogLSDDiSBwb3Nzw612ZWwgZXhpYmlyIGFzIG9ww6fDtWVzIGVudHJlIGAxYCBlIGA0YCBjb2x1bmFzLlxuICAgKiAtIFBhcmEgcmVzb2x1w6fDo28gYHNtYCBhIGNvbHVuYWdlbSBpbnZhcmlhdmVsbWVudGUgcGFzc2EgcGFyYSBgMWAgY29sdW5hLlxuICAgKiAtIFF1YW5kbyBzZSB0cmF0YSBkZSByZXNvbHXDp8OjbyBgbWRgIGUgbyB2YWxvciBlc3RhYmVsZWNpZG8gcGFyYSBjb2x1bmFzIGZvciBzdXBlcmlvciBhIGAyYCxcbiAgICogbyAqZ3JpZCBzeXN0ZW0qIHNlcsOhIGNvbXBvc3RvIHBvciBgMmAgY29sdW5hcy5cbiAgICogLSBQYXJhIGV2aXRhciBhIHF1ZWJyYSBkZSBsaW5oYSwgcHJlZmlyYSBhIHV0aWxpemHDp8OjbyBkZSBgMWAgY29sdW5hIHBhcmEgb3DDp8O1ZXMgY29tIHRleHRvcyBncmFuZGVzLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgMmBcbiAgICpcbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBjb252ZXJ0VG9JbnQodmFsdWUsIHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoKTtcblxuICAgIHRoaXMuX2NvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDQpO1xuICAgIHRoaXMubWRDb2x1bW5zID0gdGhpcy5nZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zLCAyKTtcbiAgfVxuXG4gIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVzYWJpbGl0YSB0b2RvcyBvcyBpdGVucyBkbyBjaGVja2JveC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWRpc2FibGVkJykgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fZGlzYWJsZWQgPSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCh0aGlzLmNoZWNrSW5kZXRlcm1pbmF0ZSgpKTtcbiAgfVxuXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gIH1cblxuICAvKiogVGV4dG8gZGUgYXBvaW8gZG8gY2FtcG8gKi9cbiAgQElucHV0KCdwLWhlbHAnKSBoZWxwPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIENhc28gZXhpc3RhIGEgbmVjZXNzaWRhZGUgZGUgdXNhciBvIHZhbG9yIGluZGV0ZXJtaW5hZG8gKGBudWxsYCkgZGVudHJvIGRhIGxpc3RhIGRlIG9ww6fDtWVzLCDDqSBuZWNlc3PDoXJpbyBzZXRhclxuICAgKiBhIHByb3ByaWVkYWRlIGBwLWluZGV0ZXJtaW5hdGVgIGNvbW8gYHRydWVgLCBwb3IgcGFkcsOjbyBlc3NhIHByb3ByaWVkYWRlIHZlbSBkZXNhYmlsaXRhZGEgKGBmYWxzZWApLlxuICAgKlxuICAgKiBRdWFuZG8gZXNzYSBwcm9wcmllZGFkZSDDqSBzZXRhZGEgY29tbyBgdHJ1ZWAsIG8gKnBvLWNoZWNrYm94LWdyb3VwKiBwYXNzYSBhIGRldm9sdmVyIHVtIG9iamV0byBjb21wbGV0byBwYXJhIG9cbiAgICogYG5nTW9kZWxgLCBkaWZlcmVudGUgZG8gYXJyYXkgcXVlIGNvbnTDqW0gYXBlbmFzIG9zIHZhbG9yZXMgc2VsZWNpb25hZG9zLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3AtaW5kZXRlcm1pbmF0ZScpIHNldCBpbmRldGVybWluYXRlKGluZGV0ZXJtaW5hdGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pbmRldGVybWluYXRlID0gY29udmVydFRvQm9vbGVhbihpbmRldGVybWluYXRlKTtcbiAgfVxuXG4gIGdldCBpbmRldGVybWluYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9pbmRldGVybWluYXRlO1xuICB9XG5cbiAgLyoqIExhYmVsIGRvIGNhbXBvICovXG4gIEBJbnB1dCgncC1sYWJlbCcpIGxhYmVsPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBhIGluZGljYcOnw6NvIGRlIGNhbXBvIG9wY2lvbmFsIHNlcsOhIGV4aWJpZGEuXG4gICAqXG4gICAqID4gTsOjbyBzZXLDoSBleGliaWRhIGEgaW5kaWNhw6fDo28gc2U6XG4gICAqIC0gTyBjYW1wbyBjb250ZXIgYHAtcmVxdWlyZWRgO1xuICAgKiAtIE7Do28gcG9zc3VpciBgcC1oZWxwYCBlL291IGBwLWxhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbmFsJykgb3B0aW9uYWw6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogTGlzdGEgZGUgb3DDp8O1ZXMgcXVlIHNlcsOjbyBleGliaWRhc1xuICAgKiBOZXN0YSBwcm9wcmllZGFkZSBkZXZlIHNlciBkZWZpbmlkbyB1bSBhcnJheSBkZSBvYmpldG9zIHF1ZSBpbXBsZW1lbnRhbSBhIGludGVyZmFjZSBQb0NoZWNrYm94R3JvdXBPcHRpb25cbiAgICovXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IG9wdGlvbnModmFsdWU6IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj4pIHtcbiAgICB0aGlzLl9vcHRpb25zID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFtdO1xuICAgIHRoaXMucmVtb3ZlRHVwbGljYXRlZE9wdGlvbnMoKTtcbiAgICB0aGlzLnNldENoZWNrYm94R3JvdXBPcHRpb25zVmlldyh0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgcXVlIG8gY2FtcG8gc2Vyw6Egb2JyaWdhdMOzcmlvLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3AtcmVxdWlyZWQnKSBzZXQgcmVxdWlyZWQocmVxdWlyZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9yZXF1aXJlZCA9IGNvbnZlcnRUb0Jvb2xlYW4ocmVxdWlyZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCkpO1xuICB9XG5cbiAgZ2V0IHJlcXVpcmVkKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1aXJlZDtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIHBhcmEgYXR1YWxpemFyIG8gYG5nTW9kZWxgIGRvIGNvbXBvbmVudGUsIG5lY2Vzc8OhcmlvIHF1YW5kbyBuw6NvIGZvciB1dGlsaXphZG8gZGVudHJvIGRhIHRhZyBmb3JtLlxuICBAT3V0cHV0KCduZ01vZGVsQ2hhbmdlJykgbmdNb2RlbENoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYW8gYWx0ZXJhciB2YWxvciBkbyBjYW1wbyAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY2hhbmdlVmFsdWUoKSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmNoZWNrSW5kZXRlcm1pbmF0ZSgpO1xuXG4gICAgaWYgKHRoaXMucHJvcGFnYXRlQ2hhbmdlKSB7XG4gICAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdNb2RlbENoYW5nZS5lbWl0KHZhbHVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZS5lbWl0KHZhbHVlKTtcbiAgfVxuXG4gIGNoZWNrSW5kZXRlcm1pbmF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbmRldGVybWluYXRlID8gdGhpcy5jaGVja2VkT3B0aW9ucyA6IHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0O1xuICB9XG5cbiAgY2hlY2tPcHRpb24odmFsdWU6IFBvQ2hlY2tib3hHcm91cE9wdGlvbikge1xuICAgIGlmICghdGhpcy5fZGlzYWJsZWQgJiYgIXZhbHVlLmRpc2FibGVkKSB7XG4gICAgICB0aGlzLmNoZWNrT3B0aW9uTW9kZWwodmFsdWUpO1xuICAgICAgdGhpcy5jaGFuZ2VWYWx1ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7fVxuXG4gIHdyaXRlVmFsdWUob3B0aW9uc01vZGVsOiBhbnkpIHtcbiAgICBpZiAob3B0aW9uc01vZGVsICYmIHRoaXMuY2hlY2tlZE9wdGlvbnMgIT09IG9wdGlvbnNNb2RlbCkge1xuICAgICAgdGhpcy5nZW5lcmF0ZUNoZWNrT3B0aW9ucyhvcHRpb25zTW9kZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdCA9IFtdO1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25WYWxpZGF0b3JDaGFuZ2UoZm46ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLnZhbGlkYXRvckNoYW5nZSA9IGZuO1xuICB9XG5cbiAgdmFsaWRhdGUoYWJzdHJhY3RDb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcbiAgICBpZiAoXG4gICAgICAoIXRoaXMuaW5kZXRlcm1pbmF0ZSAmJiByZXF1aXJlZEZhaWxlZCh0aGlzLnJlcXVpcmVkLCB0aGlzLmRpc2FibGVkLCBhYnN0cmFjdENvbnRyb2wudmFsdWUpKSB8fFxuICAgICAgdGhpcy5pc0ludmFsaWRJbmRldGVybWluYXRlKClcbiAgICApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlcXVpcmVkOiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHZhbGlkYXRlTW9kZWwobW9kZWw6IGFueSkge1xuICAgIGlmICh0aGlzLnZhbGlkYXRvckNoYW5nZSkge1xuICAgICAgdGhpcy52YWxpZGF0b3JDaGFuZ2UobW9kZWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDb2x1bW5zUmFuZ2UoY29sdW1ucywgbWF4Q29sdW1ucyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG1pbkNvbHVtbnMgPSAxO1xuXG4gICAgcmV0dXJuIGNvbHVtbnMgPj0gbWluQ29sdW1ucyAmJiBjb2x1bW5zIDw9IG1heENvbHVtbnM7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrT3B0aW9uTW9kZWwob3B0aW9uQ2hlY2tlZDogUG9DaGVja2JveEdyb3VwT3B0aW9uKSB7XG4gICAgdGhpcy5jaGVja2VkT3B0aW9uc1tvcHRpb25DaGVja2VkLnZhbHVlXSA9ICF0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbkNoZWNrZWQudmFsdWVdO1xuXG4gICAgaWYgKCF0aGlzLmluZGV0ZXJtaW5hdGUgJiYgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QuaW5jbHVkZXMob3B0aW9uQ2hlY2tlZC52YWx1ZSkpIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LnNwbGljZSh0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5pbmRleE9mKG9wdGlvbkNoZWNrZWQudmFsdWUpLCAxKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmluZGV0ZXJtaW5hdGUpIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LnB1c2gob3B0aW9uQ2hlY2tlZC52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNoZWNrT3B0aW9ucyhvcHRpb25zTW9kZWw6IGFueSkge1xuICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSB7fTtcblxuICAgIGlmIChvcHRpb25zTW9kZWwgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QgPSBvcHRpb25zTW9kZWw7XG5cbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb246IFBvQ2hlY2tib3hHcm91cE9wdGlvbikgPT4ge1xuICAgICAgICB0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbi52YWx1ZV0gPSBvcHRpb25zTW9kZWwuaW5jbHVkZXMob3B0aW9uLnZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uOiBQb0NoZWNrYm94R3JvdXBPcHRpb24pID0+IHtcbiAgICAgICAgb3B0aW9uc01vZGVsW29wdGlvbi52YWx1ZV0gPSBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXTtcbiAgICAgICAgdGhpcy5jaGVja2VkT3B0aW9ucyA9IG9wdGlvbnNNb2RlbDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1uczogbnVtYmVyLCBtYXhDb2x1bW5zOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IGdyaWRTeXN0ZW1Db2x1bW5zID0gcG9DaGVja2JveEdyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoIC8gY29sdW1ucztcblxuICAgIHJldHVybiB0aGlzLmNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpID8gZ3JpZFN5c3RlbUNvbHVtbnMgOiBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgfVxuXG4gIHByaXZhdGUgaXNJbnZhbGlkSW5kZXRlcm1pbmF0ZSgpIHtcbiAgICBpZiAodGhpcy5pbmRldGVybWluYXRlICYmIHRoaXMucmVxdWlyZWQgJiYgdGhpcy5jaGVja2VkT3B0aW9ucykge1xuICAgICAgcmV0dXJuICg8YW55Pk9iamVjdCkudmFsdWVzKHRoaXMuY2hlY2tlZE9wdGlvbnMpLmV2ZXJ5KHZhbHVlID0+IHZhbHVlID09PSBmYWxzZSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRHVwbGljYXRlZE9wdGlvbnMoKSB7XG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZWRJbmRleCA9IHRoaXMub3B0aW9ucy5maW5kSW5kZXgoKG9wdGlvbkZpbmQ6IGFueSkgPT4gb3B0aW9uRmluZC52YWx1ZSA9PT0gb3B0aW9uLnZhbHVlKSA9PT0gaW5kZXg7XG4gICAgICBpZiAoIWR1cGxpY2F0ZWRJbmRleCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuc3BsaWNlKHRoaXMub3B0aW9ucy5pbmRleE9mKG9wdGlvbiksIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDaGVja2JveEdyb3VwT3B0aW9uc1ZpZXcob3B0aW9uc0xpc3Q6IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj4pIHtcbiAgICB0aGlzLmNoZWNrYm94R3JvdXBPcHRpb25zVmlldyA9IG9wdGlvbnNMaXN0Lm1hcChvcHRpb24gPT4ge1xuICAgICAgcmV0dXJuIHsgLi4ub3B0aW9uLCBpZDogdXVpZCgpIH07XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==