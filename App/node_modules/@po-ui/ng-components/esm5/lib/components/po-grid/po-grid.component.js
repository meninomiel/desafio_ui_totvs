import { __decorate, __metadata, __read, __spread } from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Input, OnDestroy, Renderer2, ViewChild } from '@angular/core';
/**
 * @description
 *
 * Componente grid.
 *
 * Ações / atalhos:
 *
 * - ARROW-UP: Navega para celula superior / Na ultima linha adiciona uma linha em branco no grid;
 * - ARROW-DOWN: Navega para celula inferior;
 * - ARROW-RIGHT: Navega para celula direita;
 * - ARROW-LEFT: Navega para celula esquerda;
 * - TAB: Navega para próxima celula;
 * - SHIFT+TAB: Navega para celula anterior;
 * - CTRL+DEL: Remove linha;
 * - DEL/BACKSPACE: Limpa celula;
 * - ENTER: Edita linha com valor atual/Confirma edição da celula;
 * - DOUBLE-CLICK: Edita linha com valor atual;
 * - ESC: Cancela edição da celula / Cancela inserção de linhas em branco;
 * - A..Z/0..9: Inicia edição com valor em branco.
 *
 * @example
 *
 * <example name="po-grid-basic" title="PO Grid Basic">
 *  <file name="sample-po-grid-basic/sample-po-grid-basic.component.html"> </file>
 *  <file name="sample-po-grid-basic/sample-po-grid-basic.component.ts"> </file>
 * </example>
 */
var PoGridComponent = /** @class */ (function () {
    function PoGridComponent(changeDetectorRef, elRef, renderer) {
        var _this = this;
        this.changeDetectorRef = changeDetectorRef;
        this.elRef = elRef;
        this.lastCell = '0-0';
        this.lastRow = 0;
        this.lastColumn = 0;
        this.currencyCell = '0-0';
        this.currencyRow = 0;
        this.currencyColumn = 0;
        this.logger = false;
        this.width = '100%';
        this.widporeeze = 0;
        this.widthActions = 0;
        this._columns = [];
        /**
         * @description
         *
         * Ações disparadas quando uma linha do grid é manipulada.
         */
        this.rowActions = {};
        /**
         * Lista com os dados que serão exibidos no grid.
         */
        this.data = [];
        this.debounceResize();
        this.resizeListener = renderer.listen('window', 'resize', function (event) {
            _this.debounceResize();
        });
    }
    Object.defineProperty(PoGridComponent.prototype, "columns", {
        get: function () {
            return this._columns.filter(function (column) { return column.freeze !== true && column.action !== true; });
        },
        /**
         * Colunas exibidas no grid.
         */
        set: function (value) {
            this._columns = __spread(value);
            this._columns.forEach(function (column) {
                column.label = column.label || column.property;
                if (column.freeze === true) {
                    column.cssWidth = (column.width || 100) + "px";
                }
                else {
                    column.cssWidth = column.width ? column.width + "px" : '100%';
                }
            });
        },
        enumerable: true,
        configurable: true
    });
    PoGridComponent.prototype.ngOnDestroy = function () {
        if (this.resizeListener) {
            this.resizeListener();
        }
    };
    PoGridComponent.prototype.debounceResize = function () {
        var _this = this;
        clearTimeout(this.timeoutResize);
        this.timeoutResize = setTimeout(function () {
            var widthTableWrapper = _this.tableWrapper.nativeElement.offsetWidth;
            _this.width = widthTableWrapper - (_this.widporeeze + 8) - _this.widthActions + "px";
        }, 100);
    };
    Object.defineProperty(PoGridComponent.prototype, "freezeColumns", {
        get: function () {
            var freezeColumns = this._columns.filter(function (column) { return column.freeze === true; });
            this.widporeeze = freezeColumns.reduce(function (prev, current) { return prev + (current.width || 100); }, 0);
            return freezeColumns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoGridComponent.prototype, "actionColumns", {
        get: function () {
            var actionsColumns = this._columns.filter(function (column) { return column.action === true; });
            this.widthActions = actionsColumns.length > 0 ? 56 : 0;
            return actionsColumns;
        },
        enumerable: true,
        configurable: true
    });
    PoGridComponent.prototype.cancelRow = function (event, row) {
        var _this = this;
        var el = event.path.find(function (element) { return element.id; });
        if (!el) {
            return;
        }
        var _a = __read(el.id.split('-'), 1), x = _a[0];
        if (this.isEmptyRow(x)) {
            if (!this.removeRow(event, row)) {
                return;
            }
            this.currencyObj = Object.assign({}, this.data[this.currencyRow - 1]);
        }
        else {
            this.data[+x - 1] = Object.assign({}, this.currencyObj);
            setTimeout(function () { return _this.selectCell(_this.currencyRow, _this.currencyColumn); });
        }
    };
    PoGridComponent.prototype.removeRow = function (event, row) {
        if (this.rowActions.beforeRemove && !this.rowActions.beforeRemove(Object.assign({}, row))) {
            return false;
        }
        var index = this.data.indexOf(row);
        this.data.splice(index, 1);
        this.changeDetectorRef.detectChanges();
        if (this.data.length === 0 || index === this.data.length) {
            this.selectCell(this.currencyRow - 1, this.currencyColumn);
        }
        else {
            this.selectCell(this.currencyRow, this.currencyColumn);
        }
        return true;
    };
    PoGridComponent.prototype.tableKeydown = function (event, direction) {
        var _a = __read(event.target.id.split('-'), 2), row = _a[0], col = _a[1];
        row = +row;
        col = +col;
        var prow = +row;
        var pcol = +col;
        // event.preventDefault();
        // event.stopPropagation();
        // debugger;
        if (direction === 'down') {
            if (row <= this.data.length) {
                prow++;
            }
            if (row === this.data.length) {
                if (row === 0 || !this.isEmptyRow(row)) {
                    if (this.saveRow(row)) {
                        if (!this.insertRow()) {
                            return;
                        }
                    }
                    else {
                        return;
                    }
                }
                else {
                    prow--;
                }
            }
        }
        else if (direction === 'up' && row > 0) {
            prow--;
        }
        else if (direction === 'left' && col > 0) {
            pcol--;
        }
        else if (direction === 'right' && col < this._columns.length - 1) {
            pcol++;
        }
        else if (direction === 'next') {
            if (col < this._columns.length - 1) {
                pcol++;
                event.preventDefault();
            }
            else if (row < this.data.length) {
                pcol = 0;
                prow++;
                event.preventDefault();
            }
        }
        else if (direction === 'prior') {
            if (col > 0) {
                pcol--;
                event.preventDefault();
            }
            else if (row > 0) {
                pcol = this._columns.length - 1;
                prow--;
                event.preventDefault();
            }
        }
        if (this.currencyCell === prow + "-" + pcol) {
            // console.log('vazou');
            return;
        }
        // debugger;
        if (prow !== this.currencyRow && row > 0 && this.data.length >= row) {
            if (!this.isEmptyRow(row)) {
                if (!this.saveRow(row)) {
                    return;
                }
            }
            else {
                if (!this.removeRow(event, row)) {
                    return;
                }
            }
        }
        if (this.currencyRow !== prow) {
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('mudou de linha');
        }
        this.lastCell = event.target.id;
        this.lastRow = row;
        this.lastColumn = col;
        this.selectCell(prow, pcol);
    };
    PoGridComponent.prototype.tableClick = function (event) {
        var el = event.path.find(function (element) { return element.id; });
        if (!el) {
            this.selectCell(this.currencyRow, this.currencyColumn);
            return;
        }
        if (this.currencyCell === el.id) {
            return;
        }
        var _a = __read(el.id.split('-'), 2), row = _a[0], col = _a[1];
        var prow = +row;
        var pcol = +col;
        if (prow !== this.currencyRow) {
            if (this.currencyRow > 0) {
                if (!this.isEmptyRow(this.currencyRow)) {
                    if (!this.saveRow(this.currencyRow)) {
                        this.selectCell(this.currencyRow, this.currencyColumn);
                        return;
                    }
                }
                else {
                    if (!this.removeRow(event, row)) {
                        return;
                    }
                }
            }
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('>>>>>>> ', prow - 1);
        }
        this.lastCell = this.currencyCell;
        this.lastRow = this.currencyRow;
        this.lastColumn = this.currencyColumn;
        this.currencyCell = el.id;
        this.currencyRow = prow;
        this.currencyColumn = pcol;
    };
    PoGridComponent.prototype.saveRow = function (row) {
        // console.log(this.data[row - 1]);
        var _this = this;
        var obj = this.data[row - 1];
        if (!Object.keys(obj).some(function (prop) { return obj[prop] !== _this.currencyObj[prop]; })) {
            // console.log('tudo igual');
            return true;
        }
        if (this.rowActions.beforeSave && !this.rowActions.beforeSave(obj, this.currencyObj)) {
            return false;
        }
        var requireds = [];
        this.columns.forEach(function (column) {
            if (column.required === true && !obj[column.property]) {
                requireds.push(column.property);
            }
        });
        return requireds.length === 0;
    };
    PoGridComponent.prototype.insertRow = function () {
        var obj = {};
        if (this.rowActions.beforeInsert && !this.rowActions.beforeInsert(obj)) {
            return false;
        }
        // this.currencyObj = Object.assign({}, obj);
        this.data.push(obj);
        this.changeDetectorRef.detectChanges();
        return true;
    };
    PoGridComponent.prototype.isEmptyRow = function (row) {
        var obj = this.data[row - 1];
        if (!obj) {
            // title
            return false;
        }
        var filled = Object.keys(obj).some(function (property) { return obj[property]; });
        return !filled;
    };
    PoGridComponent.prototype.selectCell = function (row, col) {
        var nextCell = this.elRef.nativeElement.querySelector("[id='" + row + "-" + col + "']");
        if (nextCell) {
            this.currencyCell = row + "-" + col;
            this.currencyRow = row;
            this.currencyColumn = col;
            nextCell.focus();
        }
    };
    PoGridComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    __decorate([
        ViewChild('table', { static: true }),
        __metadata("design:type", ElementRef)
    ], PoGridComponent.prototype, "tableElement", void 0);
    __decorate([
        ViewChild('wrapper', { static: true }),
        __metadata("design:type", ElementRef)
    ], PoGridComponent.prototype, "tableWrapper", void 0);
    __decorate([
        Input('p-row-actions'),
        __metadata("design:type", Object)
    ], PoGridComponent.prototype, "rowActions", void 0);
    __decorate([
        Input('p-columns'),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], PoGridComponent.prototype, "columns", null);
    __decorate([
        Input('p-data'),
        __metadata("design:type", Array)
    ], PoGridComponent.prototype, "data", void 0);
    PoGridComponent = __decorate([
        Component({
            selector: 'po-grid',
            template: "<div class=\"po-grid-wrapper po-grid-row-wrapper\" #wrapper>\n  <div *ngIf=\"logger\">\n    lastCell: {{ lastCell }} | currencyCell: {{ currencyCell }} <br />\n    lastRow: {{ lastRow }} | currencyRow: {{ currencyRow }} <br />\n    lastColumn: {{ lastColumn }} | currencyColumn: {{ currencyColumn }} <br />\n    <hr />\n    currencyObj: {{ currencyObj | json }}\n    <hr />\n  </div>\n\n  <div class=\"po-grid\">\n    <div class=\"po-grid-body\">\n      <div\n        class=\"po-grid-row\"\n        #table\n        (keydown.arrowup)=\"tableKeydown($event, 'up')\"\n        (keydown.arrowdown)=\"tableKeydown($event, 'down')\"\n        (keydown.arrowleft)=\"tableKeydown($event, 'left')\"\n        (keydown.arrowright)=\"tableKeydown($event, 'right')\"\n        (keydown.tab)=\"tableKeydown($event, 'next')\"\n        (keydown.shift.tab)=\"tableKeydown($event, 'prior')\"\n        (click)=\"tableClick($event)\"\n        (contextmenu)=\"tableClick($event)\"\n        (dblclick)=\"tableClick($event)\"\n      >\n        <div class=\"po-grid-cell po-grid-cell-freeze\" *ngIf=\"freezeColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divFreezeColumns\"></ng-container>\n        </div>\n\n        <div\n          class=\"po-grid-cell po-grid-cell-normal\"\n          [style.width]=\"width\"\n          [style.max-width]=\"width\"\n          [style.min-width]=\"width\"\n        >\n          <ng-container *ngTemplateOutlet=\"divColumns\"></ng-container>\n        </div>\n\n        <div class=\"po-grid-cell po-grid-cell-action\" *ngIf=\"actionColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divActionColumns\"></ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- <div class=\"po-grid-footer-wrapper\">\n    <div class=\"po-grid-footer\">\n      <div class=\"links\"><a href=\"#\">RODAP\u00C9</a></div>\n    </div>\n  </div> -->\n</div>\n\n<!-- Coluna com as colunas congeladas -->\n<ng-template #divFreezeColumns>\n  <div class=\"po-grid po-grid-freeze\">\n    <div class=\"po-grid-header-group\">\n      <div class=\"po-grid-row\">\n        <po-grid-head\n          *ngFor=\"let column of freezeColumns; index as i\"\n          class=\"po-grid-title\"\n          [style.width]=\"column.cssWidth\"\n          [style.max-width]=\"column.cssWidth\"\n          [style.min-width]=\"column.cssWidth\"\n          p-freeze=\"true\"\n          p-position=\"{{ '0-' + i }}\"\n          [p-width]=\"column.width\"\n          [p-align]=\"column.align\"\n          [p-title]=\"column.label\"\n        >\n        </po-grid-head>\n      </div>\n    </div>\n\n    <div class=\"po-grid-body\">\n      <div\n        class=\"po-grid-row\"\n        *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\"\n      >\n        <po-grid-cell\n          *ngFor=\"let column of freezeColumns; index as i\"\n          class=\"po-grid-cell\"\n          [style.width]=\"column.cssWidth\"\n          [style.max-width]=\"column.cssWidth\"\n          [style.min-width]=\"column.cssWidth\"\n          p-freeze=\"true\"\n          [p-align]=\"column.align\"\n          [p-readonly]=\"column.readonly\"\n          [p-required]=\"column.required\"\n          p-position=\"{{ j + 1 + '-' + i }}\"\n          [p-width]=\"column.width\"\n          [(p-value)]=\"row[column.property]\"\n        >\n        </po-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas congeladas -->\n\n<!-- Coluna com as colunas nornais -->\n<ng-template #divColumns>\n  <div class=\"po-grid po-grid-normal\">\n    <div class=\"po-grid-header-group\">\n      <div class=\"po-grid-row\">\n        <po-grid-head\n          *ngFor=\"let column of columns; index as i\"\n          class=\"po-grid-title\"\n          [style.width]=\"column.cssWidth\"\n          [style.max-width]=\"column.cssWidth\"\n          [style.min-width]=\"column.cssWidth\"\n          [p-align]=\"column.align\"\n          p-position=\"{{ '0-' + (i + freezeColumns.length) }}\"\n          [p-title]=\"column.label\"\n          [p-width]=\"column.width\"\n        >\n        </po-grid-head>\n      </div>\n    </div>\n\n    <div class=\"po-grid-body\">\n      <div\n        class=\"po-grid-row\"\n        *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\"\n      >\n        <po-grid-cell\n          *ngFor=\"let column of columns; index as i\"\n          class=\"po-grid-cell\"\n          [style.width]=\"column.cssWidth\"\n          [style.max-width]=\"column.cssWidth\"\n          [style.min-width]=\"column.cssWidth\"\n          [p-align]=\"column.align\"\n          [p-readonly]=\"column.readonly\"\n          [p-required]=\"column.required\"\n          p-position=\"{{ j + 1 + '-' + (i + freezeColumns.length) }}\"\n          [(p-value)]=\"row[column.property]\"\n          [p-width]=\"column.width\"\n        >\n        </po-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas nornais -->\n\n<!-- Coluna com as colunas de a\u00E7\u00E3o -->\n<ng-template #divActionColumns>\n  <div class=\"po-grid po-grid-actions\">\n    <div class=\"po-grid-header-group\">\n      <div class=\"po-grid-row\">\n        <po-grid-head\n          *ngFor=\"let column of actionColumns; index as i\"\n          class=\"po-grid-title\"\n          p-position=\"{{ '0-' + (i + freezeColumns.length + columns.length) }}\"\n          [p-title]=\"column.label\"\n          [p-align]=\"column.align\"\n        >\n        </po-grid-head>\n      </div>\n    </div>\n\n    <div class=\"po-grid-body\">\n      <div\n        class=\"po-grid-row\"\n        *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\"\n      >\n        <po-grid-cell-action\n          *ngFor=\"let column of actionColumns; index as i\"\n          class=\"po-grid-cell\"\n          p-position=\"{{ j + 1 + '-' + (i + freezeColumns.length + columns.length) }}\"\n          [p-value]=\"row[column.property]\"\n        >\n        </po-grid-cell-action>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas de a\u00E7\u00E3o -->\n"
        }),
        __metadata("design:paramtypes", [ChangeDetectorRef, ElementRef, Renderer2])
    ], PoGridComponent);
    return PoGridComponent;
}());
export { PoGridComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ3JpZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWdyaWQvcG8tZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUlqSDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EwQkc7QUFLSDtJQXVERSx5QkFBb0IsaUJBQW9DLEVBQVUsS0FBaUIsRUFBRSxRQUFtQjtRQUF4RyxpQkFNQztRQU5tQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQXREbkYsYUFBUSxHQUFXLEtBQUssQ0FBQztRQUN6QixZQUFPLEdBQVcsQ0FBQyxDQUFDO1FBQ3BCLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsaUJBQVksR0FBVyxLQUFLLENBQUM7UUFDN0IsZ0JBQVcsR0FBVyxDQUFDLENBQUM7UUFDeEIsbUJBQWMsR0FBVyxDQUFDLENBQUM7UUFHM0IsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUVmLFVBQUssR0FBRyxNQUFNLENBQUM7UUFDZixlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFRVCxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBRXRCOzs7O1dBSUc7UUFDcUIsZUFBVSxHQUFxQixFQUFFLENBQUM7UUFzQjFEOztXQUVHO1FBQ2MsU0FBSSxHQUFlLEVBQUUsQ0FBQztRQUdyQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsVUFBQyxLQUFVO1lBQ25F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O1lBQ3ZCLElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDO1lBQzFCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNsQjtJQUNILENBQUM7O2dCQTlRc0MsaUJBQWlCO2dCQUFpQixVQUFVO2dCQUFZLFNBQVM7O0lBckNsRTtRQUFyQyxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO2tDQUFlLFVBQVU7eURBQUM7SUFDdkI7UUFBdkMsU0FBUyxDQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztrQ0FBZSxVQUFVO3lEQUFDO0lBU3pDO1FBQXZCLEtBQUssQ0FBQyxlQUFlLENBQUM7O3VEQUFtQztJQUt0QztRQUFuQixLQUFLLENBQUMsV0FBVyxDQUFDO2tDQUFvQixLQUFLO3lDQUFMLEtBQUs7a0RBWTNDO0lBUWdCO1FBQWhCLEtBQUssQ0FBQyxRQUFRLENBQUM7a0NBQU8sS0FBSztpREFBVztJQXJENUIsZUFBZTtRQUozQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsU0FBUztZQUNuQixzdE1BQXVDO1NBQ3hDLENBQUM7eUNBd0R1QyxpQkFBaUIsRUFBaUIsVUFBVSxFQUFZLFNBQVM7T0F2RDdGLGVBQWUsQ0FzVTNCO0lBQUQsc0JBQUM7Q0FBQSxBQXRVRCxJQXNVQztTQXRVWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIE9uRGVzdHJveSwgUmVuZGVyZXIyLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgUG9HcmlkUm93QWN0aW9ucyB9IGZyb20gJy4vcG8tZ3JpZC1yb3ctYWN0aW9ucy5pbnRlcmZhY2UnO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgZ3JpZC5cbiAqXG4gKiBBw6fDtWVzIC8gYXRhbGhvczpcbiAqXG4gKiAtIEFSUk9XLVVQOiBOYXZlZ2EgcGFyYSBjZWx1bGEgc3VwZXJpb3IgLyBOYSB1bHRpbWEgbGluaGEgYWRpY2lvbmEgdW1hIGxpbmhhIGVtIGJyYW5jbyBubyBncmlkO1xuICogLSBBUlJPVy1ET1dOOiBOYXZlZ2EgcGFyYSBjZWx1bGEgaW5mZXJpb3I7XG4gKiAtIEFSUk9XLVJJR0hUOiBOYXZlZ2EgcGFyYSBjZWx1bGEgZGlyZWl0YTtcbiAqIC0gQVJST1ctTEVGVDogTmF2ZWdhIHBhcmEgY2VsdWxhIGVzcXVlcmRhO1xuICogLSBUQUI6IE5hdmVnYSBwYXJhIHByw7N4aW1hIGNlbHVsYTtcbiAqIC0gU0hJRlQrVEFCOiBOYXZlZ2EgcGFyYSBjZWx1bGEgYW50ZXJpb3I7XG4gKiAtIENUUkwrREVMOiBSZW1vdmUgbGluaGE7XG4gKiAtIERFTC9CQUNLU1BBQ0U6IExpbXBhIGNlbHVsYTtcbiAqIC0gRU5URVI6IEVkaXRhIGxpbmhhIGNvbSB2YWxvciBhdHVhbC9Db25maXJtYSBlZGnDp8OjbyBkYSBjZWx1bGE7XG4gKiAtIERPVUJMRS1DTElDSzogRWRpdGEgbGluaGEgY29tIHZhbG9yIGF0dWFsO1xuICogLSBFU0M6IENhbmNlbGEgZWRpw6fDo28gZGEgY2VsdWxhIC8gQ2FuY2VsYSBpbnNlcsOnw6NvIGRlIGxpbmhhcyBlbSBicmFuY287XG4gKiAtIEEuLlovMC4uOTogSW5pY2lhIGVkacOnw6NvIGNvbSB2YWxvciBlbSBicmFuY28uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tZ3JpZC1iYXNpY1wiIHRpdGxlPVwiUE8gR3JpZCBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tZ3JpZC1iYXNpYy9zYW1wbGUtcG8tZ3JpZC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1ncmlkLWJhc2ljL3NhbXBsZS1wby1ncmlkLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWdyaWQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tZ3JpZC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9HcmlkQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgbGFzdENlbGw6IHN0cmluZyA9ICcwLTAnO1xuICBsYXN0Um93OiBudW1iZXIgPSAwO1xuICBsYXN0Q29sdW1uOiBudW1iZXIgPSAwO1xuICBjdXJyZW5jeUNlbGw6IHN0cmluZyA9ICcwLTAnO1xuICBjdXJyZW5jeVJvdzogbnVtYmVyID0gMDtcbiAgY3VycmVuY3lDb2x1bW46IG51bWJlciA9IDA7XG4gIGN1cnJlbmN5T2JqOiBhbnk7XG5cbiAgbG9nZ2VyID0gZmFsc2U7XG5cbiAgd2lkdGggPSAnMTAwJSc7XG4gIHdpZHBvcmVlemUgPSAwO1xuICB3aWR0aEFjdGlvbnMgPSAwO1xuXG4gIHByaXZhdGUgcmVzaXplTGlzdGVuZXI6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgdGltZW91dFJlc2l6ZTtcblxuICBAVmlld0NoaWxkKCd0YWJsZScsIHsgc3RhdGljOiB0cnVlIH0pIHRhYmxlRWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnd3JhcHBlcicsIHsgc3RhdGljOiB0cnVlIH0pIHRhYmxlV3JhcHBlcjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIF9jb2x1bW5zID0gW107XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBBw6fDtWVzIGRpc3BhcmFkYXMgcXVhbmRvIHVtYSBsaW5oYSBkbyBncmlkIMOpIG1hbmlwdWxhZGEuXG4gICAqL1xuICBASW5wdXQoJ3Atcm93LWFjdGlvbnMnKSByb3dBY3Rpb25zOiBQb0dyaWRSb3dBY3Rpb25zID0ge307XG5cbiAgLyoqXG4gICAqIENvbHVuYXMgZXhpYmlkYXMgbm8gZ3JpZC5cbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLl9jb2x1bW5zID0gWy4uLnZhbHVlXTtcblxuICAgIHRoaXMuX2NvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgY29sdW1uLmxhYmVsID0gY29sdW1uLmxhYmVsIHx8IGNvbHVtbi5wcm9wZXJ0eTtcblxuICAgICAgaWYgKGNvbHVtbi5mcmVlemUgPT09IHRydWUpIHtcbiAgICAgICAgY29sdW1uLmNzc1dpZHRoID0gYCR7Y29sdW1uLndpZHRoIHx8IDEwMH1weGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2x1bW4uY3NzV2lkdGggPSBjb2x1bW4ud2lkdGggPyBgJHtjb2x1bW4ud2lkdGh9cHhgIDogJzEwMCUnO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGdldCBjb2x1bW5zKCk6IEFycmF5PGFueT4ge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmZyZWV6ZSAhPT0gdHJ1ZSAmJiBjb2x1bW4uYWN0aW9uICE9PSB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0YSBjb20gb3MgZGFkb3MgcXVlIHNlcsOjbyBleGliaWRvcyBubyBncmlkLlxuICAgKi9cbiAgQElucHV0KCdwLWRhdGEnKSBkYXRhOiBBcnJheTxhbnk+ID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgZWxSZWY6IEVsZW1lbnRSZWYsIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICB0aGlzLmRlYm91bmNlUmVzaXplKCk7XG5cbiAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyID0gcmVuZGVyZXIubGlzdGVuKCd3aW5kb3cnLCAncmVzaXplJywgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgIHRoaXMuZGVib3VuY2VSZXNpemUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnJlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkZWJvdW5jZVJlc2l6ZSgpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0UmVzaXplKTtcblxuICAgIHRoaXMudGltZW91dFJlc2l6ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3Qgd2lkdGhUYWJsZVdyYXBwZXIgPSB0aGlzLnRhYmxlV3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy53aWR0aCA9IGAke3dpZHRoVGFibGVXcmFwcGVyIC0gKHRoaXMud2lkcG9yZWV6ZSArIDgpIC0gdGhpcy53aWR0aEFjdGlvbnN9cHhgO1xuICAgIH0sIDEwMCk7XG4gIH1cblxuICBnZXQgZnJlZXplQ29sdW1ucygpIHtcbiAgICBjb25zdCBmcmVlemVDb2x1bW5zID0gdGhpcy5fY29sdW1ucy5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5mcmVlemUgPT09IHRydWUpO1xuXG4gICAgdGhpcy53aWRwb3JlZXplID0gZnJlZXplQ29sdW1ucy5yZWR1Y2UoKHByZXYsIGN1cnJlbnQpID0+IHByZXYgKyAoY3VycmVudC53aWR0aCB8fCAxMDApLCAwKTtcblxuICAgIHJldHVybiBmcmVlemVDb2x1bW5zO1xuICB9XG5cbiAgZ2V0IGFjdGlvbkNvbHVtbnMoKSB7XG4gICAgY29uc3QgYWN0aW9uc0NvbHVtbnMgPSB0aGlzLl9jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmFjdGlvbiA9PT0gdHJ1ZSk7XG5cbiAgICB0aGlzLndpZHRoQWN0aW9ucyA9IGFjdGlvbnNDb2x1bW5zLmxlbmd0aCA+IDAgPyA1NiA6IDA7XG5cbiAgICByZXR1cm4gYWN0aW9uc0NvbHVtbnM7XG4gIH1cblxuICBjYW5jZWxSb3coZXZlbnQ6IGFueSwgcm93OiBhbnkpIHtcbiAgICBjb25zdCBlbCA9IGV2ZW50LnBhdGguZmluZChlbGVtZW50ID0+IGVsZW1lbnQuaWQpO1xuXG4gICAgaWYgKCFlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFt4XSA9IGVsLmlkLnNwbGl0KCctJyk7XG5cbiAgICBpZiAodGhpcy5pc0VtcHR5Um93KHgpKSB7XG4gICAgICBpZiAoIXRoaXMucmVtb3ZlUm93KGV2ZW50LCByb3cpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jdXJyZW5jeU9iaiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZGF0YVt0aGlzLmN1cnJlbmN5Um93IC0gMV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRhdGFbK3ggLSAxXSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY3VycmVuY3lPYmopO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNlbGVjdENlbGwodGhpcy5jdXJyZW5jeVJvdywgdGhpcy5jdXJyZW5jeUNvbHVtbikpO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZVJvdyhldmVudDogYW55LCByb3c6IGFueSk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlUmVtb3ZlICYmICF0aGlzLnJvd0FjdGlvbnMuYmVmb3JlUmVtb3ZlKE9iamVjdC5hc3NpZ24oe30sIHJvdykpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmRhdGEuaW5kZXhPZihyb3cpO1xuXG4gICAgdGhpcy5kYXRhLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcblxuICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID09PSAwIHx8IGluZGV4ID09PSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jdXJyZW5jeVJvdyAtIDEsIHRoaXMuY3VycmVuY3lDb2x1bW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jdXJyZW5jeVJvdywgdGhpcy5jdXJyZW5jeUNvbHVtbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB0YWJsZUtleWRvd24oZXZlbnQ6IGFueSwgZGlyZWN0aW9uOiBzdHJpbmcpIHtcbiAgICBsZXQgW3JvdywgY29sXSA9IGV2ZW50LnRhcmdldC5pZC5zcGxpdCgnLScpO1xuICAgIHJvdyA9ICtyb3c7XG4gICAgY29sID0gK2NvbDtcbiAgICBsZXQgcHJvdyA9ICtyb3c7XG4gICAgbGV0IHBjb2wgPSArY29sO1xuXG4gICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIC8vIGRlYnVnZ2VyO1xuICAgIGlmIChkaXJlY3Rpb24gPT09ICdkb3duJykge1xuICAgICAgaWYgKHJvdyA8PSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgIHByb3crKztcbiAgICAgIH1cblxuICAgICAgaWYgKHJvdyA9PT0gdGhpcy5kYXRhLmxlbmd0aCkge1xuICAgICAgICBpZiAocm93ID09PSAwIHx8ICF0aGlzLmlzRW1wdHlSb3cocm93KSkge1xuICAgICAgICAgIGlmICh0aGlzLnNhdmVSb3cocm93KSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmluc2VydFJvdygpKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcm93LS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJyAmJiByb3cgPiAwKSB7XG4gICAgICBwcm93LS07XG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiBjb2wgPiAwKSB7XG4gICAgICBwY29sLS07XG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgY29sIDwgdGhpcy5fY29sdW1ucy5sZW5ndGggLSAxKSB7XG4gICAgICBwY29sKys7XG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICduZXh0Jykge1xuICAgICAgaWYgKGNvbCA8IHRoaXMuX2NvbHVtbnMubGVuZ3RoIC0gMSkge1xuICAgICAgICBwY29sKys7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9IGVsc2UgaWYgKHJvdyA8IHRoaXMuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgcGNvbCA9IDA7XG4gICAgICAgIHByb3crKztcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ3ByaW9yJykge1xuICAgICAgaWYgKGNvbCA+IDApIHtcbiAgICAgICAgcGNvbC0tO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSBlbHNlIGlmIChyb3cgPiAwKSB7XG4gICAgICAgIHBjb2wgPSB0aGlzLl9jb2x1bW5zLmxlbmd0aCAtIDE7XG4gICAgICAgIHByb3ctLTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jdXJyZW5jeUNlbGwgPT09IGAke3Byb3d9LSR7cGNvbH1gKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygndmF6b3UnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBkZWJ1Z2dlcjtcbiAgICBpZiAocHJvdyAhPT0gdGhpcy5jdXJyZW5jeVJvdyAmJiByb3cgPiAwICYmIHRoaXMuZGF0YS5sZW5ndGggPj0gcm93KSB7XG4gICAgICBpZiAoIXRoaXMuaXNFbXB0eVJvdyhyb3cpKSB7XG4gICAgICAgIGlmICghdGhpcy5zYXZlUm93KHJvdykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghdGhpcy5yZW1vdmVSb3coZXZlbnQsIHJvdykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jdXJyZW5jeVJvdyAhPT0gcHJvdykge1xuICAgICAgdGhpcy5jdXJyZW5jeU9iaiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZGF0YVtwcm93IC0gMV0pO1xuICAgICAgLy8gY29uc29sZS5sb2coJ211ZG91IGRlIGxpbmhhJyk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0Q2VsbCA9IGV2ZW50LnRhcmdldC5pZDtcbiAgICB0aGlzLmxhc3RSb3cgPSByb3c7XG4gICAgdGhpcy5sYXN0Q29sdW1uID0gY29sO1xuXG4gICAgdGhpcy5zZWxlY3RDZWxsKHByb3csIHBjb2wpO1xuICB9XG5cbiAgdGFibGVDbGljayhldmVudDogYW55KSB7XG4gICAgY29uc3QgZWwgPSBldmVudC5wYXRoLmZpbmQoZWxlbWVudCA9PiBlbGVtZW50LmlkKTtcblxuICAgIGlmICghZWwpIHtcbiAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93LCB0aGlzLmN1cnJlbmN5Q29sdW1uKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jdXJyZW5jeUNlbGwgPT09IGVsLmlkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgW3JvdywgY29sXSA9IGVsLmlkLnNwbGl0KCctJyk7XG4gICAgY29uc3QgcHJvdyA9ICtyb3c7XG4gICAgY29uc3QgcGNvbCA9ICtjb2w7XG5cbiAgICBpZiAocHJvdyAhPT0gdGhpcy5jdXJyZW5jeVJvdykge1xuICAgICAgaWYgKHRoaXMuY3VycmVuY3lSb3cgPiAwKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0VtcHR5Um93KHRoaXMuY3VycmVuY3lSb3cpKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnNhdmVSb3codGhpcy5jdXJyZW5jeVJvdykpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93LCB0aGlzLmN1cnJlbmN5Q29sdW1uKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnJlbW92ZVJvdyhldmVudCwgcm93KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kYXRhW3Byb3cgLSAxXSk7XG4gICAgICAvLyBjb25zb2xlLmxvZygnPj4+Pj4+PiAnLCBwcm93IC0gMSk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0Q2VsbCA9IHRoaXMuY3VycmVuY3lDZWxsO1xuICAgIHRoaXMubGFzdFJvdyA9IHRoaXMuY3VycmVuY3lSb3c7XG4gICAgdGhpcy5sYXN0Q29sdW1uID0gdGhpcy5jdXJyZW5jeUNvbHVtbjtcblxuICAgIHRoaXMuY3VycmVuY3lDZWxsID0gZWwuaWQ7XG4gICAgdGhpcy5jdXJyZW5jeVJvdyA9IHByb3c7XG4gICAgdGhpcy5jdXJyZW5jeUNvbHVtbiA9IHBjb2w7XG4gIH1cblxuICBzYXZlUm93KHJvdzogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5kYXRhW3JvdyAtIDFdKTtcblxuICAgIGNvbnN0IG9iaiA9IHRoaXMuZGF0YVtyb3cgLSAxXTtcblxuICAgIGlmICghT2JqZWN0LmtleXMob2JqKS5zb21lKHByb3AgPT4gb2JqW3Byb3BdICE9PSB0aGlzLmN1cnJlbmN5T2JqW3Byb3BdKSkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ3R1ZG8gaWd1YWwnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlU2F2ZSAmJiAhdGhpcy5yb3dBY3Rpb25zLmJlZm9yZVNhdmUob2JqLCB0aGlzLmN1cnJlbmN5T2JqKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcXVpcmVkcyA9IFtdO1xuXG4gICAgdGhpcy5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgIGlmIChjb2x1bW4ucmVxdWlyZWQgPT09IHRydWUgJiYgIW9ialtjb2x1bW4ucHJvcGVydHldKSB7XG4gICAgICAgIHJlcXVpcmVkcy5wdXNoKGNvbHVtbi5wcm9wZXJ0eSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVxdWlyZWRzLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIGluc2VydFJvdygpIHtcbiAgICBjb25zdCBvYmogPSB7fTtcblxuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlSW5zZXJ0ICYmICF0aGlzLnJvd0FjdGlvbnMuYmVmb3JlSW5zZXJ0KG9iaikpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgb2JqKTtcblxuICAgIHRoaXMuZGF0YS5wdXNoKG9iaik7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlzRW1wdHlSb3cocm93OiBudW1iZXIpIHtcbiAgICBjb25zdCBvYmogPSB0aGlzLmRhdGFbcm93IC0gMV07XG5cbiAgICBpZiAoIW9iaikge1xuICAgICAgLy8gdGl0bGVcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWxsZWQgPSBPYmplY3Qua2V5cyhvYmopLnNvbWUocHJvcGVydHkgPT4gb2JqW3Byb3BlcnR5XSk7XG5cbiAgICByZXR1cm4gIWZpbGxlZDtcbiAgfVxuXG4gIHNlbGVjdENlbGwocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKSB7XG4gICAgY29uc3QgbmV4dENlbGwgPSB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihgW2lkPScke3Jvd30tJHtjb2x9J11gKTtcblxuICAgIGlmIChuZXh0Q2VsbCkge1xuICAgICAgdGhpcy5jdXJyZW5jeUNlbGwgPSBgJHtyb3d9LSR7Y29sfWA7XG4gICAgICB0aGlzLmN1cnJlbmN5Um93ID0gcm93O1xuICAgICAgdGhpcy5jdXJyZW5jeUNvbHVtbiA9IGNvbDtcbiAgICAgIG5leHRDZWxsLmZvY3VzKCk7XG4gICAgfVxuICB9XG59XG4iXX0=