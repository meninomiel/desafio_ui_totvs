import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectorRef, Component, ContentChildren, QueryList, ViewChild } from '@angular/core';
import { isMobile } from './../../utils/util';
import { PoTabComponent } from './po-tab/po-tab.component';
import { PoTabDropdownComponent } from './po-tab-dropdown/po-tab-dropdown.component';
import { PoTabsBaseComponent } from './po-tabs-base.component';
var poTabsMaxNumberOfTabs = 5;
/**
 * @docsExtends PoTabsBaseComponent
 *
 * @example
 *
 * <example name="po-tabs-basic" title="PO Tabs Basic">
 *  <file name="sample-po-tabs-basic/sample-po-tabs-basic.component.html"> </file>
 *  <file name="sample-po-tabs-basic/sample-po-tabs-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-labs" title="PO Tabs Labs">
 *  <file name="sample-po-tabs-labs/sample-po-tabs-labs.component.html"> </file>
 *  <file name="sample-po-tabs-labs/sample-po-tabs-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-travel" title="PO Tabs - Travel">
 *  <file name="sample-po-tabs-travel/sample-po-tabs-travel.component.html"> </file>
 *  <file name="sample-po-tabs-travel/sample-po-tabs-travel.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-business-conf" title="PO Tabs - Business Conference">
 *  <file name="sample-po-tabs-business-conf/sample-po-tabs-business-conf.component.html"> </file>
 *  <file name="sample-po-tabs-business-conf/sample-po-tabs-business-conf.component.ts"> </file>
 * </example>
 */
var PoTabsComponent = /** @class */ (function (_super) {
    __extends(PoTabsComponent, _super);
    function PoTabsComponent(changeDetector) {
        var _this = _super.call(this) || this;
        _this.changeDetector = changeDetector;
        _this.maxNumberOfTabs = poTabsMaxNumberOfTabs;
        return _this;
    }
    Object.defineProperty(PoTabsComponent.prototype, "isMobileDevice", {
        get: function () {
            return isMobile();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoTabsComponent.prototype, "isShowTabDropdown", {
        get: function () {
            return !this.isMobileDevice && this.visibleTabs.length > this.maxNumberOfTabs;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoTabsComponent.prototype, "overflowedTabs", {
        // tabs que serão apresentadas na aba "Mais"
        get: function () {
            var _this = this;
            return this.visibleTabs.filter(function (_tab, index) { return index > _this.maxNumberOfTabs - 2; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoTabsComponent.prototype, "visibleTabs", {
        get: function () {
            return this.tabs.filter(function (tab) { return !tab.hide; });
        },
        enumerable: true,
        configurable: true
    });
    PoTabsComponent.prototype.closePopover = function () {
        var containsPopoverVisible = this.tabDropdown && this.tabDropdown.popover && !this.tabDropdown.popover.isHidden;
        if (containsPopoverVisible) {
            this.tabDropdown.popover.close();
        }
    };
    PoTabsComponent.prototype.isVisibleTab = function (tab) {
        if (this.isMobileDevice) {
            return true;
        }
        var visibleTabIndex = this.visibleTabs.findIndex(function (visibleTab) { return visibleTab.id === tab.id; });
        return this.visibleTabs.length <= this.maxNumberOfTabs || visibleTabIndex < this.maxNumberOfTabs - 1;
    };
    // Função disparada quando alguma tab ficar ativa
    PoTabsComponent.prototype.onTabActive = function (tab) {
        this.previousActiveTab = this.tabs.find(function (tabChild) { return tabChild.active && tabChild.id !== tab.id; });
        this.deactivateTab();
    };
    // funcao será disparada quando mudar o estado do poTab para desabilitado ou escondido.
    PoTabsComponent.prototype.onTabChangeState = function (tab) {
        if (tab.active) {
            tab.active = false;
            this.activeDistinctTab();
            this.changeDetector.detectChanges();
        }
    };
    // selectiona a aba informada por parametro, caso houver click faz a emição do evento.
    PoTabsComponent.prototype.selectedTab = function (tab) {
        tab.active = true;
        if (tab.click) {
            tab.click.emit(tab);
        }
        this.changeDetector.detectChanges();
    };
    PoTabsComponent.prototype.trackByFn = function (_i, tab) {
        return tab.id;
    };
    // ativa a previousActiveTab ou primeira tab encontrada.
    PoTabsComponent.prototype.activeDistinctTab = function () {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = true;
        }
        else {
            this.activeFirstTab();
        }
    };
    // Ativa a primeira Tab que não estiver desabilitada ou escondida.
    PoTabsComponent.prototype.activeFirstTab = function () {
        this.tabs.some(function (tabChild) {
            if (!tabChild.disabled && !tabChild.hide) {
                tabChild.active = true;
                return true;
            }
        });
    };
    // desativa previousActiveTab e dispara a detecção de mudança.
    PoTabsComponent.prototype.deactivateTab = function () {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = false;
            this.changeDetector.detectChanges();
        }
    };
    PoTabsComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        ContentChildren(PoTabComponent),
        __metadata("design:type", QueryList)
    ], PoTabsComponent.prototype, "tabs", void 0);
    __decorate([
        ViewChild('tabDropdown', { static: true }),
        __metadata("design:type", PoTabDropdownComponent)
    ], PoTabsComponent.prototype, "tabDropdown", void 0);
    PoTabsComponent = __decorate([
        Component({
            selector: 'po-tabs',
            template: "<div class=\"po-tabs-container\" [class.po-tabs-container-mobile]=\"isMobileDevice\">\n  <div class=\"po-tabs-header\">\n    <ng-container *ngFor=\"let tab of tabs; trackBy: trackByFn\">\n      <po-tab-button\n        *ngIf=\"isVisibleTab(tab)\"\n        class=\"po-tab-button\"\n        [class.po-tab-button-mobile]=\"isMobileDevice\"\n        [p-active]=\"tab.active\"\n        [p-disabled]=\"tab.disabled\"\n        [p-hide]=\"tab.hide\"\n        [p-id]=\"tab.id\"\n        [p-label]=\"tab.label\"\n        [p-small]=\"small\"\n        (keyup.enter)=\"closePopover()\"\n        (p-activated)=\"onTabActive(tab)\"\n        (p-change-state)=\"onTabChangeState(tab)\"\n        (p-click)=\"selectedTab(tab)\"\n      >\n      </po-tab-button>\n    </ng-container>\n\n    <po-tab-dropdown\n      #tabDropdown\n      *ngIf=\"isShowTabDropdown\"\n      class=\"po-tab-button po-tab-dropdown\"\n      p-label=\"Mais\"\n      [p-small]=\"small\"\n      [p-tabs]=\"overflowedTabs\"\n      (p-activated)=\"onTabActive($event)\"\n      (p-change-state)=\"onTabChangeState($event)\"\n      (p-click)=\"selectedTab($event)\"\n    >\n    </po-tab-dropdown>\n  </div>\n</div>\n\n<div class=\"po-tabs-content\">\n  <ng-content></ng-content>\n</div>\n"
        }),
        __metadata("design:paramtypes", [ChangeDetectorRef])
    ], PoTabsComponent);
    return PoTabsComponent;
}(PoTabsBaseComponent));
export { PoTabsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdGFicy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLXRhYnMvcG8tdGFicy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFcEcsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTlDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQUNyRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUUvRCxJQUFNLHFCQUFxQixHQUFHLENBQUMsQ0FBQztBQUVoQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0JHO0FBS0g7SUFBcUMsbUNBQW1CO0lBVXRELHlCQUFvQixjQUFpQztRQUFyRCxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsb0JBQWMsR0FBZCxjQUFjLENBQW1CO1FBVHJELHFCQUFlLEdBQUcscUJBQXFCLENBQUM7O0lBV3hDLENBQUM7SUFFRCxzQkFBSSwyQ0FBYzthQUFsQjtZQUNFLE9BQU8sUUFBUSxFQUFFLENBQUM7UUFDcEIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw4Q0FBaUI7YUFBckI7WUFDRSxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQ2hGLENBQUM7OztPQUFBO0lBR0Qsc0JBQUksMkNBQWM7UUFEbEIsNENBQTRDO2FBQzVDO1lBQUEsaUJBRUM7WUFEQyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFD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LFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3hDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO2dCQUN2QixPQUFPLElBQUksQ0FBQzthQUNiO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsOERBQThEO0lBQ3RELHVDQUFhLEdBQXJCO1FBQ0UsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFFdEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUNyQztJQUNILENBQUM7O2dCQWxHbUMsaUJBQWlCOztJQUpwQjtRQUFoQyxlQUFlLENBQUMsY0FBYyxDQUFDO2tDQUFPLFNBQVM7aURBQWlCO0lBRXJCO1FBQTNDLFNBQVMsQ0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQWMsc0JBQXNCO3dEQUFDO0lBUnJFLGVBQWU7UUFKM0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFNBQVM7WUFDbkIsK3RDQUF1QztTQUN4QyxDQUFDO3lDQVdvQyxpQkFBaUI7T0FWMUMsZUFBZSxDQTZHM0I7SUFBRCxzQkFBQztDQUFBLEFBN0dELENBQXFDLG1CQUFtQixHQTZHdkQ7U0E3R1ksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgaXNNb2JpbGUgfSBmcm9tICcuLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb1RhYkNvbXBvbmVudCB9IGZyb20gJy4vcG8tdGFiL3BvLXRhYi5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9UYWJEcm9wZG93bkNvbXBvbmVudCB9IGZyb20gJy4vcG8tdGFiLWRyb3Bkb3duL3BvLXRhYi1kcm9wZG93bi5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9UYWJzQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tdGFicy1iYXNlLmNvbXBvbmVudCc7XG5cbmNvbnN0IHBvVGFic01heE51bWJlck9mVGFicyA9IDU7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvVGFic0Jhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10YWJzLWJhc2ljXCIgdGl0bGU9XCJQTyBUYWJzIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWJhc2ljL3NhbXBsZS1wby10YWJzLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtYmFzaWMvc2FtcGxlLXBvLXRhYnMtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdGFicy1sYWJzXCIgdGl0bGU9XCJQTyBUYWJzIExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtbGFicy9zYW1wbGUtcG8tdGFicy1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtbGFicy9zYW1wbGUtcG8tdGFicy1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXRhYnMtdHJhdmVsXCIgdGl0bGU9XCJQTyBUYWJzIC0gVHJhdmVsXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLXRyYXZlbC9zYW1wbGUtcG8tdGFicy10cmF2ZWwuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdGFicy10cmF2ZWwvc2FtcGxlLXBvLXRhYnMtdHJhdmVsLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXRhYnMtYnVzaW5lc3MtY29uZlwiIHRpdGxlPVwiUE8gVGFicyAtIEJ1c2luZXNzIENvbmZlcmVuY2VcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtYnVzaW5lc3MtY29uZi9zYW1wbGUtcG8tdGFicy1idXNpbmVzcy1jb25mLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtYnVzaW5lc3MtY29uZi9zYW1wbGUtcG8tdGFicy1idXNpbmVzcy1jb25mLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLXRhYnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tdGFicy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9UYWJzQ29tcG9uZW50IGV4dGVuZHMgUG9UYWJzQmFzZUNvbXBvbmVudCB7XG4gIG1heE51bWJlck9mVGFicyA9IHBvVGFic01heE51bWJlck9mVGFicztcblxuICBwcml2YXRlIHByZXZpb3VzQWN0aXZlVGFiOiBQb1RhYkNvbXBvbmVudDtcblxuICAvLyBUYWJzIHV0aWxpemFkb3Mgbm8gbmctY29udGVudFxuICBAQ29udGVudENoaWxkcmVuKFBvVGFiQ29tcG9uZW50KSB0YWJzOiBRdWVyeUxpc3Q8UG9UYWJDb21wb25lbnQ+O1xuXG4gIEBWaWV3Q2hpbGQoJ3RhYkRyb3Bkb3duJywgeyBzdGF0aWM6IHRydWUgfSkgdGFiRHJvcGRvd246IFBvVGFiRHJvcGRvd25Db21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgZ2V0IGlzTW9iaWxlRGV2aWNlKCkge1xuICAgIHJldHVybiBpc01vYmlsZSgpO1xuICB9XG5cbiAgZ2V0IGlzU2hvd1RhYkRyb3Bkb3duKCkge1xuICAgIHJldHVybiAhdGhpcy5pc01vYmlsZURldmljZSAmJiB0aGlzLnZpc2libGVUYWJzLmxlbmd0aCA+IHRoaXMubWF4TnVtYmVyT2ZUYWJzO1xuICB9XG5cbiAgLy8gdGFicyBxdWUgc2Vyw6NvIGFwcmVzZW50YWRhcyBuYSBhYmEgXCJNYWlzXCJcbiAgZ2V0IG92ZXJmbG93ZWRUYWJzKCkge1xuICAgIHJldHVybiB0aGlzLnZpc2libGVUYWJzLmZpbHRlcigoX3RhYiwgaW5kZXgpID0+IGluZGV4ID4gdGhpcy5tYXhOdW1iZXJPZlRhYnMgLSAyKTtcbiAgfVxuXG4gIGdldCB2aXNpYmxlVGFicygpIHtcbiAgICByZXR1cm4gdGhpcy50YWJzLmZpbHRlcih0YWIgPT4gIXRhYi5oaWRlKTtcbiAgfVxuXG4gIGNsb3NlUG9wb3ZlcigpOiB2b2lkIHtcbiAgICBjb25zdCBjb250YWluc1BvcG92ZXJWaXNpYmxlID0gdGhpcy50YWJEcm9wZG93biAmJiB0aGlzLnRhYkRyb3Bkb3duLnBvcG92ZXIgJiYgIXRoaXMudGFiRHJvcGRvd24ucG9wb3Zlci5pc0hpZGRlbjtcblxuICAgIGlmIChjb250YWluc1BvcG92ZXJWaXNpYmxlKSB7XG4gICAgICB0aGlzLnRhYkRyb3Bkb3duLnBvcG92ZXIuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBpc1Zpc2libGVUYWIodGFiKSB7XG4gICAgaWYgKHRoaXMuaXNNb2JpbGVEZXZpY2UpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IHZpc2libGVUYWJJbmRleCA9IHRoaXMudmlzaWJsZVRhYnMuZmluZEluZGV4KHZpc2libGVUYWIgPT4gdmlzaWJsZVRhYi5pZCA9PT0gdGFiLmlkKTtcblxuICAgIHJldHVybiB0aGlzLnZpc2libGVUYWJzLmxlbmd0aCA8PSB0aGlzLm1heE51bWJlck9mVGFicyB8fCB2aXNpYmxlVGFiSW5kZXggPCB0aGlzLm1heE51bWJlck9mVGFicyAtIDE7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgcXVhbmRvIGFsZ3VtYSB0YWIgZmljYXIgYXRpdmFcbiAgb25UYWJBY3RpdmUodGFiKSB7XG4gICAgdGhpcy5wcmV2aW91c0FjdGl2ZVRhYiA9IHRoaXMudGFicy5maW5kKHRhYkNoaWxkID0+IHRhYkNoaWxkLmFjdGl2ZSAmJiB0YWJDaGlsZC5pZCAhPT0gdGFiLmlkKTtcblxuICAgIHRoaXMuZGVhY3RpdmF0ZVRhYigpO1xuICB9XG5cbiAgLy8gZnVuY2FvIHNlcsOhIGRpc3BhcmFkYSBxdWFuZG8gbXVkYXIgbyBlc3RhZG8gZG8gcG9UYWIgcGFyYSBkZXNhYmlsaXRhZG8gb3UgZXNjb25kaWRvLlxuICBvblRhYkNoYW5nZVN0YXRlKHRhYjogUG9UYWJDb21wb25lbnQpIHtcbiAgICBpZiAodGFiLmFjdGl2ZSkge1xuICAgICAgdGFiLmFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICB0aGlzLmFjdGl2ZURpc3RpbmN0VGFiKCk7XG5cbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNlbGVjdGlvbmEgYSBhYmEgaW5mb3JtYWRhIHBvciBwYXJhbWV0cm8sIGNhc28gaG91dmVyIGNsaWNrIGZheiBhIGVtacOnw6NvIGRvIGV2ZW50by5cbiAgc2VsZWN0ZWRUYWIodGFiOiBQb1RhYkNvbXBvbmVudCkge1xuICAgIHRhYi5hY3RpdmUgPSB0cnVlO1xuXG4gICAgaWYgKHRhYi5jbGljaykge1xuICAgICAgdGFiLmNsaWNrLmVtaXQodGFiKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHRyYWNrQnlGbihfaSwgdGFiOiBQb1RhYkNvbXBvbmVudCkge1xuICAgIHJldHVybiB0YWIuaWQ7XG4gIH1cblxuICAvLyBhdGl2YSBhIHByZXZpb3VzQWN0aXZlVGFiIG91IHByaW1laXJhIHRhYiBlbmNvbnRyYWRhLlxuICBwcml2YXRlIGFjdGl2ZURpc3RpbmN0VGFiKCkge1xuICAgIGlmICh0aGlzLnByZXZpb3VzQWN0aXZlVGFiKSB7XG4gICAgICB0aGlzLnByZXZpb3VzQWN0aXZlVGFiLmFjdGl2ZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aXZlRmlyc3RUYWIoKTtcbiAgICB9XG4gIH1cblxuICAvLyBBdGl2YSBhIHByaW1laXJhIFRhYiBxdWUgbsOjbyBlc3RpdmVyIGRlc2FiaWxpdGFkYSBvdSBlc2NvbmRpZGEuXG4gIHByaXZhdGUgYWN0aXZlRmlyc3RUYWIoKSB7XG4gICAgdGhpcy50YWJzLnNvbWUodGFiQ2hpbGQgPT4ge1xuICAgICAgaWYgKCF0YWJDaGlsZC5kaXNhYmxlZCAmJiAhdGFiQ2hpbGQuaGlkZSkge1xuICAgICAgICB0YWJDaGlsZC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGRlc2F0aXZhIHByZXZpb3VzQWN0aXZlVGFiIGUgZGlzcGFyYSBhIGRldGVjw6fDo28gZGUgbXVkYW7Dp2EuXG4gIHByaXZhdGUgZGVhY3RpdmF0ZVRhYigpIHtcbiAgICBpZiAodGhpcy5wcmV2aW91c0FjdGl2ZVRhYikge1xuICAgICAgdGhpcy5wcmV2aW91c0FjdGl2ZVRhYi5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG59XG4iXX0=