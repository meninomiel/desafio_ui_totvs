import { __decorate, __extends, __metadata, __read, __spread } from "tslib";
import { AfterViewInit, ChangeDetectorRef, Component, ElementRef, OnDestroy, Renderer2, ViewChild } from '@angular/core';
import { animate, AnimationBuilder, AnimationFactory, AnimationPlayer, keyframes, style } from '@angular/animations';
import { PoNavbarBaseComponent } from './po-navbar-base.component';
import { PoNavbarItemsComponent } from './po-navbar-items/po-navbar-items.component';
var poNavbarNavigationWidth = 88;
var poNavbarMenuMedia = 768;
var poNavbarMatchMedia = "(max-width: " + poNavbarMenuMedia + "px)";
var poNavbarTiming = '250ms ease';
/**
 * @docsExtends PoNavbarBaseComponent
 */
var PoNavbarComponent = /** @class */ (function (_super) {
    __extends(PoNavbarComponent, _super);
    function PoNavbarComponent(renderer, builder, changeDetector) {
        var _this = _super.call(this) || this;
        _this.renderer = renderer;
        _this.builder = builder;
        _this.changeDetector = changeDetector;
        _this.showItemsNavigation = false;
        _this.offset = 0;
        _this.onMediaQueryChange = function (changed) {
            _this.changeNavbarMenuItems(changed.matches, _this.menuItems, _this.items, _this.literals.navbarLinks);
        };
        _this.windowResizeListener = _this.renderer.listen(window, 'resize', _this.displayItemsNavigation.bind(_this));
        return _this;
    }
    Object.defineProperty(PoNavbarComponent.prototype, "navbarItemNavigationDisableLeft", {
        get: function () {
            return this.offset === 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoNavbarComponent.prototype, "navbarItemNavigationDisableRight", {
        get: function () {
            return this.disableRight && this.offset !== 0;
        },
        enumerable: true,
        configurable: true
    });
    PoNavbarComponent.prototype.ngAfterViewInit = function () {
        this.displayItemsNavigation();
        if (this.menu) {
            this.initNavbarMenu();
        }
    };
    PoNavbarComponent.prototype.ngOnDestroy = function () {
        if (this.mediaQuery) {
            this.mediaQuery.removeListener(this.onMediaQueryChange);
        }
    };
    PoNavbarComponent.prototype.navigateItems = function (orientation) {
        orientation === 'left' ? this.navigateLeft() : this.navigateRight();
        this.animate(this.offset);
    };
    PoNavbarComponent.prototype.allNavbarItemsWidth = function () {
        return this.navbarItems.allNavbarItems.reduce(function (previous, current) { return previous + current.nativeElement.offsetWidth; }, 0);
    };
    PoNavbarComponent.prototype.animate = function (offset) {
        var animation = this.buildTransitionAnimation(offset);
        this.player = animation.create(this.navbarItems.navbarItemsContainer.nativeElement);
        this.player.play();
    };
    PoNavbarComponent.prototype.buildTransitionAnimation = function (offset) {
        return this.builder.build([animate(poNavbarTiming, keyframes([style({ transform: "translateX(" + -offset + "px)" })]))]);
    };
    PoNavbarComponent.prototype.changeNavbarMenuItems = function (isCollapsedMedia, menuItems, navbarItems, label) {
        if (isCollapsedMedia) {
            var subItems = [{ label: label, subItems: navbarItems }];
            this.menu.menus = __spread(subItems, menuItems);
        }
        else {
            this.menu.menus = menuItems;
        }
    };
    PoNavbarComponent.prototype.calculateLeftNavigation = function () {
        var _this = this;
        var calculatedOffset;
        this.navbarItems.allNavbarItems.some(function (navbarItem) {
            var navbarItemOffset = navbarItem.nativeElement.offsetLeft;
            var navbarItemWidth = navbarItem.nativeElement.offsetWidth;
            if (navbarItemOffset >= _this.offset) {
                calculatedOffset = navbarItemOffset - (_this.navbarItemsWidth() - navbarItemWidth);
                return true;
            }
        });
        return calculatedOffset;
    };
    PoNavbarComponent.prototype.calculateRightNavigation = function (itemBreakPoint) {
        var calculatedOffset;
        this.navbarItems.allNavbarItems.some(function (navbarItem) {
            var offsetLeft = navbarItem.nativeElement.offsetLeft;
            var finalPosition = navbarItem.nativeElement.offsetWidth + offsetLeft;
            if (itemBreakPoint < finalPosition) {
                calculatedOffset = offsetLeft;
                return true;
            }
        });
        return calculatedOffset;
    };
    PoNavbarComponent.prototype.displayItemsNavigation = function () {
        this.showItemsNavigation = this.navbarItemsWidth() < this.allNavbarItemsWidth() + poNavbarNavigationWidth;
        this.changeDetector.detectChanges();
        if (this.offset !== 0) {
            this.setOffsetToZero();
            this.animate(this.offset);
        }
    };
    PoNavbarComponent.prototype.initNavbarMenu = function () {
        this.mediaQuery = window.matchMedia(poNavbarMatchMedia);
        this.menuItems = this.menu.menus;
        if (window.innerWidth < poNavbarMenuMedia) {
            this.changeNavbarMenuItems(true, this.menuItems, this.items, this.literals.navbarLinks);
        }
        this.validateMenuLogo();
        this.mediaQuery.addListener(this.onMediaQueryChange);
    };
    PoNavbarComponent.prototype.navbarItemsWidth = function () {
        return this.navbarItemsElement.nativeElement.offsetWidth;
    };
    PoNavbarComponent.prototype.navigateLeft = function () {
        this.disableRight = false;
        this.offset = this.calculateLeftNavigation();
        if (this.offset < 0) {
            this.setOffsetToZero();
        }
    };
    PoNavbarComponent.prototype.navigateRight = function () {
        var maxAllowedOffset = this.allNavbarItemsWidth() - this.navbarItemsWidth();
        var itemBreakPoint = this.offset + this.navbarItemsWidth();
        this.offset = this.calculateRightNavigation(itemBreakPoint);
        this.validateMaxOffset(maxAllowedOffset);
    };
    PoNavbarComponent.prototype.setOffsetToZero = function () {
        this.offset = 0;
    };
    PoNavbarComponent.prototype.validateMaxOffset = function (maxAllowedOffset) {
        if (this.offset >= maxAllowedOffset) {
            this.offset = maxAllowedOffset;
            this.disableRight = true;
        }
    };
    PoNavbarComponent.prototype.validateMenuLogo = function () {
        if (this.menu.logo && this.logo) {
            this.menu.logo = undefined;
            this.menu.changeDetector.detectChanges();
        }
    };
    PoNavbarComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: AnimationBuilder },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        ViewChild(PoNavbarItemsComponent, { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], PoNavbarComponent.prototype, "navbarItemsElement", void 0);
    __decorate([
        ViewChild(PoNavbarItemsComponent, { static: true }),
        __metadata("design:type", PoNavbarItemsComponent)
    ], PoNavbarComponent.prototype, "navbarItems", void 0);
    PoNavbarComponent = __decorate([
        Component({
            selector: 'po-navbar',
            template: "<header class=\"po-navbar\" [ngClass]=\"{ 'po-navbar-shadow': shadow }\">\n  <po-navbar-logo\n    class=\"po-navbar-logo\"\n    [ngClass]=\"{ 'po-navbar-logo-menu': !!menu, 'po-navbar-no-logo': !logo }\"\n    [p-logo]=\"logo\"\n  >\n  </po-navbar-logo>\n\n  <po-navbar-items class=\"po-navbar-items\" [p-items]=\"items\"> </po-navbar-items>\n\n  <po-navbar-item-navigation\n    *ngIf=\"showItemsNavigation\"\n    class=\"po-navbar-item-navigation\"\n    [p-disable-left]=\"navbarItemNavigationDisableLeft\"\n    [p-disable-right]=\"navbarItemNavigationDisableRight\"\n    (p-click)=\"navigateItems($event)\"\n  >\n  </po-navbar-item-navigation>\n\n  <po-navbar-actions class=\"po-navbar-actions\" [p-icon-actions]=\"iconActions\"> </po-navbar-actions>\n</header>\n\n<po-menu *ngIf=\"!menu\" [p-menus]=\"items\"> </po-menu>\n"
        }),
        __metadata("design:paramtypes", [Renderer2,
            AnimationBuilder,
            ChangeDetectorRef])
    ], PoNavbarComponent);
    return PoNavbarComponent;
}(PoNavbarBaseComponent));
export { PoNavbarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbmF2YmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwby11aS9uZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tbmF2YmFyL3BvLW5hdmJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxhQUFhLEVBQ2IsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsU0FBUyxFQUNULFNBQVMsRUFDVCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3JILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRW5FLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZDQUE2QyxDQUFDO0FBRXJGLElBQU0sdUJBQXVCLEdBQUcsRUFBRSxDQUFDO0FBQ25DLElBQU0saUJBQWlCLEdBQUcsR0FBRyxDQUFDO0FBQzlCLElBQU0sa0JBQWtCLEdBQUcsaUJBQWUsaUJBQWlCLFFBQUssQ0FBQztBQUNqRSxJQUFNLGNBQWMsR0FBRyxZQUFZLENBQUM7QUFFcEM7O0dBRUc7QUFLSDtJQUF1QyxxQ0FBcUI7SUF1QjFELDJCQUNVLFFBQW1CLEVBQ25CLE9BQXlCLEVBQ3pCLGNBQWlDO1FBSDNDLFlBS0UsaUJBQU8sU0FFUjtRQU5TLGNBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsYUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDekIsb0JBQWMsR0FBZCxjQUFjLENBQW1CO1FBeEIzQyx5QkFBbUIsR0FBWSxLQUFLLENBQUM7UUFHN0IsWUFBTSxHQUFXLENBQUMsQ0FBQztRQTRKbkIsd0JBQWtCLEdBQUcsVUFBQSxPQUFPO1lBQ2xDLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENB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QkFBeUM7U0FDMUMsQ0FBQzt5Q0F5Qm9CLFNBQVM7WUFDVixnQkFBZ0I7WUFDVCxpQkFBaUI7T0ExQmhDLGlCQUFpQixDQXNMN0I7SUFBRCx3QkFBQztDQUFBLEFBdExELENBQXVDLHFCQUFxQixHQXNMM0Q7U0F0TFksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGFuaW1hdGUsIEFuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvbkZhY3RvcnksIEFuaW1hdGlvblBsYXllciwga2V5ZnJhbWVzLCBzdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuXG5pbXBvcnQgeyBQb01lbnVJdGVtIH0gZnJvbSAnLi4vcG8tbWVudSc7XG5pbXBvcnQgeyBQb05hdmJhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLW5hdmJhci1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb05hdmJhckl0ZW0gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tbmF2YmFyLWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvTmF2YmFySXRlbXNDb21wb25lbnQgfSBmcm9tICcuL3BvLW5hdmJhci1pdGVtcy9wby1uYXZiYXItaXRlbXMuY29tcG9uZW50JztcblxuY29uc3QgcG9OYXZiYXJOYXZpZ2F0aW9uV2lkdGggPSA4ODtcbmNvbnN0IHBvTmF2YmFyTWVudU1lZGlhID0gNzY4O1xuY29uc3QgcG9OYXZiYXJNYXRjaE1lZGlhID0gYChtYXgtd2lkdGg6ICR7cG9OYXZiYXJNZW51TWVkaWF9cHgpYDtcbmNvbnN0IHBvTmF2YmFyVGltaW5nID0gJzI1MG1zIGVhc2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb05hdmJhckJhc2VDb21wb25lbnRcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tbmF2YmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLW5hdmJhci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9OYXZiYXJDb21wb25lbnQgZXh0ZW5kcyBQb05hdmJhckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBkaXNhYmxlUmlnaHQ6IGJvb2xlYW47XG4gIHNob3dJdGVtc05hdmlnYXRpb246IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIG1lZGlhUXVlcnk6IGFueTtcbiAgcHJpdmF0ZSBvZmZzZXQ6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG4gIHByaXZhdGUgbWVudUl0ZW1zOiBBcnJheTxQb01lbnVJdGVtPjtcblxuICBwcm90ZWN0ZWQgd2luZG93UmVzaXplTGlzdGVuZXI6ICgpID0+IHZvaWQ7XG5cbiAgZ2V0IG5hdmJhckl0ZW1OYXZpZ2F0aW9uRGlzYWJsZUxlZnQoKSB7XG4gICAgcmV0dXJuIHRoaXMub2Zmc2V0ID09PSAwO1xuICB9XG5cbiAgZ2V0IG5hdmJhckl0ZW1OYXZpZ2F0aW9uRGlzYWJsZVJpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLmRpc2FibGVSaWdodCAmJiB0aGlzLm9mZnNldCAhPT0gMDtcbiAgfVxuXG4gIEBWaWV3Q2hpbGQoUG9OYXZiYXJJdGVtc0NvbXBvbmVudCwgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgbmF2YmFySXRlbXNFbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoUG9OYXZiYXJJdGVtc0NvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgbmF2YmFySXRlbXM6IFBvTmF2YmFySXRlbXNDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlcixcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLmRpc3BsYXlJdGVtc05hdmlnYXRpb24uYmluZCh0aGlzKSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5kaXNwbGF5SXRlbXNOYXZpZ2F0aW9uKCk7XG5cbiAgICBpZiAodGhpcy5tZW51KSB7XG4gICAgICB0aGlzLmluaXROYXZiYXJNZW51KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMubWVkaWFRdWVyeSkge1xuICAgICAgdGhpcy5tZWRpYVF1ZXJ5LnJlbW92ZUxpc3RlbmVyKHRoaXMub25NZWRpYVF1ZXJ5Q2hhbmdlKTtcbiAgICB9XG4gIH1cblxuICBuYXZpZ2F0ZUl0ZW1zKG9yaWVudGF0aW9uOiBzdHJpbmcpIHtcbiAgICBvcmllbnRhdGlvbiA9PT0gJ2xlZnQnID8gdGhpcy5uYXZpZ2F0ZUxlZnQoKSA6IHRoaXMubmF2aWdhdGVSaWdodCgpO1xuXG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgYWxsTmF2YmFySXRlbXNXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5yZWR1Y2UoXG4gICAgICAocHJldmlvdXM6IGFueSwgY3VycmVudDogYW55KSA9PiBwcmV2aW91cyArIGN1cnJlbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCxcbiAgICAgIDBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRlKG9mZnNldDogbnVtYmVyKSB7XG4gICAgY29uc3QgYW5pbWF0aW9uOiBBbmltYXRpb25GYWN0b3J5ID0gdGhpcy5idWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0KTtcblxuICAgIHRoaXMucGxheWVyID0gYW5pbWF0aW9uLmNyZWF0ZSh0aGlzLm5hdmJhckl0ZW1zLm5hdmJhckl0ZW1zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpO1xuICAgIHRoaXMucGxheWVyLnBsYXkoKTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRlci5idWlsZChbYW5pbWF0ZShwb05hdmJhclRpbWluZywga2V5ZnJhbWVzKFtzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoJHstb2Zmc2V0fXB4KWAgfSldKSldKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhbmdlTmF2YmFyTWVudUl0ZW1zKFxuICAgIGlzQ29sbGFwc2VkTWVkaWE6IGFueSxcbiAgICBtZW51SXRlbXM6IEFycmF5PFBvTWVudUl0ZW0+LFxuICAgIG5hdmJhckl0ZW1zOiBBcnJheTxQb05hdmJhckl0ZW0+LFxuICAgIGxhYmVsOiBzdHJpbmdcbiAgKSB7XG4gICAgaWYgKGlzQ29sbGFwc2VkTWVkaWEpIHtcbiAgICAgIGNvbnN0IHN1Ykl0ZW1zID0gW3sgbGFiZWwsIHN1Ykl0ZW1zOiBuYXZiYXJJdGVtcyB9XTtcbiAgICAgIHRoaXMubWVudS5tZW51cyA9IFsuLi5zdWJJdGVtcywgLi4ubWVudUl0ZW1zXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZW51Lm1lbnVzID0gbWVudUl0ZW1zO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlTGVmdE5hdmlnYXRpb24oKSB7XG4gICAgbGV0IGNhbGN1bGF0ZWRPZmZzZXQ6IG51bWJlcjtcblxuICAgIHRoaXMubmF2YmFySXRlbXMuYWxsTmF2YmFySXRlbXMuc29tZShuYXZiYXJJdGVtID0+IHtcbiAgICAgIGNvbnN0IG5hdmJhckl0ZW1PZmZzZXQgPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcbiAgICAgIGNvbnN0IG5hdmJhckl0ZW1XaWR0aCA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgICAgaWYgKG5hdmJhckl0ZW1PZmZzZXQgPj0gdGhpcy5vZmZzZXQpIHtcbiAgICAgICAgY2FsY3VsYXRlZE9mZnNldCA9IG5hdmJhckl0ZW1PZmZzZXQgLSAodGhpcy5uYXZiYXJJdGVtc1dpZHRoKCkgLSBuYXZiYXJJdGVtV2lkdGgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2FsY3VsYXRlZE9mZnNldDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUmlnaHROYXZpZ2F0aW9uKGl0ZW1CcmVha1BvaW50OiBudW1iZXIpIHtcbiAgICBsZXQgY2FsY3VsYXRlZE9mZnNldDogbnVtYmVyO1xuXG4gICAgdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5zb21lKG5hdmJhckl0ZW0gPT4ge1xuICAgICAgY29uc3Qgb2Zmc2V0TGVmdCA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuICAgICAgY29uc3QgZmluYWxQb3NpdGlvbiA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCArIG9mZnNldExlZnQ7XG5cbiAgICAgIGlmIChpdGVtQnJlYWtQb2ludCA8IGZpbmFsUG9zaXRpb24pIHtcbiAgICAgICAgY2FsY3VsYXRlZE9mZnNldCA9IG9mZnNldExlZnQ7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjYWxjdWxhdGVkT2Zmc2V0O1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5SXRlbXNOYXZpZ2F0aW9uKCkge1xuICAgIHRoaXMuc2hvd0l0ZW1zTmF2aWdhdGlvbiA9IHRoaXMubmF2YmFySXRlbXNXaWR0aCgpIDwgdGhpcy5hbGxOYXZiYXJJdGVtc1dpZHRoKCkgKyBwb05hdmJhck5hdmlnYXRpb25XaWR0aDtcblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0ICE9PSAwKSB7XG4gICAgICB0aGlzLnNldE9mZnNldFRvWmVybygpO1xuICAgICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXROYXZiYXJNZW51KCkge1xuICAgIHRoaXMubWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKHBvTmF2YmFyTWF0Y2hNZWRpYSk7XG4gICAgdGhpcy5tZW51SXRlbXMgPSB0aGlzLm1lbnUubWVudXM7XG5cbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCBwb05hdmJhck1lbnVNZWRpYSkge1xuICAgICAgdGhpcy5jaGFuZ2VOYXZiYXJNZW51SXRlbXModHJ1ZSwgdGhpcy5tZW51SXRlbXMsIHRoaXMuaXRlbXMsIHRoaXMubGl0ZXJhbHMubmF2YmFyTGlua3MpO1xuICAgIH1cblxuICAgIHRoaXMudmFsaWRhdGVNZW51TG9nbygpO1xuXG4gICAgdGhpcy5tZWRpYVF1ZXJ5LmFkZExpc3RlbmVyKHRoaXMub25NZWRpYVF1ZXJ5Q2hhbmdlKTtcbiAgfVxuXG4gIHByaXZhdGUgbmF2YmFySXRlbXNXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZiYXJJdGVtc0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgfVxuXG4gIHByaXZhdGUgbmF2aWdhdGVMZWZ0KCkge1xuICAgIHRoaXMuZGlzYWJsZVJpZ2h0ID0gZmFsc2U7XG5cbiAgICB0aGlzLm9mZnNldCA9IHRoaXMuY2FsY3VsYXRlTGVmdE5hdmlnYXRpb24oKTtcblxuICAgIGlmICh0aGlzLm9mZnNldCA8IDApIHtcbiAgICAgIHRoaXMuc2V0T2Zmc2V0VG9aZXJvKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBuYXZpZ2F0ZVJpZ2h0KCkge1xuICAgIGNvbnN0IG1heEFsbG93ZWRPZmZzZXQgPSB0aGlzLmFsbE5hdmJhckl0ZW1zV2lkdGgoKSAtIHRoaXMubmF2YmFySXRlbXNXaWR0aCgpO1xuICAgIGNvbnN0IGl0ZW1CcmVha1BvaW50ID0gdGhpcy5vZmZzZXQgKyB0aGlzLm5hdmJhckl0ZW1zV2lkdGgoKTtcblxuICAgIHRoaXMub2Zmc2V0ID0gdGhpcy5jYWxjdWxhdGVSaWdodE5hdmlnYXRpb24oaXRlbUJyZWFrUG9pbnQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1heE9mZnNldChtYXhBbGxvd2VkT2Zmc2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgb25NZWRpYVF1ZXJ5Q2hhbmdlID0gY2hhbmdlZCA9PiB7XG4gICAgdGhpcy5jaGFuZ2VOYXZiYXJNZW51SXRlbXMoY2hhbmdlZC5tYXRjaGVzLCB0aGlzLm1lbnVJdGVtcywgdGhpcy5pdGVtcywgdGhpcy5saXRlcmFscy5uYXZiYXJMaW5rcyk7XG4gIH07XG5cbiAgcHJpdmF0ZSBzZXRPZmZzZXRUb1plcm8oKSB7XG4gICAgdGhpcy5vZmZzZXQgPSAwO1xuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZU1heE9mZnNldChtYXhBbGxvd2VkT2Zmc2V0OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5vZmZzZXQgPj0gbWF4QWxsb3dlZE9mZnNldCkge1xuICAgICAgdGhpcy5vZmZzZXQgPSBtYXhBbGxvd2VkT2Zmc2V0O1xuICAgICAgdGhpcy5kaXNhYmxlUmlnaHQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZU1lbnVMb2dvKCkge1xuICAgIGlmICh0aGlzLm1lbnUubG9nbyAmJiB0aGlzLmxvZ28pIHtcbiAgICAgIHRoaXMubWVudS5sb2dvID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5tZW51LmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==