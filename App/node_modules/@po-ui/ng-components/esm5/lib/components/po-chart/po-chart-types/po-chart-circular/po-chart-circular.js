import { __assign, __extends, __rest } from "tslib";
import { Subject } from 'rxjs';
import { convertNumberToDecimal } from '../../../../utils/util';
import { poChartAngleStepInterval, poChartCompleteCircle, poChartDonutSerieWidth, poChartGaugeSerieWidth, poChartStartAngle } from './po-chart-circular.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
import { PoSeriesTextBlack } from '../../po-chart-colors.constant';
var poChartBlackColor = '#000000';
var poChartWhiteColor = '#ffffff';
var PoChartCircular = /** @class */ (function (_super) {
    __extends(PoChartCircular, _super);
    function PoChartCircular(el, ngZone, renderer) {
        var _this = _super.call(this) || this;
        _this.el = el;
        _this.ngZone = ngZone;
        _this.renderer = renderer;
        _this.chartItemStartAngle = poChartStartAngle;
        _this.windowResizeEmitter = new Subject();
        _this.chartItemsEndAngleList = [];
        _this.svgPathElementsList = [];
        _this.svgTextElementsList = [];
        return _this;
    }
    Object.defineProperty(PoChartCircular.prototype, "series", {
        get: function () {
            return this._series;
        },
        set: function (value) {
            this._series = this.getSeriesWithValue(value);
        },
        enumerable: true,
        configurable: true
    });
    PoChartCircular.prototype.ngOnDestroy = function () {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    };
    PoChartCircular.prototype.ngOnInit = function () {
        this.chartInitSetup();
        this.setEventListeners();
    };
    PoChartCircular.prototype.removeTooltip = function () {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    };
    PoChartCircular.prototype.drawPath = function (path, chartItemStartAngle, chartItemEndAngle) {
        var largeArc = chartItemEndAngle - chartItemStartAngle > Math.PI;
        var sinAlpha = Math.sin(chartItemStartAngle);
        var cosAlpha = Math.cos(chartItemStartAngle);
        var sinBeta = Math.sin(chartItemEndAngle);
        var cosBeta = Math.cos(chartItemEndAngle);
        var startX = this.centerX + cosAlpha * this.centerX;
        var startY = this.centerX + sinAlpha * this.centerX;
        var endX = this.centerX + cosBeta * this.centerX;
        var endY = this.centerX + sinBeta * this.centerX;
        var startInnerX = this.centerX + cosAlpha * this.innerRadius;
        var startInnerY = this.centerX + sinAlpha * this.innerRadius;
        var endInnerX = this.centerX + cosBeta * this.innerRadius;
        var endInnerY = this.centerX + sinBeta * this.innerRadius;
        var halfGaugeCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
        var pathCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            largeArc ? '1,1' : '0,1',
            endX,
            endY,
            'L',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            largeArc ? '1,0' : '0,0',
            startInnerX,
            startInnerY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', this.isChartGaugeType ? halfGaugeCoordinates : pathCoordinates);
    };
    PoChartCircular.prototype.getSeriesWithValue = function (series) {
        var _this = this;
        var newSeries = [];
        series.forEach(function (serie, index) {
            if (serie.value > 0) {
                newSeries.push(__assign(__assign({}, serie), { color: _this.colors[index] }));
            }
        });
        return newSeries;
    };
    PoChartCircular.prototype.animationSetup = function () {
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    };
    PoChartCircular.prototype.appendGaugeBackgroundPathElement = function (svgPathsWrapper) {
        var svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-chart-gauge-base-path');
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
    };
    PoChartCircular.prototype.calculateAngleRadians = function () {
        var _this = this;
        this.series.forEach(function (serie, index) { return (_this.chartItemsEndAngleList[index] = _this.calculateEndAngle(serie.value, _this.totalValue)); });
    };
    PoChartCircular.prototype.calculateCurrentEndAngle = function (angleCurrentPosition) {
        var isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return this.chartItemStartAngle + this.chartItemEndAngle - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    };
    PoChartCircular.prototype.calculateEndAngle = function (value, totalValue) {
        var endAngle = (value / totalValue) * (Math.PI * 2);
        return this.isChartGaugeType ? endAngle / 2 : endAngle;
    };
    PoChartCircular.prototype.calculateSVGDimensions = function () {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.innerRadius = this.setInnerRadius(this.type);
    };
    PoChartCircular.prototype.changeTooltipPosition = function (event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        var tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', tooltipPositions.left + "px");
        this.renderer.setStyle(this.tooltipElement, 'top', tooltipPositions.top + "px");
    };
    PoChartCircular.prototype.chartInitSetup = function () {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    };
    PoChartCircular.prototype.checkingIfScrollsWithPoPage = function () {
        var poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    };
    PoChartCircular.prototype.createPath = function (serie, svgPathsWrapper) {
        var svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setElementAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    };
    PoChartCircular.prototype.createPaths = function () {
        var _this = this;
        var svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        if (this.isChartGaugeType) {
            this.appendGaugeBackgroundPathElement(svgPathsWrapper);
            // Tratamento para evitar que o path desenhe os arcos referentes ao border radius do path.
            if (this.isSerieValueEqualZero()) {
                return;
            }
        }
        this.series.forEach(function (serie) { return _this.createPath(serie, svgPathsWrapper); });
    };
    PoChartCircular.prototype.createText = function (serie) {
        var value = serie.value;
        var svgG = this.renderer.createElement('svg:g', 'svg');
        var svgText = this.renderer.createElement('svg:text', 'svg');
        var fontSize = this.getFontSize();
        var textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(value, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setElementAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    };
    PoChartCircular.prototype.createTexts = function () {
        var _this = this;
        if (this.type === PoChartType.Donut) {
            this.series.forEach(function (serie) { return _this.createText(serie); });
        }
    };
    PoChartCircular.prototype.createSVGElements = function () {
        var viewBoxHeight = this.isChartGaugeType
            ? this.centerX + this.centerX * poChartGaugeSerieWidth
            : this.chartWrapper;
        var preserveAspectRatio = this.isChartGaugeType ? 'xMidYMax' : 'xMidYMin';
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', "0 0 " + this.chartWrapper + " " + viewBoxHeight);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', preserveAspectRatio + " meet");
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', "" + this.centerX);
        this.renderer.setAttribute(this.svgElement, 'height', "" + this.svgHeight);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    };
    PoChartCircular.prototype.drawPathInit = function () {
        var _this = this;
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular(function () { return _this.drawSeries(); });
        }
    };
    PoChartCircular.prototype.drawSeries = function (currentSerieIndex, angleCurrentPosition) {
        if (currentSerieIndex === void 0) { currentSerieIndex = 0; }
        if (angleCurrentPosition === void 0) { angleCurrentPosition = 0; }
        var isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        var isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    };
    PoChartCircular.prototype.emitEventOnEnter = function (event) {
        this.onSerieHover.next(event);
    };
    PoChartCircular.prototype.getFontSize = function () {
        var fontSizePorcent = 0.04;
        var fontSize = fontSizePorcent * this.chartWrapper;
        return fontSize.toFixed(0) + "px";
    };
    PoChartCircular.prototype.getPercentValue = function (value, totalValue) {
        var percentValue = (value / totalValue) * 100;
        var floatPercentValue = convertNumberToDecimal(percentValue, 2);
        return String(floatPercentValue).replace('.', ',');
    };
    PoChartCircular.prototype.getTextColor = function (color) {
        if (PoSeriesTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    };
    PoChartCircular.prototype.getTooltipValue = function (value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    };
    PoChartCircular.prototype.isSerieValueEqualZero = function () {
        return this.series.length && this.series[0].value === 0;
    };
    PoChartCircular.prototype.onMouseClick = function () {
        var serieOnClick;
        if (this.isChartGaugeType) {
            var _a = this.series[0], color = _a.color, serie = __rest(_a, ["color"]);
            serieOnClick = serie;
        }
        else {
            serieOnClick = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        this.onSerieClick.next(serieOnClick);
    };
    PoChartCircular.prototype.onMouseEnter = function (event) {
        var serieOnEnter;
        if (!this.isChartGaugeType) {
            this.tooltipElement = this.chartBody.nativeElement.querySelector('.po-chart-tooltip');
            this.chartElementCategory = event.target.getAttributeNS(null, 'data-tooltip-category');
            this.chartElementValue = event.target.getAttributeNS(null, 'data-tooltip-value');
            this.tooltipText = event.target.getAttributeNS(null, 'data-tooltip-text');
            this.showTooltip();
            this.changeTooltipPosition(event);
            serieOnEnter = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        else {
            var _a = this.series[0], color = _a.color, serie = __rest(_a, ["color"]);
            this.chartElementDescription = event.target.getAttributeNS(null, 'data-tooltip-category');
            serieOnEnter = serie;
        }
        this.emitEventOnEnter(serieOnEnter);
    };
    PoChartCircular.prototype.onWindowResize = function () {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', "" + this.centerX);
        this.renderer.setAttribute(this.svgElement, 'height', "" + this.svgHeight);
        this.windowResizeEmitter.next();
    };
    PoChartCircular.prototype.removeWindowResizeListener = function () {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    };
    PoChartCircular.prototype.removeWindowScrollListener = function () {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    };
    PoChartCircular.prototype.setEventListeners = function () {
        var _this = this;
        var chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach(function (serie) {
            _this.renderer.listen(serie, 'click', _this.onMouseClick.bind(_this));
            _this.renderer.listen(serie, 'mouseenter', _this.onMouseEnter.bind(_this));
            if (!_this.isChartGaugeType) {
                _this.renderer.listen(serie, 'mousemove', _this.changeTooltipPosition.bind(_this));
                _this.renderer.listen(serie, 'mouseleave', _this.removeTooltip.bind(_this));
            }
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    };
    PoChartCircular.prototype.setInnerRadius = function (type) {
        var serieWidth;
        switch (type) {
            case PoChartType.Donut: {
                serieWidth = poChartDonutSerieWidth;
                break;
            }
            case PoChartType.Gauge: {
                serieWidth = poChartGaugeSerieWidth;
                break;
            }
            case PoChartType.Pie: {
                return 0;
            }
        }
        return this.centerX - this.centerX * serieWidth;
    };
    PoChartCircular.prototype.setTextProperties = function (text, startAngle, endAngle) {
        // necessário text.getClientRects().length para contornar erro de console causado no Firefox
        if (this.type === PoChartType.Donut && text.getClientRects().length) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            var centerAngle = (startAngle + endAngle) / 2;
            var textBox = text.getBBox();
            var halfTextWidth = textBox.width / 2;
            var halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            var radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            var xCoordinate = radius * Math.cos(centerAngle) + this.centerX - halfTextWidth;
            var yCoordinate = radius * Math.sin(centerAngle) + this.centerX + halfTextHeight / 2;
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    };
    PoChartCircular.prototype.setTooltipPositions = function (event) {
        var displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    };
    PoChartCircular.prototype.setElementAttributes = function (svgElement, serie) {
        var value = serie.value, category = serie.category, tooltip = serie.tooltip, description = serie.description;
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', "" + value);
        if (this.isChartGaugeType) {
            this.renderer.setAttribute(svgElement, 'data-tooltip-description', description);
        }
        else {
            var tooltipValue = this.getTooltipValue(value);
            this.renderer.setAttribute(svgElement, 'data-tooltip-category', category);
            this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || category + ": " + tooltipValue);
        }
    };
    PoChartCircular.prototype.showTooltip = function () {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    };
    return PoChartCircular;
}(PoChartDynamicTypeComponent));
export { PoChartCircular };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWNoYXJ0L3BvLWNoYXJ0LXR5cGVzL3BvLWNoYXJ0LWNpcmN1bGFyL3BvLWNoYXJ0LWNpcmN1bGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRWhFLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIscUJBQXFCLEVBQ3JCLHNCQUFzQixFQUN0QixzQkFBc0IsRUFFdEIsaUJBQWlCLEVBQ2xCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBSTdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRW5FLElBQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBQ3BDLElBQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBRXBDO0lBQXFDLG1DQUEyQjtJQXFCOUQseUJBQXNCLEVBQWMsRUFBVSxNQUFjLEVBQVUsUUFBbUI7UUFBekYsWUFDRSxpQkFBTyxTQUNSO1FBRnFCLFFBQUUsR0FBRixFQUFFLENBQVk7UUFBVSxZQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsY0FBUSxHQUFSLFFBQVEsQ0FBVztRQXBCekYseUJBQW1CLEdBQUcsaUJBQWlCLENBQUM7UUFDeEMseUJBQW1CLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFPMUMsNEJBQXNCLEdBQWtCLEVBQUUsQ0FBQztRQUMzQyx5QkFBbUIsR0FBa0IsRUFBRSxDQUFDO1FBQ3hDLHlCQUFtQixHQUFrQixFQUFFLENBQUM7O0lB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LElBQU8sUUFBUSxVQUFLLFlBQWMsQ0FBQyxDQUFDO1NBQ3hHO0lBQ0gsQ0FBQztJQUVPLHFDQUFXLEdBQW5CO1FBQ0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQUFDLEFBMWZELENBQXFDLDJCQUEyQixHQTBmL0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBOZ1pvbmUsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgY29udmVydE51bWJlclRvRGVjaW1hbCB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQge1xuICBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWwsXG4gIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZSxcbiAgcG9DaGFydERvbnV0U2VyaWVXaWR0aCxcbiAgcG9DaGFydEdhdWdlU2VyaWVXaWR0aCxcbiAgcG9DaGFydFBhZGRpbmcsXG4gIHBvQ2hhcnRTdGFydEFuZ2xlXG59IGZyb20gJy4vcG8tY2hhcnQtY2lyY3VsYXIuY29uc3RhbnQnO1xuaW1wb3J0IHsgUG9DaGFydER5bmFtaWNUeXBlQ29tcG9uZW50IH0gZnJvbSAnLi4vcG8tY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0R2F1Z2VTZXJpZSB9IGZyb20gJy4uL3BvLWNoYXJ0LWdhdWdlL3BvLWNoYXJ0LWdhdWdlLXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydFR5cGUgfSBmcm9tICcuLi8uLi9lbnVtcy9wby1jaGFydC10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9DaXJjdWxhckNoYXJ0U2VyaWVzIH0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci1zZXJpZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRG9udXRDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LWRvbnV0L3BvLWNoYXJ0LWRvbnV0LXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9QaWVDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LXBpZS9wby1jaGFydC1waWUtc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1Nlcmllc1RleHRCbGFjayB9IGZyb20gJy4uLy4uL3BvLWNoYXJ0LWNvbG9ycy5jb25zdGFudCc7XG5cbmNvbnN0IHBvQ2hhcnRCbGFja0NvbG9yID0gJyMwMDAwMDAnO1xuY29uc3QgcG9DaGFydFdoaXRlQ29sb3IgPSAnI2ZmZmZmZic7XG5cbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q2lyY3VsYXIgZXh0ZW5kcyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG4gIGNoYXJ0SXRlbVN0YXJ0QW5nbGUgPSBwb0NoYXJ0U3RhcnRBbmdsZTtcbiAgd2luZG93UmVzaXplRW1pdHRlcjogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHVzZS10eXBlLWFsaWFzXG4gIHByb3RlY3RlZCBfc2VyaWVzOiBBcnJheTxQb1BpZUNoYXJ0U2VyaWVzIHwgUG9Eb251dENoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWU+O1xuXG4gIHByaXZhdGUgYW5pbWF0aW9uUnVubmluZzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBjaGFydEl0ZW1FbmRBbmdsZTogbnVtYmVyO1xuICBwcml2YXRlIGNoYXJ0SXRlbXNFbmRBbmdsZUxpc3Q6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgcHJpdmF0ZSBzdmdQYXRoRWxlbWVudHNMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG4gIHByaXZhdGUgc3ZnVGV4dEVsZW1lbnRzTGlzdDogQXJyYXk8c3RyaW5nPiA9IFtdO1xuXG4gIHNldCBzZXJpZXModmFsdWU6IEFycmF5PFBvUGllQ2hhcnRTZXJpZXMgfCBQb0RvbnV0Q2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZT4pIHtcbiAgICB0aGlzLl9zZXJpZXMgPSB0aGlzLmdldFNlcmllc1dpdGhWYWx1ZSh2YWx1ZSk7XG4gIH1cblxuICBnZXQgc2VyaWVzKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXJpZXM7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gICAgdGhpcy5yZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpO1xuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IGZhbHNlO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jaGFydEluaXRTZXR1cCgpO1xuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHJlbW92ZVRvb2x0aXAoKSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy50b29sdGlwRWxlbWVudCwgJ3BvLWludmlzaWJsZScpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBkcmF3UGF0aChwYXRoLCBjaGFydEl0ZW1TdGFydEFuZ2xlLCBjaGFydEl0ZW1FbmRBbmdsZSkge1xuICAgIGNvbnN0IGxhcmdlQXJjID0gY2hhcnRJdGVtRW5kQW5nbGUgLSBjaGFydEl0ZW1TdGFydEFuZ2xlID4gTWF0aC5QSTtcblxuICAgIGNvbnN0IHNpbkFscGhhID0gTWF0aC5zaW4oY2hhcnRJdGVtU3RhcnRBbmdsZSk7XG4gICAgY29uc3QgY29zQWxwaGEgPSBNYXRoLmNvcyhjaGFydEl0ZW1TdGFydEFuZ2xlKTtcblxuICAgIGNvbnN0IHNpbkJldGEgPSBNYXRoLnNpbihjaGFydEl0ZW1FbmRBbmdsZSk7XG4gICAgY29uc3QgY29zQmV0YSA9IE1hdGguY29zKGNoYXJ0SXRlbUVuZEFuZ2xlKTtcblxuICAgIGNvbnN0IHN0YXJ0WCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5jZW50ZXJYO1xuICAgIGNvbnN0IHN0YXJ0WSA9IHRoaXMuY2VudGVyWCArIHNpbkFscGhhICogdGhpcy5jZW50ZXJYO1xuXG4gICAgY29uc3QgZW5kWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmNlbnRlclg7XG4gICAgY29uc3QgZW5kWSA9IHRoaXMuY2VudGVyWCArIHNpbkJldGEgKiB0aGlzLmNlbnRlclg7XG5cbiAgICBjb25zdCBzdGFydElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5pbm5lclJhZGl1cztcbiAgICBjb25zdCBzdGFydElubmVyWSA9IHRoaXMuY2VudGVyWCArIHNpbkFscGhhICogdGhpcy5pbm5lclJhZGl1cztcblxuICAgIGNvbnN0IGVuZElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuICAgIGNvbnN0IGVuZElubmVyWSA9IHRoaXMuY2VudGVyWCArIHNpbkJldGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuXG4gICAgY29uc3QgaGFsZkdhdWdlQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAnTScsXG4gICAgICBzdGFydFgsXG4gICAgICBzdGFydFksXG4gICAgICAnQScsXG4gICAgICB0aGlzLmNlbnRlclgsXG4gICAgICB0aGlzLmNlbnRlclgsXG4gICAgICAwLFxuICAgICAgJzAsMScsXG4gICAgICBlbmRYLFxuICAgICAgZW5kWSxcbiAgICAgICdBJyxcbiAgICAgIDEsXG4gICAgICAxLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgZW5kSW5uZXJYLFxuICAgICAgZW5kSW5uZXJZLFxuICAgICAgJ0EnLFxuICAgICAgdGhpcy5pbm5lclJhZGl1cyxcbiAgICAgIHRoaXMuaW5uZXJSYWRpdXMsXG4gICAgICAwLFxuICAgICAgJzAsMCcsXG4gICAgICBzdGFydElubmVyWCxcbiAgICAgIHN0YXJ0SW5uZXJZLFxuICAgICAgJ0EnLFxuICAgICAgMSxcbiAgICAgIDEsXG4gICAgICAwLFxuICAgICAgJzAsMScsXG4gICAgICBzdGFydFgsXG4gICAgICBzdGFydFksXG4gICAgICAnWidcbiAgICBdLmpvaW4oJyAnKTtcblxuICAgIGNvbnN0IHBhdGhDb29yZGluYXRlcyA9IFtcbiAgICAgICdNJyxcbiAgICAgIHN0YXJ0WCxcbiAgICAgIHN0YXJ0WSxcbiAgICAgICdBJyxcbiAgICAgIHRoaXMuY2VudGVyWCxcbiAgICAgIHRoaXMuY2VudGVyWCxcbiAgICAgIDAsXG4gICAgICBsYXJnZUFyYyA/ICcxLDEnIDogJzAsMScsXG4gICAgICBlbmRYLFxuICAgICAgZW5kWSxcbiAgICAgICdMJyxcbiAgICAgIGVuZElubmVyWCxcbiAgICAgIGVuZElubmVyWSxcbiAgICAgICdBJyxcbiAgICAgIHRoaXMuaW5uZXJSYWRpdXMsXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxuICAgICAgMCxcbiAgICAgIGxhcmdlQXJjID8gJzEsMCcgOiAnMCwwJyxcbiAgICAgIHN0YXJ0SW5uZXJYLFxuICAgICAgc3RhcnRJbm5lclksXG4gICAgICAnWidcbiAgICBdLmpvaW4oJyAnKTtcblxuICAgIHJldHVybiBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsIHRoaXMuaXNDaGFydEdhdWdlVHlwZSA/IGhhbGZHYXVnZUNvb3JkaW5hdGVzIDogcGF0aENvb3JkaW5hdGVzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTZXJpZXNXaXRoVmFsdWUoc2VyaWVzOiBBcnJheTxQb0NpcmN1bGFyQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZT4pIHtcbiAgICBjb25zdCBuZXdTZXJpZXMgPSBbXTtcblxuICAgIHNlcmllcy5mb3JFYWNoKChzZXJpZSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChzZXJpZS52YWx1ZSA+IDApIHtcbiAgICAgICAgbmV3U2VyaWVzLnB1c2goeyAuLi5zZXJpZSwgY29sb3I6IHRoaXMuY29sb3JzW2luZGV4XSB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBuZXdTZXJpZXM7XG4gIH1cblxuICBwcml2YXRlIGFuaW1hdGlvblNldHVwKCkge1xuICAgIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgPSB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbMF07XG4gICAgdGhpcy5hbmltYXRpb25SdW5uaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmRyYXdQYXRoSW5pdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBlbmRHYXVnZUJhY2tncm91bmRQYXRoRWxlbWVudChzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xuICAgIGNvbnN0IHN2Z1BhdGggPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpwYXRoJywgJ3N2ZycpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdjbGFzcycsICdwby1jaGFydC1nYXVnZS1iYXNlLXBhdGgnKTtcbiAgICBzdmdQYXRoc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnUGF0aCk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQsIHN2Z1BhdGhzV3JhcHBlcik7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUFuZ2xlUmFkaWFucygpIHtcbiAgICB0aGlzLnNlcmllcy5mb3JFYWNoKFxuICAgICAgKHNlcmllLCBpbmRleCkgPT4gKHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtpbmRleF0gPSB0aGlzLmNhbGN1bGF0ZUVuZEFuZ2xlKHNlcmllLnZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgY29uc3QgaXNTZXJpZURyYXdDb21wbGV0ZWQgPVxuICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuXG4gICAgaWYgKGlzU2VyaWVEcmF3Q29tcGxldGVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSAtIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRW5kQW5nbGUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBlbmRBbmdsZSA9ICh2YWx1ZSAvIHRvdGFsVmFsdWUpICogKE1hdGguUEkgKiAyKTtcblxuICAgIHJldHVybiB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyBlbmRBbmdsZSAvIDIgOiBlbmRBbmdsZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0NvbnRhaW5lckRpbWVuc2lvbnModGhpcy5jaGFydFdyYXBwZXIsIHRoaXMuY2hhcnRIZWFkZXIsIHRoaXMuY2hhcnRMZWdlbmQpO1xuXG4gICAgdGhpcy5pbm5lclJhZGl1cyA9IHRoaXMuc2V0SW5uZXJSYWRpdXModGhpcy50eXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQgJiYgdGhpcy50b29sdGlwRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvLWludmlzaWJsZScpKSB7XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9vbHRpcFBvc2l0aW9ucyA9IHRoaXMuc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAnbGVmdCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMubGVmdH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b29sdGlwRWxlbWVudCwgJ3RvcCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMudG9wfXB4YCk7XG4gIH1cblxuICBwcml2YXRlIGNoYXJ0SW5pdFNldHVwKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMuY2FsY3VsYXRlVG90YWxWYWx1ZSgpO1xuICAgIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpYW5zKCk7XG4gICAgdGhpcy5jcmVhdGVTVkdFbGVtZW50cygpO1xuICAgIHRoaXMuYW5pbWF0aW9uU2V0dXAoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCkge1xuICAgIGNvbnN0IHBvUGFnZUNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwby1wYWdlLWNvbnRlbnQnKTtcblxuICAgIHJldHVybiBwb1BhZ2VDb250ZW50Lmxlbmd0aCA/IHBvUGFnZUNvbnRlbnRbMF0gOiB3aW5kb3c7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVBhdGgoc2VyaWU6IFBvQ2lyY3VsYXJDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllLCBzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xuICAgIGNvbnN0IHN2Z1BhdGggPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpwYXRoJywgJ3N2ZycpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdmaWxsJywgc2VyaWUuY29sb3IpO1xuXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdQYXRoLCBzZXJpZSk7XG5cbiAgICBzdmdQYXRoc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnUGF0aCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnUGF0aHNXcmFwcGVyKTtcblxuICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1BhdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRocygpIHtcbiAgICBjb25zdCBzdmdQYXRoc1dyYXBwZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xuICAgICAgdGhpcy5hcHBlbmRHYXVnZUJhY2tncm91bmRQYXRoRWxlbWVudChzdmdQYXRoc1dyYXBwZXIpO1xuICAgICAgLy8gVHJhdGFtZW50byBwYXJhIGV2aXRhciBxdWUgbyBwYXRoIGRlc2VuaGUgb3MgYXJjb3MgcmVmZXJlbnRlcyBhbyBib3JkZXIgcmFkaXVzIGRvIHBhdGguXG4gICAgICBpZiAodGhpcy5pc1NlcmllVmFsdWVFcXVhbFplcm8oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVBhdGgoc2VyaWUsIHN2Z1BhdGhzV3JhcHBlcikpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0KHNlcmllOiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHNlcmllO1xuXG4gICAgY29uc3Qgc3ZnRyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOmcnLCAnc3ZnJyk7XG4gICAgY29uc3Qgc3ZnVGV4dCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnRleHQnLCAnc3ZnJyk7XG5cbiAgICBjb25zdCBmb250U2l6ZSA9IHRoaXMuZ2V0Rm9udFNpemUoKTtcbiAgICBjb25zdCB0ZXh0Q29sb3IgPSB0aGlzLmdldFRleHRDb2xvcihzZXJpZS5jb2xvcik7XG5cbiAgICBzdmdUZXh0LnRleHRDb250ZW50ID0gdGhpcy5nZXRQZXJjZW50VmFsdWUodmFsdWUsIHRoaXMudG90YWxWYWx1ZSkgKyAnJSc7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnY2xhc3MnLCAncG8tcGF0aC1pdGVtJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2ZpbGwnLCB0ZXh0Q29sb3IpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmb250LXNpemUnLCBmb250U2l6ZSk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2ZpbGwtb3BhY2l0eScsICcwJyk7XG5cbiAgICB0aGlzLnNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z1RleHQsIHNlcmllKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoc3ZnRywgc3ZnVGV4dCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnRyk7XG4gICAgdGhpcy5zdmdUZXh0RWxlbWVudHNMaXN0LnB1c2goc3ZnVGV4dCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRleHRzKCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0KSB7XG4gICAgICB0aGlzLnNlcmllcy5mb3JFYWNoKHNlcmllID0+IHRoaXMuY3JlYXRlVGV4dChzZXJpZSkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU1ZHRWxlbWVudHMoKSB7XG4gICAgY29uc3Qgdmlld0JveEhlaWdodCA9IHRoaXMuaXNDaGFydEdhdWdlVHlwZVxuICAgICAgPyB0aGlzLmNlbnRlclggKyB0aGlzLmNlbnRlclggKiBwb0NoYXJ0R2F1Z2VTZXJpZVdpZHRoXG4gICAgICA6IHRoaXMuY2hhcnRXcmFwcGVyO1xuICAgIGNvbnN0IHByZXNlcnZlQXNwZWN0UmF0aW8gPSB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyAneE1pZFlNYXgnIDogJ3hNaWRZTWluJztcblxuICAgIHRoaXMuc3ZnRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnN2ZycsICdzdmcnKTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3ZpZXdCb3gnLCBgMCAwICR7dGhpcy5jaGFydFdyYXBwZXJ9ICR7dmlld0JveEhlaWdodH1gKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgYCR7cHJlc2VydmVBc3BlY3RSYXRpb30gbWVldGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2NsYXNzJywgJ3BvLWNoYXJ0LXN2Zy1lbGVtZW50Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnd2lkdGgnLCBgJHt0aGlzLmNlbnRlclh9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5zdmdIZWlnaHR9YCk7XG5cbiAgICB0aGlzLnN2Z0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCk7XG5cbiAgICB0aGlzLmNyZWF0ZVBhdGhzKCk7XG4gICAgdGhpcy5jcmVhdGVUZXh0cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3UGF0aEluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmFuaW1hdGlvblJ1bm5pbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5kcmF3U2VyaWVzKCkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZHJhd1NlcmllcyhjdXJyZW50U2VyaWVJbmRleDogbnVtYmVyID0gMCwgYW5nbGVDdXJyZW50UG9zaXRpb246IG51bWJlciA9IDApIHtcbiAgICBjb25zdCBpc0ZpbmlzaGVkRHJhd2luZ0N1cnJlbnRTZXJpZXMgPSBhbmdsZUN1cnJlbnRQb3NpdGlvbiA+IHRoaXMuY2hhcnRJdGVtRW5kQW5nbGU7XG4gICAgY29uc3QgaXNGaW5pc2hlZERyYXdpbmdBbGxTZXJpZXMgPSBjdXJyZW50U2VyaWVJbmRleCA9PT0gdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0Lmxlbmd0aDtcblxuICAgIGlmIChpc0ZpbmlzaGVkRHJhd2luZ0FsbFNlcmllcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc0ZpbmlzaGVkRHJhd2luZ0N1cnJlbnRTZXJpZXMpIHtcbiAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGU7XG4gICAgICBjdXJyZW50U2VyaWVJbmRleCsrO1xuICAgICAgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtjdXJyZW50U2VyaWVJbmRleF07XG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFuZ2xlQ3VycmVudFBvc2l0aW9uICs9IHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbDtcblxuICAgICAgdGhpcy5kcmF3UGF0aChcbiAgICAgICAgdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0W2N1cnJlbnRTZXJpZUluZGV4XSxcbiAgICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlLFxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbilcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc2V0VGV4dFByb3BlcnRpZXMoXG4gICAgICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pXG4gICAgICApO1xuICAgIH1cblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5kcmF3U2VyaWVzLmJpbmQodGhpcywgY3VycmVudFNlcmllSW5kZXgsIGFuZ2xlQ3VycmVudFBvc2l0aW9uKSk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRFdmVudE9uRW50ZXIoZXZlbnQ6IFBvRG9udXRDaGFydFNlcmllcyB8IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xuICAgIHRoaXMub25TZXJpZUhvdmVyLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb250U2l6ZSgpIHtcbiAgICBjb25zdCBmb250U2l6ZVBvcmNlbnQgPSAwLjA0O1xuXG4gICAgY29uc3QgZm9udFNpemUgPSBmb250U2l6ZVBvcmNlbnQgKiB0aGlzLmNoYXJ0V3JhcHBlcjtcblxuICAgIHJldHVybiBgJHtmb250U2l6ZS50b0ZpeGVkKDApfXB4YDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGVyY2VudFZhbHVlKHZhbHVlOiBudW1iZXIsIHRvdGFsVmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IHBlcmNlbnRWYWx1ZSA9ICh2YWx1ZSAvIHRvdGFsVmFsdWUpICogMTAwO1xuXG4gICAgY29uc3QgZmxvYXRQZXJjZW50VmFsdWUgPSBjb252ZXJ0TnVtYmVyVG9EZWNpbWFsKHBlcmNlbnRWYWx1ZSwgMik7XG5cbiAgICByZXR1cm4gU3RyaW5nKGZsb2F0UGVyY2VudFZhbHVlKS5yZXBsYWNlKCcuJywgJywnKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGV4dENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcbiAgICBpZiAoUG9TZXJpZXNUZXh0QmxhY2suaW5jbHVkZXMoY29sb3IpKSB7XG4gICAgICByZXR1cm4gcG9DaGFydEJsYWNrQ29sb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBvQ2hhcnRXaGl0ZUNvbG9yO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb29sdGlwVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSkge1xuICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1NlcmllVmFsdWVFcXVhbFplcm8oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2VyaWVzLmxlbmd0aCAmJiB0aGlzLnNlcmllc1swXS52YWx1ZSA9PT0gMDtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUNsaWNrKCkge1xuICAgIGxldCBzZXJpZU9uQ2xpY2s6IFBvRG9udXRDaGFydFNlcmllcyB8IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZTtcblxuICAgIGlmICh0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIGNvbnN0IHsgY29sb3IsIC4uLnNlcmllIH0gPSB0aGlzLnNlcmllc1swXTtcbiAgICAgIHNlcmllT25DbGljayA9IHNlcmllO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXJpZU9uQ2xpY2sgPSB7IGNhdGVnb3J5OiB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5LCB2YWx1ZTogdGhpcy5jaGFydEVsZW1lbnRWYWx1ZSB9O1xuICAgIH1cblxuICAgIHRoaXMub25TZXJpZUNsaWNrLm5leHQoc2VyaWVPbkNsaWNrKTtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUVudGVyKGV2ZW50KSB7XG4gICAgbGV0IHNlcmllT25FbnRlcjogUG9Eb251dENoYXJ0U2VyaWVzIHwgUG9QaWVDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllO1xuXG4gICAgaWYgKCF0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIHRoaXMudG9vbHRpcEVsZW1lbnQgPSB0aGlzLmNoYXJ0Qm9keS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wby1jaGFydC10b29sdGlwJyk7XG4gICAgICB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5ID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtY2F0ZWdvcnknKTtcbiAgICAgIHRoaXMuY2hhcnRFbGVtZW50VmFsdWUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC12YWx1ZScpO1xuICAgICAgdGhpcy50b29sdGlwVGV4dCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAnZGF0YS10b29sdGlwLXRleHQnKTtcbiAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoKTtcbiAgICAgIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50KTtcblxuICAgICAgc2VyaWVPbkVudGVyID0geyBjYXRlZ29yeTogdGhpcy5jaGFydEVsZW1lbnRDYXRlZ29yeSwgdmFsdWU6IHRoaXMuY2hhcnRFbGVtZW50VmFsdWUgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgeyBjb2xvciwgLi4uc2VyaWUgfSA9IHRoaXMuc2VyaWVzWzBdO1xuXG4gICAgICB0aGlzLmNoYXJ0RWxlbWVudERlc2NyaXB0aW9uID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtY2F0ZWdvcnknKTtcbiAgICAgIHNlcmllT25FbnRlciA9IHNlcmllO1xuICAgIH1cblxuICAgIHRoaXMuZW1pdEV2ZW50T25FbnRlcihzZXJpZU9uRW50ZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbldpbmRvd1Jlc2l6ZSgpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd3aWR0aCcsIGAke3RoaXMuY2VudGVyWH1gKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdoZWlnaHQnLCBgJHt0aGlzLnN2Z0hlaWdodH1gKTtcbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUVtaXR0ZXIubmV4dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lcikge1xuICAgICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlV2luZG93U2Nyb2xsTGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGxldCBjaGFydFNlcmllczogQXJyYXk8c3RyaW5nPiA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG8tcGF0aC1pdGVtJyk7XG4gICAgY2hhcnRTZXJpZXMgPSBBcnJheS5mcm9tKGNoYXJ0U2VyaWVzKTtcbiAgICBjaGFydFNlcmllcy5mb3JFYWNoKHNlcmllID0+IHtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnY2xpY2snLCB0aGlzLm9uTW91c2VDbGljay5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VlbnRlcicsIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcykpO1xuXG4gICAgICBpZiAoIXRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlbW92ZScsIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlbGVhdmUnLCB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4od2luZG93LCAncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oXG4gICAgICB0aGlzLmNoZWNraW5nSWZTY3JvbGxzV2l0aFBvUGFnZSgpLFxuICAgICAgJ3Njcm9sbCcsXG4gICAgICB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHNldElubmVyUmFkaXVzKHR5cGU6IFBvQ2hhcnRUeXBlKSB7XG4gICAgbGV0IHNlcmllV2lkdGg7XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgUG9DaGFydFR5cGUuRG9udXQ6IHtcbiAgICAgICAgc2VyaWVXaWR0aCA9IHBvQ2hhcnREb251dFNlcmllV2lkdGg7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLkdhdWdlOiB7XG4gICAgICAgIHNlcmllV2lkdGggPSBwb0NoYXJ0R2F1Z2VTZXJpZVdpZHRoO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUG9DaGFydFR5cGUuUGllOiB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNlbnRlclggLSB0aGlzLmNlbnRlclggKiBzZXJpZVdpZHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUZXh0UHJvcGVydGllcyh0ZXh0LCBzdGFydEFuZ2xlOiBudW1iZXIsIGVuZEFuZ2xlOiBudW1iZXIpIHtcbiAgICAvLyBuZWNlc3PDoXJpbyB0ZXh0LmdldENsaWVudFJlY3RzKCkubGVuZ3RoIHBhcmEgY29udG9ybmFyIGVycm8gZGUgY29uc29sZSBjYXVzYWRvIG5vIEZpcmVmb3hcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCAmJiB0ZXh0LmdldENsaWVudFJlY3RzKCkubGVuZ3RoKSB7XG4gICAgICAvLyB1dGlsaXphZG8gcGFyYSByZWN1cGVyYXIgbyBhbmd1bG8gZG8gbWVpbywgZW50cmUgbyBpbmljaW8gZSBmaW0gcGFyYSBjZW50cmFsaXphciBvIHRleHRvXG4gICAgICBjb25zdCBjZW50ZXJBbmdsZSA9IChzdGFydEFuZ2xlICsgZW5kQW5nbGUpIC8gMjtcbiAgICAgIGNvbnN0IHRleHRCb3ggPSB0ZXh0LmdldEJCb3goKTtcblxuICAgICAgY29uc3QgaGFsZlRleHRXaWR0aCA9IHRleHRCb3gud2lkdGggLyAyO1xuICAgICAgY29uc3QgaGFsZlRleHRIZWlnaHQgPSB0ZXh0Qm94LmhlaWdodCAvIDI7XG5cbiAgICAgIC8vIHJhZGl1cyBpbnRlcm5vIChjaXJjdWxvIGJyYW5jbykgKyBhIG1ldGFkZSBkYSBkaWZlcmVuw6dhIGVudHJlIHRhbWFuaG8gZG8gY2VudHJvIGUgcmFkaXVzIGludGVybm9cbiAgICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuaW5uZXJSYWRpdXMgKyAodGhpcy5jZW50ZXJYIC0gdGhpcy5pbm5lclJhZGl1cykgLyAyO1xuXG4gICAgICBjb25zdCB4Q29vcmRpbmF0ZSA9IHJhZGl1cyAqIE1hdGguY29zKGNlbnRlckFuZ2xlKSArIHRoaXMuY2VudGVyWCAtIGhhbGZUZXh0V2lkdGg7XG4gICAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IHJhZGl1cyAqIE1hdGguc2luKGNlbnRlckFuZ2xlKSArIHRoaXMuY2VudGVyWCArIGhhbGZUZXh0SGVpZ2h0IC8gMjtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCd4JywgeENvb3JkaW5hdGUpO1xuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ3knLCB5Q29vcmRpbmF0ZSk7XG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgnZmlsbC1vcGFjaXR5JywgJzEnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFRvb2x0aXBQb3NpdGlvbnMoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBkaXNwbGFjZW1lbnQ6IG51bWJlciA9IDg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogZXZlbnQuY2xpZW50WCAtIHRoaXMudG9vbHRpcEVsZW1lbnQub2Zmc2V0V2lkdGggLyAyLFxuICAgICAgdG9wOiBldmVudC5jbGllbnRZIC0gdGhpcy50b29sdGlwRWxlbWVudC5vZmZzZXRIZWlnaHQgLSBkaXNwbGFjZW1lbnRcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRFbGVtZW50QXR0cmlidXRlcyhzdmdFbGVtZW50LCBzZXJpZSkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGNhdGVnb3J5LCB0b29sdGlwLCBkZXNjcmlwdGlvbiB9ID0gc2VyaWU7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXZhbHVlJywgYCR7dmFsdWV9YCk7XG5cbiAgICBpZiAodGhpcy5pc0NoYXJ0R2F1Z2VUeXBlKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWRlc2NyaXB0aW9uJywgZGVzY3JpcHRpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0b29sdGlwVmFsdWUgPSB0aGlzLmdldFRvb2x0aXBWYWx1ZSh2YWx1ZSk7XG5cbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtY2F0ZWdvcnknLCBjYXRlZ29yeSk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXRleHQnLCB0b29sdGlwIHx8IGAke2NhdGVnb3J5fTogJHt0b29sdGlwVmFsdWV9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG93VG9vbHRpcCgpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMudG9vbHRpcEVsZW1lbnQsICdwby1pbnZpc2libGUnKTtcbiAgfVxufVxuIl19