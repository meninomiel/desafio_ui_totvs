import { __decorate, __extends, __metadata } from "tslib";
import { Component, forwardRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { PoCalendarBaseComponent } from './po-calendar-base.component';
import { PoCalendarLangService } from './services/po-calendar.lang.service';
import { PoCalendarService } from './services/po-calendar.service';
import { PoDateService } from '../../services/po-date/po-date.service';
/* istanbul ignore next */
var providers = [
    PoCalendarService,
    PoCalendarLangService,
    {
        provide: NG_VALUE_ACCESSOR,
        // tslint:disable-next-line
        useExisting: forwardRef(function () { return PoCalendarComponent; }),
        multi: true
    },
    {
        provide: NG_VALIDATORS,
        // tslint:disable-next-line
        useExisting: forwardRef(function () { return PoCalendarComponent; }),
        multi: true
    }
];
/**
 * @docsExtends PoCalendarBaseComponent
 *
 * @example
 *
 * <example name="po-calendar-basic" title="PO Calendar Basic" >
 *  <file name="sample-po-calendar-basic/sample-po-calendar-basic.component.html"> </file>
 *  <file name="sample-po-calendar-basic/sample-po-calendar-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-calendar-labs" title="PO Calendar Labs" >
 *  <file name="sample-po-calendar-labs/sample-po-calendar-labs.component.html"> </file>
 *  <file name="sample-po-calendar-labs/sample-po-calendar-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-calendar-ticket-sales" title="PO Calendar - Ticket Sales" >
 *  <file name="sample-po-calendar-ticket-sales/sample-po-calendar-ticket-sales.component.html"> </file>
 *  <file name="sample-po-calendar-ticket-sales/sample-po-calendar-ticket-sales.component.ts"> </file>
 * </example>
 */
var PoCalendarComponent = /** @class */ (function (_super) {
    __extends(PoCalendarComponent, _super);
    function PoCalendarComponent(poCalendarService, poCalendarLangService, poDate) {
        var _this = _super.call(this, poDate, poCalendarLangService) || this;
        _this.poCalendarService = poCalendarService;
        return _this;
    }
    PoCalendarComponent.prototype.ngOnInit = function () {
        this.init();
    };
    PoCalendarComponent.prototype.getBackgroundColor = function (displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    };
    PoCalendarComponent.prototype.getDayBackgroundColor = function (date) {
        return this.getDayColor(date, 'background');
    };
    PoCalendarComponent.prototype.getDayForegroundColor = function (date) {
        return this.getDayColor(date, 'foreground');
    };
    PoCalendarComponent.prototype.getForegroundColor = function (displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    };
    PoCalendarComponent.prototype.getMonthLabel = function () {
        return this.poCalendarLangService.getMonthLabel();
    };
    PoCalendarComponent.prototype.getYearLabel = function () {
        return this.poCalendarLangService.getYearLabel();
    };
    PoCalendarComponent.prototype.onNextMonth = function () {
        this.displayMonthNumber < 11
            ? this.updateDisplay(this.displayYear, this.displayMonthNumber + 1)
            : this.updateDisplay(this.displayYear + 1, 0);
    };
    PoCalendarComponent.prototype.onPreviousMonth = function () {
        this.displayMonthNumber > 0
            ? this.updateDisplay(this.displayYear, this.displayMonthNumber - 1)
            : this.updateDisplay(this.displayYear - 1, 11);
    };
    // Ao selecionar uma data
    PoCalendarComponent.prototype.onSelectDate = function (date) {
        this.date = date;
        this.dateIso = this.poDate.convertDateToISO(date);
        if (this.propagateChange) {
            this.propagateChange(this.dateIso);
        }
        this.change.emit(this.dateIso);
    };
    // Ao selecionar um mês
    PoCalendarComponent.prototype.onSelectMonth = function (year, month) {
        this.selectDay();
        this.updateDisplay(year, month);
    };
    // Ao selecionar um ano
    PoCalendarComponent.prototype.onSelectYear = function (year, month) {
        // Se veio da tela de seleção de mês
        this.lastDisplay === 'month' ? this.selectMonth() : this.selectDay();
        this.currentYear = year;
        this.updateDisplay(year, month);
    };
    PoCalendarComponent.prototype.registerOnChange = function (fn) {
        this.propagateChange = fn;
    };
    PoCalendarComponent.prototype.registerOnTouched = function (func) {
        this.onTouched = func;
    };
    PoCalendarComponent.prototype.registerOnValidatorChange = function (fn) {
        this.validatorChange = fn;
    };
    PoCalendarComponent.prototype.selectDay = function () {
        this.dayVisible = true;
        this.monthVisible = false;
        this.yearVisible = false;
        this.lastDisplay = 'day';
    };
    PoCalendarComponent.prototype.selectMonth = function () {
        this.dayVisible = false;
        this.monthVisible = true;
        this.yearVisible = false;
        this.lastDisplay = 'month';
    };
    PoCalendarComponent.prototype.selectYear = function () {
        this.dayVisible = false;
        this.monthVisible = false;
        this.yearVisible = true;
    };
    PoCalendarComponent.prototype.updateYear = function (value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    };
    PoCalendarComponent.prototype.validateModel = function (model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    };
    PoCalendarComponent.prototype.validate = function (c) {
        return null;
    };
    PoCalendarComponent.prototype.writeValue = function (value) {
        if (value) {
            this.writeDate(value);
        }
        else {
            this.date = undefined;
            this.updateDate(this.today);
        }
    };
    PoCalendarComponent.prototype.addAllYearsInDecade = function (year) {
        var i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    };
    PoCalendarComponent.prototype.equalsDate = function (date1, date2) {
        try {
            return (date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate());
        }
        catch (error) {
            return false;
        }
    };
    // Obtém um array de todos os anos desta década
    PoCalendarComponent.prototype.getDecadeArray = function (year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    };
    PoCalendarComponent.prototype.getColorForDate = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? "po-calendar-box-" + local + "-selected"
            : "po-calendar-box-" + local + "-selected-disabled";
    };
    PoCalendarComponent.prototype.getColorForDateRange = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? "po-calendar-box-" + local
            : "po-calendar-box-" + local + "-disabled";
    };
    PoCalendarComponent.prototype.getColorForToday = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? "po-calendar-box-" + local + "-today"
            : "po-calendar-box-" + local + "-today-disabled";
    };
    PoCalendarComponent.prototype.getDayColor = function (date, local) {
        if (this.equalsDate(date, this.date)) {
            return this.getColorForDate(date, local);
        }
        else if (this.equalsDate(date, this.today)) {
            return this.getColorForToday(date, local);
        }
        else {
            return this.getColorForDateRange(date, local);
        }
    };
    PoCalendarComponent.prototype.init = function () {
        this.date && this.poDate.isValidIso(this.poDate.convertDateToISO(this.date))
            ? this.updateDate(this.date)
            : this.updateDate(this.today);
        this.initializeLanguage();
        this.selectDay();
    };
    PoCalendarComponent.prototype.selectDateFromDate = function (date) {
        this.date = date;
        this.onSelectDate(this.date);
    };
    PoCalendarComponent.prototype.selectDateFromIso = function (stringDate) {
        var _a = this.poDate.getDateFromIso(stringDate), year = _a.year, month = _a.month, day = _a.day;
        var date = new Date(year, month - 1, day);
        this.poDate.setYearFrom0To100(date, year);
        this.date = date;
        this.onSelectDate(this.date);
    };
    PoCalendarComponent.prototype.updateDate = function (date) {
        if (date) {
            this.currentMonthNumber = date.getMonth();
            this.currentYear = date.getFullYear();
            this.updateDisplay(this.currentYear, this.currentMonthNumber);
        }
    };
    PoCalendarComponent.prototype.updateDecade = function (year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    };
    PoCalendarComponent.prototype.updateDisplay = function (year, month) {
        var calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getDecadeArray(year);
    };
    PoCalendarComponent.prototype.writeDate = function (value) {
        value instanceof Date ? this.selectDateFromDate(value) : this.writeDateIso(value);
        this.updateDate(this.date);
    };
    PoCalendarComponent.prototype.writeDateIso = function (value) {
        this.poDate.isValidIso(value) ? this.selectDateFromIso(value) : (this.date = undefined);
    };
    PoCalendarComponent.ctorParameters = function () { return [
        { type: PoCalendarService },
        { type: PoCalendarLangService },
        { type: PoDateService }
    ]; };
    PoCalendarComponent = __decorate([
        Component({
            selector: 'po-calendar',
            template: "<div class=\"po-calendar\">\n  <div *ngIf=\"dayVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"onPreviousMonth()\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable po-mr-1\" (click)=\"selectMonth()\">{{ displayMonth }}</span>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"onNextMonth()\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\" *ngFor=\"let day of displayWeekDays\">\n          {{ day.toLowerCase() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-day\">\n        <div\n          *ngFor=\"let day of displayDays\"\n          class=\"po-calendar-day\"\n          [ngClass]=\"getDayBackgroundColor(day)\"\n          (click)=\"onSelectDate(day)\"\n        >\n          <span *ngIf=\"day != 0\" [ngClass]=\"getDayForegroundColor(day)\">\n            {{ day.getDate() }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"monthVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"updateYear(-1)\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"updateYear(1)\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getMonthLabel() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-month\">\n        <div\n          *ngFor=\"let month of displayMonths; let i = index\"\n          class=\"po-calendar-month\"\n          [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\"\n          (click)=\"onSelectMonth(displayYear, i)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\n            {{ month }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"yearVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"updateYear(-10)\"></span>\n      <div class=\"po-calendar-nav-title\">{{ displayStartDecade }} - {{ displayFinalDecade }}</div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"updateYear(10)\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getYearLabel() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-year\">\n        <div\n          *ngFor=\"let year of displayDecade; let i = index\"\n          class=\"po-calendar-year\"\n          [ngClass]=\"getBackgroundColor(year, currentYear)\"\n          (click)=\"onSelectYear(year, displayMonthNumber)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\n            {{ year }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
            providers: providers
        }),
        __metadata("design:paramtypes", [PoCalendarService,
            PoCalendarLangService,
            PoDateService])
    ], PoCalendarComponent);
    return PoCalendarComponent;
}(PoCalendarBaseComponent));
export { PoCalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1jYWxlbmRhci9wby1jYWxlbmRhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQzlELE9BQU8sRUFBbUIsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDbkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBRXZFLDBCQUEwQjtBQUMxQixJQUFNLFNBQVMsR0FBRztJQUNoQixpQkFBaUI7SUFDakIscUJBQXFCO0lBQ3JCO1FBQ0UsT0FBTyxFQUFFLGlCQUFpQjtRQUMxQiwyQkFBMkI7UUFDM0IsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEsbUJBQW1CLEVBQW5CLENBQW1CLENBQUM7UUFDbEQsS0FBSyxFQUFFLElBQUk7S0FDWjtJQUNEO1FBQ0UsT0FBTyxFQUFFLGFBQWE7UUFDdEIsMkJBQTJCO1FBQzNCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLG1CQUFtQixFQUFuQixDQUFtQixDQUFDO1FBQ2xELEtBQUssRUFBRSxJQUFJO0tBQ1o7Q0FDRixDQUFDO0FBRUY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFNSDtJQUF5Qyx1Q0FBdUI7SUFDOUQsNkJBQ1UsaUJBQW9DLEVBQzVDLHFCQUE0QyxFQUM1QyxNQUFxQjtRQUh2QixZQUtFLGtCQUFNLE1BQU0sRUFB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SUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRU8sdUNBQVMsR0FBakIsVUFBa0IsS0FBVTtRQUMxQixLQUFLLFlBQVksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVPLDBDQUFZLEdBQXBCLFVBQXFCLEtBQVU7UUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxDQUFDO0lBQzFGLENBQUM7O2dCQTdPNEIsaUJBQWlCO2dCQUNyQixxQkFBcUI7Z0JBQ3BDLGFBQWE7O0lBSlosbUJBQW1CO1FBTC9CLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLDg1R0FBMkM7WUFDM0MsU0FBUyxXQUFBO1NBQ1YsQ0FBQzt5Q0FHNkIsaUJBQWlCO1lBQ3JCLHFCQUFxQjtZQUNwQyxhQUFhO09BSlosbUJBQW1CLENBZ1AvQjtJQUFELDBCQUFDO0NBQUEsQUFoUEQsQ0FBeUMsdUJBQXVCLEdBZ1AvRDtTQWhQWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIGZvcndhcmRSZWYsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgUG9DYWxlbmRhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLWNhbGVuZGFyLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2FsZW5kYXJMYW5nU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tY2FsZW5kYXIubGFuZy5zZXJ2aWNlJztcbmltcG9ydCB7IFBvQ2FsZW5kYXJTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wby1jYWxlbmRhci5zZXJ2aWNlJztcbmltcG9ydCB7IFBvRGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1kYXRlL3BvLWRhdGUuc2VydmljZSc7XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG5jb25zdCBwcm92aWRlcnMgPSBbXG4gIFBvQ2FsZW5kYXJTZXJ2aWNlLFxuICBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UsXG4gIHtcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb0NhbGVuZGFyQ29tcG9uZW50KSxcbiAgICBtdWx0aTogdHJ1ZVxuICB9LFxuICB7XG4gICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb0NhbGVuZGFyQ29tcG9uZW50KSxcbiAgICBtdWx0aTogdHJ1ZVxuICB9XG5dO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb0NhbGVuZGFyQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWNhbGVuZGFyLWJhc2ljXCIgdGl0bGU9XCJQTyBDYWxlbmRhciBCYXNpY1wiID5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNhbGVuZGFyLWJhc2ljL3NhbXBsZS1wby1jYWxlbmRhci1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jYWxlbmRhci1iYXNpYy9zYW1wbGUtcG8tY2FsZW5kYXItYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2FsZW5kYXItbGFic1wiIHRpdGxlPVwiUE8gQ2FsZW5kYXIgTGFic1wiID5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNhbGVuZGFyLWxhYnMvc2FtcGxlLXBvLWNhbGVuZGFyLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2FsZW5kYXItbGFicy9zYW1wbGUtcG8tY2FsZW5kYXItbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1jYWxlbmRhci10aWNrZXQtc2FsZXNcIiB0aXRsZT1cIlBPIENhbGVuZGFyIC0gVGlja2V0IFNhbGVzXCIgPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2FsZW5kYXItdGlja2V0LXNhbGVzL3NhbXBsZS1wby1jYWxlbmRhci10aWNrZXQtc2FsZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2FsZW5kYXItdGlja2V0LXNhbGVzL3NhbXBsZS1wby1jYWxlbmRhci10aWNrZXQtc2FsZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tY2FsZW5kYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnNcbn0pXG5leHBvcnQgY2xhc3MgUG9DYWxlbmRhckNvbXBvbmVudCBleHRlbmRzIFBvQ2FsZW5kYXJCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBwb0NhbGVuZGFyU2VydmljZTogUG9DYWxlbmRhclNlcnZpY2UsXG4gICAgcG9DYWxlbmRhckxhbmdTZXJ2aWNlOiBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UsXG4gICAgcG9EYXRlOiBQb0RhdGVTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKHBvRGF0ZSwgcG9DYWxlbmRhckxhbmdTZXJ2aWNlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgZ2V0QmFja2dyb3VuZENvbG9yKGRpc3BsYXlWYWx1ZTogbnVtYmVyLCBwcm9wZXJ0eVZhbHVlOiBudW1iZXIpIHtcbiAgICByZXR1cm4gZGlzcGxheVZhbHVlID09PSBwcm9wZXJ0eVZhbHVlID8gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kLXNlbGVjdGVkJyA6ICdwby1jYWxlbmRhci1ib3gtYmFja2dyb3VuZCc7XG4gIH1cblxuICBnZXREYXlCYWNrZ3JvdW5kQ29sb3IoZGF0ZTogRGF0ZSkge1xuICAgIHJldHVybiB0aGlzLmdldERheUNvbG9yKGRhdGUsICdiYWNrZ3JvdW5kJyk7XG4gIH1cblxuICBnZXREYXlGb3JlZ3JvdW5kQ29sb3IoZGF0ZTogRGF0ZSkge1xuICAgIHJldHVybiB0aGlzLmdldERheUNvbG9yKGRhdGUsICdmb3JlZ3JvdW5kJyk7XG4gIH1cblxuICBnZXRGb3JlZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiBkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUgPyAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1mb3JlZ3JvdW5kJztcbiAgfVxuXG4gIGdldE1vbnRoTGFiZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldE1vbnRoTGFiZWwoKTtcbiAgfVxuXG4gIGdldFllYXJMYWJlbCgpIHtcbiAgICByZXR1cm4gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0WWVhckxhYmVsKCk7XG4gIH1cblxuICBvbk5leHRNb250aCgpIHtcbiAgICB0aGlzLmRpc3BsYXlNb250aE51bWJlciA8IDExXG4gICAgICA/IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciArIDEpXG4gICAgICA6IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyICsgMSwgMCk7XG4gIH1cblxuICBvblByZXZpb3VzTW9udGgoKSB7XG4gICAgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgPiAwXG4gICAgICA/IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciAtIDEpXG4gICAgICA6IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyIC0gMSwgMTEpO1xuICB9XG5cbiAgLy8gQW8gc2VsZWNpb25hciB1bWEgZGF0YVxuICBvblNlbGVjdERhdGUoZGF0ZTogRGF0ZSkge1xuICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5kYXRlSXNvID0gdGhpcy5wb0RhdGUuY29udmVydERhdGVUb0lTTyhkYXRlKTtcbiAgICBpZiAodGhpcy5wcm9wYWdhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHRoaXMuZGF0ZUlzbyk7XG4gICAgfVxuICAgIHRoaXMuY2hhbmdlLmVtaXQodGhpcy5kYXRlSXNvKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gbcOqc1xuICBvblNlbGVjdE1vbnRoKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0RGF5KCk7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHllYXIsIG1vbnRoKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gYW5vXG4gIG9uU2VsZWN0WWVhcih5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcbiAgICAvLyBTZSB2ZWlvIGRhIHRlbGEgZGUgc2VsZcOnw6NvIGRlIG3DqnNcbiAgICB0aGlzLmxhc3REaXNwbGF5ID09PSAnbW9udGgnID8gdGhpcy5zZWxlY3RNb250aCgpIDogdGhpcy5zZWxlY3REYXkoKTtcblxuICAgIHRoaXMuY3VycmVudFllYXIgPSB5ZWFyO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZnVuYzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmdW5jO1xuICB9XG5cbiAgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZShmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICBzZWxlY3REYXkoKSB7XG4gICAgdGhpcy5kYXlWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3REaXNwbGF5ID0gJ2RheSc7XG4gIH1cblxuICBzZWxlY3RNb250aCgpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy55ZWFyVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubGFzdERpc3BsYXkgPSAnbW9udGgnO1xuICB9XG5cbiAgc2VsZWN0WWVhcigpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgdXBkYXRlWWVhcih2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIgKyB2YWx1ZSwgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIpO1xuICB9XG5cbiAgdmFsaWRhdGVNb2RlbChtb2RlbDogYW55KSB7XG4gICAgaWYgKHRoaXMudmFsaWRhdG9yQ2hhbmdlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRvckNoYW5nZShtb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGUoYzogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMud3JpdGVEYXRlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRlID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy51cGRhdGVEYXRlKHRoaXMudG9kYXkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkQWxsWWVhcnNJbkRlY2FkZSh5ZWFyOiBudW1iZXIpIHtcbiAgICBsZXQgaTtcbiAgICBmb3IgKGkgPSB5ZWFyOyBpIDwgeWVhciArIDEwOyBpKyspIHtcbiAgICAgIHRoaXMuZGlzcGxheURlY2FkZS5wdXNoKGkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZXF1YWxzRGF0ZShkYXRlMTogRGF0ZSwgZGF0ZTI6IERhdGUpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgZGF0ZTEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZTIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICBkYXRlMS5nZXRNb250aCgpID09PSBkYXRlMi5nZXRNb250aCgpICYmXG4gICAgICAgIGRhdGUxLmdldERhdGUoKSA9PT0gZGF0ZTIuZ2V0RGF0ZSgpXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gT2J0w6ltIHVtIGFycmF5IGRlIHRvZG9zIG9zIGFub3MgZGVzdGEgZMOpY2FkYVxuICBwcml2YXRlIGdldERlY2FkZUFycmF5KHllYXIpIHtcbiAgICB0aGlzLmRpc3BsYXlEZWNhZGUgPSBBcnJheSgpO1xuXG4gICAgaWYgKHllYXIgJSAxMCAhPT0gMCkge1xuICAgICAgd2hpbGUgKHllYXIgJSAxMCAhPT0gMCkge1xuICAgICAgICB5ZWFyLS07XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMudXBkYXRlRGVjYWRlKHllYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvckRhdGUoZGF0ZTogRGF0ZSwgbG9jYWw6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnBvRGF0ZS52YWxpZGF0ZURhdGVSYW5nZShkYXRlLCB0aGlzLm1pbkRhdGUsIHRoaXMubWF4RGF0ZSlcbiAgICAgID8gYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS1zZWxlY3RlZGBcbiAgICAgIDogYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS1zZWxlY3RlZC1kaXNhYmxlZGA7XG4gIH1cblxuICBwcml2YXRlIGdldENvbG9yRm9yRGF0ZVJhbmdlKGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH1gXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvclRvZGF5KGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tdG9kYXlgXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tdG9kYXktZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREYXlDb2xvcihkYXRlOiBEYXRlLCBsb2NhbDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuZXF1YWxzRGF0ZShkYXRlLCB0aGlzLmRhdGUpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRDb2xvckZvckRhdGUoZGF0ZSwgbG9jYWwpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMudG9kYXkpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRDb2xvckZvclRvZGF5KGRhdGUsIGxvY2FsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlUmFuZ2UoZGF0ZSwgbG9jYWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdCgpIHtcbiAgICB0aGlzLmRhdGUgJiYgdGhpcy5wb0RhdGUuaXNWYWxpZElzbyh0aGlzLnBvRGF0ZS5jb252ZXJ0RGF0ZVRvSVNPKHRoaXMuZGF0ZSkpXG4gICAgICA/IHRoaXMudXBkYXRlRGF0ZSh0aGlzLmRhdGUpXG4gICAgICA6IHRoaXMudXBkYXRlRGF0ZSh0aGlzLnRvZGF5KTtcbiAgICB0aGlzLmluaXRpYWxpemVMYW5ndWFnZSgpO1xuICAgIHRoaXMuc2VsZWN0RGF5KCk7XG4gIH1cblxuICBwcml2YXRlIHNlbGVjdERhdGVGcm9tRGF0ZShkYXRlOiBEYXRlKSB7XG4gICAgdGhpcy5kYXRlID0gZGF0ZTtcbiAgICB0aGlzLm9uU2VsZWN0RGF0ZSh0aGlzLmRhdGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3REYXRlRnJvbUlzbyhzdHJpbmdEYXRlOiBzdHJpbmcpIHtcbiAgICBjb25zdCB7IHllYXIsIG1vbnRoLCBkYXkgfSA9IHRoaXMucG9EYXRlLmdldERhdGVGcm9tSXNvKHN0cmluZ0RhdGUpO1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgdGhpcy5wb0RhdGUuc2V0WWVhckZyb20wVG8xMDAoZGF0ZSwgeWVhcik7XG4gICAgdGhpcy5kYXRlID0gZGF0ZTtcbiAgICB0aGlzLm9uU2VsZWN0RGF0ZSh0aGlzLmRhdGUpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEYXRlKGRhdGU6IERhdGUpIHtcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgdGhpcy5jdXJyZW50TW9udGhOdW1iZXIgPSBkYXRlLmdldE1vbnRoKCk7XG4gICAgICB0aGlzLmN1cnJlbnRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuY3VycmVudFllYXIsIHRoaXMuY3VycmVudE1vbnRoTnVtYmVyKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURlY2FkZSh5ZWFyOiBudW1iZXIpIHtcbiAgICB0aGlzLmFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcik7XG4gICAgdGhpcy5kaXNwbGF5U3RhcnREZWNhZGUgPSB5ZWFyO1xuICAgIHRoaXMuZGlzcGxheUZpbmFsRGVjYWRlID0geWVhciArIDk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpc3BsYXkoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gICAgY29uc3QgY2FsZW5kYXJBcnJheSA9IHRoaXMucG9DYWxlbmRhclNlcnZpY2UubW9udGhEYXlzKHllYXIsIG1vbnRoKTtcbiAgICB0aGlzLmRpc3BsYXlEYXlzID0gW10uY29uY2F0LmFwcGx5KFtdLCBjYWxlbmRhckFycmF5KTtcbiAgICB0aGlzLmRpc3BsYXlNb250aE51bWJlciA9IG1vbnRoO1xuICAgIHRoaXMuZGlzcGxheU1vbnRoID0gdGhpcy5kaXNwbGF5TW9udGhzW21vbnRoXTtcbiAgICB0aGlzLmRpc3BsYXlZZWFyID0geWVhcjtcbiAgICB0aGlzLmdldERlY2FkZUFycmF5KHllYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSB3cml0ZURhdGUodmFsdWU6IGFueSkge1xuICAgIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IHRoaXMuc2VsZWN0RGF0ZUZyb21EYXRlKHZhbHVlKSA6IHRoaXMud3JpdGVEYXRlSXNvKHZhbHVlKTtcbiAgICB0aGlzLnVwZGF0ZURhdGUodGhpcy5kYXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgd3JpdGVEYXRlSXNvKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLnBvRGF0ZS5pc1ZhbGlkSXNvKHZhbHVlKSA/IHRoaXMuc2VsZWN0RGF0ZUZyb21Jc28odmFsdWUpIDogKHRoaXMuZGF0ZSA9IHVuZGVmaW5lZCk7XG4gIH1cbn1cbiJdfQ==