import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Renderer2, ViewChild, ViewContainerRef } from '@angular/core';
import { Router } from '@angular/router';
import { callFunction, isExternalLink, isTypeof, openExternalLink } from '../../utils/util';
import { PoControlPositionService } from '../../services/po-control-position/po-control-position.service';
import { PoPopupBaseComponent } from './po-popup-base.component';
/**
 *
 * @docsExtends PoPopupBaseComponent
 *
 * @example
 *
 * <example name="po-popup-basic" title="PO Popup - Basic">
 *   <file name="sample-po-popup-basic/sample-po-popup-basic.component.html"> </file>
 *   <file name="sample-po-popup-basic/sample-po-popup-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-popup-labs" title="PO Popup - Labs">
 *   <file name="sample-po-popup-labs/sample-po-popup-labs.component.html"> </file>
 *   <file name="sample-po-popup-labs/sample-po-popup-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-popup-email" title="PO Popup Email">
 *   <file name="sample-po-popup-email/sample-po-popup-email.component.html"> </file>
 *   <file name="sample-po-popup-email/sample-po-popup-email.component.ts"> </file>
 * </example>
 *
 */
var PoPopupComponent = /** @class */ (function (_super) {
    __extends(PoPopupComponent, _super);
    function PoPopupComponent(viewContainerRef, renderer, router, poControlPosition, changeDetector) {
        var _this = _super.call(this) || this;
        _this.renderer = renderer;
        _this.router = router;
        _this.poControlPosition = poControlPosition;
        _this.changeDetector = changeDetector;
        _this.onScroll = function () {
            if (_this.showPopup) {
                _this.close();
            }
        };
        _this.parentRef = viewContainerRef['_hostView'][8];
        return _this;
    }
    /**
     * Fecha o componente *popup*.
     *
     * > Por padrão, este comportamento é acionado somente ao clicar fora do componente ou em determinada ação / url.
     */
    PoPopupComponent.prototype.close = function () {
        this.removeListeners();
        this.showPopup = false;
    };
    PoPopupComponent.prototype.onActionClick = function (popupAction) {
        var actionNoDisabled = popupAction && !this.returnBooleanValue(popupAction, 'disabled');
        if (popupAction && popupAction.action && actionNoDisabled) {
            this.close();
            return callFunction(popupAction.action, this.parentRef, this.param || popupAction);
        }
        if (popupAction && popupAction.url && actionNoDisabled) {
            this.close();
            return this.openUrl(popupAction.url);
        }
    };
    /**
     * Abre o componente *popup*.
     *
     * > É possível informar um parâmetro que será utilizado na execução da ação do item e na função de desabilitar.
     */
    PoPopupComponent.prototype.open = function (param) {
        this.oldTarget = this.target;
        this.param = param;
        this.showPopup = true;
        this.changeDetector.detectChanges();
        this.validateInitialContent();
    };
    PoPopupComponent.prototype.returnBooleanValue = function (popupAction, property) {
        return isTypeof(popupAction[property], 'function')
            ? popupAction[property](this.param || popupAction)
            : popupAction[property];
    };
    /**
     * Responsável por abrir e fechar o *popup*.
     *
     * Quando disparado abrirá o *popup* e caso o mesmo já estiver aberto e possuir o mesmo `target` irá fecha-lo.
     *
     * É possível informar um parâmetro que será utilizado na execução da ação do item e na função de desabilitar.
     */
    PoPopupComponent.prototype.toggle = function (param) {
        this.showPopup && this.oldTarget === this.target ? this.close() : this.open(param);
    };
    PoPopupComponent.prototype.clickedOutDisabledItem = function (event) {
        var containsItemDisabled = this.elementContains(event.target, 'po-popup-item-disabled') ||
            this.elementContains(event.target.parentElement, 'po-popup-item-disabled');
        return !containsItemDisabled;
    };
    PoPopupComponent.prototype.clickedOutHeaderTemplate = function (event) {
        var popupHeaderTemplate = this.popupRef && this.popupRef.nativeElement.querySelector('[p-popup-header-template]');
        return !(popupHeaderTemplate && popupHeaderTemplate.contains(event.target));
    };
    PoPopupComponent.prototype.clickedOutTarget = function (event) {
        return this.target && !this.target.contains(event.target);
    };
    PoPopupComponent.prototype.closePopupOnClickout = function (event) {
        if (this.clickedOutTarget(event) && this.clickedOutDisabledItem(event) && this.clickedOutHeaderTemplate(event)) {
            this.close();
        }
    };
    PoPopupComponent.prototype.elementContains = function (element, className) {
        return element && element.classList.contains(className);
    };
    PoPopupComponent.prototype.hasContentToShow = function () {
        return !!(this.popupRef.nativeElement && this.popupRef.nativeElement.clientHeight);
    };
    PoPopupComponent.prototype.initializeListeners = function () {
        var _this = this;
        this.resizeListener = this.renderer.listen('window', 'resize', function () {
            _this.close();
        });
        this.clickoutListener = this.renderer.listen('document', 'click', function (event) {
            _this.closePopupOnClickout(event);
        });
        window.addEventListener('scroll', this.onScroll, true);
    };
    PoPopupComponent.prototype.openUrl = function (url) {
        if (isExternalLink(url)) {
            return openExternalLink(url);
        }
        if (url) {
            return this.router.navigate([url]);
        }
    };
    PoPopupComponent.prototype.removeListeners = function () {
        if (this.clickoutListener) {
            this.clickoutListener();
        }
        if (this.resizeListener) {
            this.resizeListener();
        }
        window.removeEventListener('scroll', this.onScroll, true);
    };
    PoPopupComponent.prototype.setPosition = function () {
        this.poControlPosition.setElements(this.popupRef.nativeElement, 8, this.target, this.customPositions, false, this.isCornerAlign);
        this.poControlPosition.adjustPosition(this.position);
        this.arrowDirection = this.poControlPosition.getArrowDirection();
    };
    PoPopupComponent.prototype.validateInitialContent = function () {
        if (this.hasContentToShow()) {
            this.setPosition();
            this.initializeListeners();
        }
        else {
            this.close();
        }
    };
    PoPopupComponent.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: Renderer2 },
        { type: Router },
        { type: PoControlPositionService },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        ViewChild('popupRef', { read: ElementRef }),
        __metadata("design:type", ElementRef)
    ], PoPopupComponent.prototype, "popupRef", void 0);
    PoPopupComponent = __decorate([
        Component({
            selector: 'po-popup',
            template: "<div #popupRef class=\"po-popup\" *ngIf=\"showPopup\">\n  <div *ngIf=\"!hideArrow\" class=\"po-popup-arrow po-arrow-{{ arrowDirection }}\"></div>\n\n  <ng-content select=\"[p-popup-header-template]\"></ng-content>\n\n  <ng-container *ngFor=\"let action of actions; let actionIndex = index\">\n    <div\n      *ngIf=\"action.visible !== false\"\n      [class.po-popup-item-default]=\"action.type !== 'danger'\"\n      [class.po-popup-item-danger]=\"action.type === 'danger'\"\n      [class.po-popup-item-disabled]=\"returnBooleanValue(action, 'disabled')\"\n      [class.po-popup-item-separator]=\"action.separator && actionIndex !== 0\"\n      [class.po-popup-item-selected]=\"action.selected\"\n      (click)=\"onActionClick(action)\"\n    >\n      <span *ngIf=\"action.icon\" class=\"po-icon {{ action.icon }} po-popup-icon-item\"></span>\n      {{ action.label }}\n    </div>\n  </ng-container>\n</div>\n",
            providers: [PoControlPositionService]
        }),
        __metadata("design:paramtypes", [ViewContainerRef,
            Renderer2,
            Router,
            PoControlPositionService,
            ChangeDetectorRef])
    ], PoPopupComponent);
    return PoPopupComponent;
}(PoPopupBaseComponent));
export { PoPopupComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcG9wdXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1wb3B1cC9wby1wb3B1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakgsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXpDLE9BQU8sRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzVGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGdFQUFnRSxDQUFDO0FBRzFHLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWpFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FxQkc7QUFNSDtJQUFzQyxvQ0FBb0I7SUFHeEQsMEJBQ0UsZ0JBQWtDLEVBQzFCLFFBQW1CLEVBQ25CLE1BQWMsRUFDZCxpQkFBMkMsRUFDNUMsY0FBaUM7UUFMMUMsWUFPRSxpQkFBTyxTQUVSO1FBUFMsY0FBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixZQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUEwQjtRQUM1QyxvQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUF3R2xDLGNBQVEsR0FBRztZQUNqQixJQUFJLEtBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2xCLEtBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUNkO1FBQ0gsQ0FBQyxDQUFDO1FBekdBLEtBQUksQ0FBQyxTQUFTLEdBQUcsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O0lBQ3BELENBQUM7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QkFBd0I7Z0JBQzVCLGlCQUFpQjs7SUFQRztRQUE1QyxTQUFTLENBQUMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxDQUFDO2tDQUFXLFVBQVU7c0RBQUM7SUFEdkQsZ0JBQWdCO1FBTDVCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxVQUFVO1lBQ3BCLHU1QkFBd0M7WUFDeEMsU0FBUyxFQUFFLENBQUMsd0JBQXdCLENBQUM7U0FDdEMsQ0FBQzt5Q0FLb0IsZ0JBQWdCO1lBQ2hCLFNBQVM7WUFDWCxNQUFNO1lBQ0ssd0JBQXdCO1lBQzVCLGlCQUFpQjtPQVIvQixnQkFBZ0IsQ0FpSzVCO0lBQUQsdUJBQUM7Q0FBQSxBQWpLRCxDQUFzQyxvQkFBb0IsR0FpS3pEO1NBaktZLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5pbXBvcnQgeyBjYWxsRnVuY3Rpb24sIGlzRXh0ZXJuYWxMaW5rLCBpc1R5cGVvZiwgb3BlbkV4dGVybmFsTGluayB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9Db250cm9sUG9zaXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tY29udHJvbC1wb3NpdGlvbi9wby1jb250cm9sLXBvc2l0aW9uLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBQb1BvcHVwQWN0aW9uIH0gZnJvbSAnLi9wby1wb3B1cC1hY3Rpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvUG9wdXBCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1wb3B1cC1iYXNlLmNvbXBvbmVudCc7XG5cbi8qKlxuICpcbiAqIEBkb2NzRXh0ZW5kcyBQb1BvcHVwQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBvcHVwLWJhc2ljXCIgdGl0bGU9XCJQTyBQb3B1cCAtIEJhc2ljXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcG9wdXAtYmFzaWMvc2FtcGxlLXBvLXBvcHVwLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wb3B1cC1iYXNpYy9zYW1wbGUtcG8tcG9wdXAtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tcG9wdXAtbGFic1wiIHRpdGxlPVwiUE8gUG9wdXAgLSBMYWJzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcG9wdXAtbGFicy9zYW1wbGUtcG8tcG9wdXAtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcG9wdXAtbGFicy9zYW1wbGUtcG8tcG9wdXAtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1wb3B1cC1lbWFpbFwiIHRpdGxlPVwiUE8gUG9wdXAgRW1haWxcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wb3B1cC1lbWFpbC9zYW1wbGUtcG8tcG9wdXAtZW1haWwuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBvcHVwLWVtYWlsL3NhbXBsZS1wby1wb3B1cC1lbWFpbC5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tcG9wdXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcG9wdXAuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtQb0NvbnRyb2xQb3NpdGlvblNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIFBvUG9wdXBDb21wb25lbnQgZXh0ZW5kcyBQb1BvcHVwQmFzZUNvbXBvbmVudCB7XG4gIEBWaWV3Q2hpbGQoJ3BvcHVwUmVmJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHBvcHVwUmVmOiBFbGVtZW50UmVmO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBwb0NvbnRyb2xQb3NpdGlvbjogUG9Db250cm9sUG9zaXRpb25TZXJ2aWNlLFxuICAgIHB1YmxpYyBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnBhcmVudFJlZiA9IHZpZXdDb250YWluZXJSZWZbJ19ob3N0VmlldyddWzhdO1xuICB9XG5cbiAgLyoqXG4gICAqIEZlY2hhIG8gY29tcG9uZW50ZSAqcG9wdXAqLlxuICAgKlxuICAgKiA+IFBvciBwYWRyw6NvLCBlc3RlIGNvbXBvcnRhbWVudG8gw6kgYWNpb25hZG8gc29tZW50ZSBhbyBjbGljYXIgZm9yYSBkbyBjb21wb25lbnRlIG91IGVtIGRldGVybWluYWRhIGHDp8OjbyAvIHVybC5cbiAgICovXG4gIGNsb3NlKCkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzKCk7XG5cbiAgICB0aGlzLnNob3dQb3B1cCA9IGZhbHNlO1xuICB9XG5cbiAgb25BY3Rpb25DbGljayhwb3B1cEFjdGlvbjogUG9Qb3B1cEFjdGlvbikge1xuICAgIGNvbnN0IGFjdGlvbk5vRGlzYWJsZWQgPSBwb3B1cEFjdGlvbiAmJiAhdGhpcy5yZXR1cm5Cb29sZWFuVmFsdWUocG9wdXBBY3Rpb24sICdkaXNhYmxlZCcpO1xuXG4gICAgaWYgKHBvcHVwQWN0aW9uICYmIHBvcHVwQWN0aW9uLmFjdGlvbiAmJiBhY3Rpb25Ob0Rpc2FibGVkKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICByZXR1cm4gY2FsbEZ1bmN0aW9uKHBvcHVwQWN0aW9uLmFjdGlvbiwgdGhpcy5wYXJlbnRSZWYsIHRoaXMucGFyYW0gfHwgcG9wdXBBY3Rpb24pO1xuICAgIH1cblxuICAgIGlmIChwb3B1cEFjdGlvbiAmJiBwb3B1cEFjdGlvbi51cmwgJiYgYWN0aW9uTm9EaXNhYmxlZCkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgcmV0dXJuIHRoaXMub3BlblVybChwb3B1cEFjdGlvbi51cmwpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBYnJlIG8gY29tcG9uZW50ZSAqcG9wdXAqLlxuICAgKlxuICAgKiA+IMOJIHBvc3PDrXZlbCBpbmZvcm1hciB1bSBwYXLDom1ldHJvIHF1ZSBzZXLDoSB1dGlsaXphZG8gbmEgZXhlY3XDp8OjbyBkYSBhw6fDo28gZG8gaXRlbSBlIG5hIGZ1bsOnw6NvIGRlIGRlc2FiaWxpdGFyLlxuICAgKi9cbiAgb3BlbihwYXJhbT8pIHtcbiAgICB0aGlzLm9sZFRhcmdldCA9IHRoaXMudGFyZ2V0O1xuICAgIHRoaXMucGFyYW0gPSBwYXJhbTtcbiAgICB0aGlzLnNob3dQb3B1cCA9IHRydWU7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy52YWxpZGF0ZUluaXRpYWxDb250ZW50KCk7XG4gIH1cblxuICByZXR1cm5Cb29sZWFuVmFsdWUocG9wdXBBY3Rpb246IGFueSwgcHJvcGVydHk6IHN0cmluZykge1xuICAgIHJldHVybiBpc1R5cGVvZihwb3B1cEFjdGlvbltwcm9wZXJ0eV0sICdmdW5jdGlvbicpXG4gICAgICA/IHBvcHVwQWN0aW9uW3Byb3BlcnR5XSh0aGlzLnBhcmFtIHx8IHBvcHVwQWN0aW9uKVxuICAgICAgOiBwb3B1cEFjdGlvbltwcm9wZXJ0eV07XG4gIH1cblxuICAvKipcbiAgICogUmVzcG9uc8OhdmVsIHBvciBhYnJpciBlIGZlY2hhciBvICpwb3B1cCouXG4gICAqXG4gICAqIFF1YW5kbyBkaXNwYXJhZG8gYWJyaXLDoSBvICpwb3B1cCogZSBjYXNvIG8gbWVzbW8gasOhIGVzdGl2ZXIgYWJlcnRvIGUgcG9zc3VpciBvIG1lc21vIGB0YXJnZXRgIGlyw6EgZmVjaGEtbG8uXG4gICAqXG4gICAqIMOJIHBvc3PDrXZlbCBpbmZvcm1hciB1bSBwYXLDom1ldHJvIHF1ZSBzZXLDoSB1dGlsaXphZG8gbmEgZXhlY3XDp8OjbyBkYSBhw6fDo28gZG8gaXRlbSBlIG5hIGZ1bsOnw6NvIGRlIGRlc2FiaWxpdGFyLlxuICAgKi9cbiAgdG9nZ2xlKHBhcmFtPykge1xuICAgIHRoaXMuc2hvd1BvcHVwICYmIHRoaXMub2xkVGFyZ2V0ID09PSB0aGlzLnRhcmdldCA/IHRoaXMuY2xvc2UoKSA6IHRoaXMub3BlbihwYXJhbSk7XG4gIH1cblxuICBwcml2YXRlIGNsaWNrZWRPdXREaXNhYmxlZEl0ZW0oZXZlbnQpIHtcbiAgICBjb25zdCBjb250YWluc0l0ZW1EaXNhYmxlZCA9XG4gICAgICB0aGlzLmVsZW1lbnRDb250YWlucyhldmVudC50YXJnZXQsICdwby1wb3B1cC1pdGVtLWRpc2FibGVkJykgfHxcbiAgICAgIHRoaXMuZWxlbWVudENvbnRhaW5zKGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LCAncG8tcG9wdXAtaXRlbS1kaXNhYmxlZCcpO1xuXG4gICAgcmV0dXJuICFjb250YWluc0l0ZW1EaXNhYmxlZDtcbiAgfVxuXG4gIHByaXZhdGUgY2xpY2tlZE91dEhlYWRlclRlbXBsYXRlKGV2ZW50KSB7XG4gICAgY29uc3QgcG9wdXBIZWFkZXJUZW1wbGF0ZSA9IHRoaXMucG9wdXBSZWYgJiYgdGhpcy5wb3B1cFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1twLXBvcHVwLWhlYWRlci10ZW1wbGF0ZV0nKTtcbiAgICByZXR1cm4gIShwb3B1cEhlYWRlclRlbXBsYXRlICYmIHBvcHVwSGVhZGVyVGVtcGxhdGUuY29udGFpbnMoZXZlbnQudGFyZ2V0KSk7XG4gIH1cblxuICBwcml2YXRlIGNsaWNrZWRPdXRUYXJnZXQoZXZlbnQpIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXQgJiYgIXRoaXMudGFyZ2V0LmNvbnRhaW5zKGV2ZW50LnRhcmdldCk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlUG9wdXBPbkNsaWNrb3V0KGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMuY2xpY2tlZE91dFRhcmdldChldmVudCkgJiYgdGhpcy5jbGlja2VkT3V0RGlzYWJsZWRJdGVtKGV2ZW50KSAmJiB0aGlzLmNsaWNrZWRPdXRIZWFkZXJUZW1wbGF0ZShldmVudCkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVsZW1lbnRDb250YWlucyhlbGVtZW50OiBIVE1MRWxlbWVudCwgY2xhc3NOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gZWxlbWVudCAmJiBlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNDb250ZW50VG9TaG93KCkge1xuICAgIHJldHVybiAhISh0aGlzLnBvcHVwUmVmLm5hdGl2ZUVsZW1lbnQgJiYgdGhpcy5wb3B1cFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5yZXNpemVMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKCd3aW5kb3cnLCAncmVzaXplJywgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jbGlja291dExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ2NsaWNrJywgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmNsb3NlUG9wdXBPbkNsaWNrb3V0KGV2ZW50KTtcbiAgICB9KTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsLCB0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgb25TY3JvbGwgPSAoKTogdm9pZCA9PiB7XG4gICAgaWYgKHRoaXMuc2hvd1BvcHVwKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgb3BlblVybCh1cmw6IHN0cmluZykge1xuICAgIGlmIChpc0V4dGVybmFsTGluayh1cmwpKSB7XG4gICAgICByZXR1cm4gb3BlbkV4dGVybmFsTGluayh1cmwpO1xuICAgIH1cblxuICAgIGlmICh1cmwpIHtcbiAgICAgIHJldHVybiB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbdXJsXSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVMaXN0ZW5lcnMoKSB7XG4gICAgaWYgKHRoaXMuY2xpY2tvdXRMaXN0ZW5lcikge1xuICAgICAgdGhpcy5jbGlja291dExpc3RlbmVyKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVzaXplTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMucmVzaXplTGlzdGVuZXIoKTtcbiAgICB9XG5cbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5vblNjcm9sbCwgdHJ1ZSk7XG4gIH1cblxuICBwcml2YXRlIHNldFBvc2l0aW9uKCkge1xuICAgIHRoaXMucG9Db250cm9sUG9zaXRpb24uc2V0RWxlbWVudHMoXG4gICAgICB0aGlzLnBvcHVwUmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICA4LFxuICAgICAgdGhpcy50YXJnZXQsXG4gICAgICB0aGlzLmN1c3RvbVBvc2l0aW9ucyxcbiAgICAgIGZhbHNlLFxuICAgICAgdGhpcy5pc0Nvcm5lckFsaWduXG4gICAgKTtcbiAgICB0aGlzLnBvQ29udHJvbFBvc2l0aW9uLmFkanVzdFBvc2l0aW9uKHRoaXMucG9zaXRpb24pO1xuICAgIHRoaXMuYXJyb3dEaXJlY3Rpb24gPSB0aGlzLnBvQ29udHJvbFBvc2l0aW9uLmdldEFycm93RGlyZWN0aW9uKCk7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlSW5pdGlhbENvbnRlbnQoKSB7XG4gICAgaWYgKHRoaXMuaGFzQ29udGVudFRvU2hvdygpKSB7XG4gICAgICB0aGlzLnNldFBvc2l0aW9uKCk7XG4gICAgICB0aGlzLmluaXRpYWxpemVMaXN0ZW5lcnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxufVxuIl19